<div class='toc'>
	<ol class='level-1'>
		<li><a href='#Rutas'>Rutas</a></li>
		<li><a href='#Condiciones'>Condiciones</a></li>
		<ol class='level-2'>
			<li><a href='#Valores%20de%20Retorno'>Valores de Retorno</a></li>
			<li><a href='#Comparadores%20de%20Rutas%20Personalizados'>Comparadores de Rutas Personalizados</a></li>
			<li><a href='#Archivos%20Est%C3%A1ticos'>Archivos Estáticos</a></li>
			<li><a href='#Vistas%20/%20Plantillas'>Vistas / Plantillas</a></li>
			<li><a href='#Lenguajes%20de%20Plantillas%20Disponibles'>Lenguajes de Plantillas Disponibles</a></li>
			<li><a href='#Plantillas%20Haml'>Plantillas Haml</a></li>
			<li><a href='#Plantillas%20Erb'>Plantillas Erb</a></li>
			<li><a href='#Plantillas%20Builder'>Plantillas Builder</a></li>
			<li><a href='#Plantillas%20Nokogiri'>Plantillas Nokogiri</a></li>
			<li><a href='#Plantillas%20Sass'>Plantillas Sass</a></li>
			<li><a href='#Plantillas%20SCSS'>Plantillas SCSS</a></li>
			<li><a href='#Plantillas%20Less'>Plantillas Less</a></li>
			<li><a href='#Plantillas%20Liquid'>Plantillas Liquid</a></li>
			<li><a href='#Plantillas%20Markdown'>Plantillas Markdown</a></li>
			<li><a href='#Plantillas%20Textile'>Plantillas Textile</a></li>
			<li><a href='#Plantillas%20RDoc'>Plantillas RDoc</a></li>
			<li><a href='#Plantillas%20Radius'>Plantillas Radius</a></li>
			<li><a href='#Plantillas%20Markaby'>Plantillas Markaby</a></li>
			<li><a href='#Plantillas%20RABL'>Plantillas RABL</a></li>
			<li><a href='#Plantillas%20Slim'>Plantillas Slim</a></li>
			<li><a href='#Plantillas%20Creole'>Plantillas Creole</a></li>
			<li><a href='#Plantillas%20CoffeeScript'>Plantillas CoffeeScript</a></li>
			<li><a href='#Plantillas%20Stylus'>Plantillas Stylus</a></li>
			<li><a href='#Plantillas%20Yajl'>Plantillas Yajl</a></li>
			<li><a href='#Plantillas%20WLang'>Plantillas WLang</a></li>
			<li><a href='#Plantillas%20Embebidas'>Plantillas Embebidas</a></li>
			<li><a href='#Accediendo%20a%20Variables%20en%20Plantillas'>Accediendo a Variables en Plantillas</a></li>
			<li><a href='#Plantillas%20Inline'>Plantillas Inline</a></li>
			<li><a href='#Plantillas%20Nombradas'>Plantillas Nombradas</a></li>
			<li><a href='#Asociando%20Extensiones%20de%20Archivo'>Asociando Extensiones de Archivo</a></li>
			<li><a href='#Agregando%20Tu%20Propio%20Motor%20de%20Renderizado'>Agregando Tu Propio Motor de Renderizado</a></li>
		</ol>
		<li><a href='#Filtros'>Filtros</a></li>
		<li><a href='#Ayudantes'>Ayudantes</a></li>
		<ol class='level-2'>
			<li><a href='#Usando%20Sesiones'>Usando Sesiones</a></li>
			<li><a href='#Interrupci%C3%B3n'>Interrupción</a></li>
			<li><a href='#Paso'>Paso</a></li>
			<li><a href='#Ejecutando%20Otra%20Ruta'>Ejecutando Otra Ruta</a></li>
			<li><a href='#Asignando%20el%20C%C3%B3digo%20de%20Estado,%20los%20Encabezados%20y%20el%20Cuerpo%20de%20una%20Respuesta'>Asignando el Código de Estado, los Encabezados y el Cuerpo de una Respuesta</a></li>
			<li><a href='#Streaming%20De%20Respuestas'>Streaming De Respuestas</a></li>
			<li><a href='#Log%20(Registro)'>Log (Registro)</a></li>
			<li><a href='#Tipos%20Mime'>Tipos Mime</a></li>
			<li><a href='#Generando%20URLs'>Generando URLs</a></li>
			<li><a href='#Redirecci%C3%B3n%20del%20Navegador'>Redirección del Navegador</a></li>
			<li><a href='#Cache%20Control'>Cache Control</a></li>
			<li><a href='#Enviando%20Archivos'>Enviando Archivos</a></li>
			<li><a href='#Accediendo%20al%20objeto%20de%20la%20petici%C3%B3n'>Accediendo al objeto de la petición</a></li>
			<li><a href='#Archivos%20Adjuntos'>Archivos Adjuntos</a></li>
			<li><a href='#Fecha%20y%20Hora'>Fecha y Hora</a></li>
			<li><a href='#Buscando%20los%20Archivos%20de%20las%20Plantillas'>Buscando los Archivos de las Plantillas</a></li>
		</ol>
		<li><a href='#Configuraci%C3%B3n'>Configuración</a></li>
		<ol class='level-2'>
			<li><a href='#Configurando%20la%20Protecci%C3%B3n%20de%20Ataques'>Configurando la Protección de Ataques</a></li>
			<li><a href='#Configuraciones%20Disponibles'>Configuraciones Disponibles</a></li>
		</ol>
		<li><a href='#Entornos'>Entornos</a></li>
		<li><a href='#Manejo%20de%20Errores'>Manejo de Errores</a></li>
		<ol class='level-2'>
			<li><a href='#Error'>Error</a></li>
		</ol>
		<li><a href='#Rack%20Middleware'>Rack Middleware</a></li>
		<li><a href='#Pruebas'>Pruebas</a></li>
		<li><a href='#Sinatra::Base%20-%20Middleware,%20Librer%C3%ADas,%20y%20Aplicaciones%20Modulares'>Sinatra::Base - Middleware, Librerías, y Aplicaciones Modulares</a></li>
		<ol class='level-2'>
			<li><a href='#Estilo%20Modular%20vs.%20Cl%C3%A1sico'>Estilo Modular vs. Clásico</a></li>
			<li><a href='#Sirviendo%20una%20Aplicaci%C3%B3n%20Modular'>Sirviendo una Aplicación Modular</a></li>
			<li><a href='#Usando%20una%20Aplicaci%C3%B3n%20Cl%C3%A1sica%20con%20un%20Archivo%20config.ru'>Usando una Aplicación Clásica con un Archivo config.ru</a></li>
			<li><a href='#%C2%BFCu%C3%A1ndo%20Usar%20config.ru?'>¿Cuándo Usar config.ru?</a></li>
			<li><a href='#Utilizando%20Sinatra%20como%20Middleware'>Utilizando Sinatra como Middleware</a></li>
			<li><a href='#Creaci%C3%B3n%20Din%C3%A1mica%20de%20Aplicaciones'>Creación Dinámica de Aplicaciones</a></li>
		</ol>
		<li><a href='#%C3%81mbitos%20y%20Ligaduras'>Ámbitos y Ligaduras</a></li>
		<ol class='level-2'>
			<li><a href='#%C3%81mbito%20de%20Aplicaci%C3%B3n/Clase'>Ámbito de Aplicación/Clase</a></li>
			<li><a href='#%C3%81mbito%20de%20Petici%C3%B3n/Instancia'>Ámbito de Petición/Instancia</a></li>
			<li><a href='#%C3%81mbito%20de%20Delegaci%C3%B3n'>Ámbito de Delegación</a></li>
		</ol>
		<li><a href='#L%C3%ADnea%20de%20Comandos'>Línea de Comandos</a></li>
		<li><a href='#Versiones%20de%20Ruby%20Soportadas'>Versiones de Ruby Soportadas</a></li>
		<li><a href='#A%20la%20Vanguardia'>A la Vanguardia</a></li>
		<ol class='level-2'>
			<li><a href='#Con%20Bundler'>Con Bundler</a></li>
			<li><a href='#Con%20Git'>Con Git</a></li>
			<li><a href='#Instalaci%C3%B3n%20Global'>Instalación Global</a></li>
		</ol>
		<li><a href='#Versionado'>Versionado</a></li>
		<li><a href='#Lecturas%20Recomendadas'>Lecturas Recomendadas</a></li>
	</ol>
</div>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>

<p><em>Atención: Este documento es una traducción de la versión en inglés y puede estar desactualizado.</em></p>

<p>Sinatra es un
<a href="http://es.wikipedia.org/wiki/Lenguaje_espec%C3%ADfico_del_dominio">DSL</a> para
crear aplicaciones web rápidamente en Ruby con un mínimo esfuerzo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># miapp.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola mundo!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Instalá la gem y ejecutá la aplicación con:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>gem install sinatra
ruby miapp.rb
</pre></div>
</div>
</div>

<p>Podés verla en: http://localhost:4567</p>

<p>Es recomendable además ejecutar <code>gem install thin</code>, ya que Sinatra lo va
a utilizar cuando esté disponible.</p>

<a name='Rutas'></a>
<h2>Rutas</h2>

<p>En Sinatra, una ruta está compuesta por un método HTTP y un patrón de una URL.
Cada ruta se asocia con un bloque:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. mostrar algo ..
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. crear algo ..
<span style="color:#080;font-weight:bold">end</span>

put <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. reemplazar algo ..
<span style="color:#080;font-weight:bold">end</span>

patch <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. modificar algo ..
<span style="color:#080;font-weight:bold">end</span>

delete <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. aniquilar algo ..
<span style="color:#080;font-weight:bold">end</span>

options <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  .. informar algo ..
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Las rutas son comparadas en el orden en el que son definidas. La primer ruta
que coincide con la petición es invocada.</p>

<p>Los patrones de las rutas pueden incluir parámetros nombrados, accesibles a
través de el hash <code>params</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/hola/:nombre</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># coincide con "GET /hola/foo" y "GET /hola/bar"</span>
  <span style="color:#777"># params[:nombre] es 'foo' o 'bar'</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Hola </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:nombre</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>También podés acceder a los parámetros nombrados usando parámetros de bloque:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/hola/:nombre</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> |n|
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Hola </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>n<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Los patrones de ruta también pueden incluir parámetros splat (o wildcard),
accesibles a través del arreglo <code>params[:splat]</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/decir/*/al/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># coincide con /decir/hola/al/mundo</span>
  params[<span style="color:#A60">:splat</span>] <span style="color:#777"># =&gt; ["hola", "mundo"]</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/descargar/*.*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># coincide con /descargar/path/al/archivo.xml</span>
  params[<span style="color:#A60">:splat</span>] <span style="color:#777"># =&gt; ["path/al/archivo", "xml"]</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O, con parámetros de bloque:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/descargar/*.*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> |path, ext|
  [path, ext] <span style="color:#777"># =&gt; ["path/al/archivo", "xml"]</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Rutas con Expresiones Regulares:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">%r{</span><span style="color:#808">/hola/([</span><span style="color:#D20">\w</span><span style="color:#808">]+)</span><span style="color:#404">}</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Hola, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:captures</span>].first<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O con un parámetro de bloque:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">%r{</span><span style="color:#808">/hola/([</span><span style="color:#D20">\w</span><span style="color:#808">]+)</span><span style="color:#404">}</span></span> <span style="color:#080;font-weight:bold">do</span> |c|
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Hola, </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>c<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Los patrones de ruta pueden contener parámetros opcionales:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts.?:formato?</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># coincide con "GET /posts" y además admite cualquier extensión, por</span>
  <span style="color:#777"># ejemplo, "GET /posts.json", "GET /posts.xml", etc.</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>A propósito, a menos que desactivés la protección para el ataque <em>path
traversal</em> (ver más abajo), el path de la petición puede ser modificado
antes de que se compare con los de tus rutas.</p>

<a name='Condiciones'></a>
<h2>Condiciones</h2>

<p>Las rutas pueden incluir una variedad de condiciones de selección, como por
ejemplo el user agent:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span>, <span style="color:#A60">:agent</span> =&gt; <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">Songbird (</span><span style="color:#D20">\d</span><span style="color:#D20">\.</span><span style="color:#D20">\d</span><span style="color:#808">)[</span><span style="color:#D20">\d</span><span style="color:#D20">\/</span><span style="color:#808">]*?</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Estás usando la versión de Songbird </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:agent</span>][<span style="color:#00D">0</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># Coincide con browsers que no sean songbird</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Otras condiciones disponibles son <code>host_name</code> y <code>provides</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, <span style="color:#A60">:host_name</span> =&gt; <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">^admin</span><span style="color:#D20">\.</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Área de Administración, Acceso denegado!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, <span style="color:#A60">:provides</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">html</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, <span style="color:#A60">:provides</span> =&gt; [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rss</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">atom</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">xml</span><span style="color:#710">'</span></span>] <span style="color:#080;font-weight:bold">do</span>
  builder <span style="color:#A60">:feed</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Podés definir tus propias condiciones fácilmente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set(<span style="color:#A60">:probabilidad</span>) { |valor| condition { rand &lt;= valor } }

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/gana_un_auto</span><span style="color:#710">'</span></span>, <span style="color:#A60">:probabilidad</span> =&gt; <span style="color:#60E">0.1</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Ganaste!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/gana_un_auto</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Lo siento, perdiste.</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Si tu condición acepta más de un argumento, podés pasarle un arreglo. Al
definir la condición puede resultarte conveniente utilizar el operador splat en
la lista de parámetros:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set(<span style="color:#A60">:autorizar</span>) <span style="color:#080;font-weight:bold">do</span> |*roles|   <span style="color:#777"># &lt;- mirá el splat</span>
  condition <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#080;font-weight:bold">unless</span> sesion_iniciada? &amp;&amp; roles.any? {|rol| usuario_actual.tiene_rol? rol }
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/iniciar_sesion/</span><span style="color:#710">"</span></span>, <span style="color:#00D">303</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/mi/cuenta/</span><span style="color:#710">"</span></span>, <span style="color:#A60">:autorizar</span> =&gt; [<span style="color:#A60">:usuario</span>, <span style="color:#A60">:administrador</span>] <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Detalles de mi cuenta</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/solo/administradores/</span><span style="color:#710">"</span></span>, <span style="color:#A60">:autorizar</span> =&gt; <span style="color:#A60">:administrador</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Únicamente para administradores!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Valores%20de%20Retorno'></a>
<h3>Valores de Retorno</h3>

<p>El valor de retorno de un bloque de ruta determina al menos el cuerpo de la
respuesta que se le pasa al cliente HTTP o al siguiente middleware en la pila
de Rack. Lo más común es que sea un string, como en los ejemplos anteriores.
Sin embargo, otros valor también son aceptados.</p>

<p>Podés devolver cualquier objeto que sea una respuesta Rack válida, un objeto
que represente el cuerpo de una respuesta Rack o un código de estado HTTP:</p>

<p>De esa manera podemos, por ejemplo, implementar fácilmente un streaming:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Stream</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">each</span>
    <span style="color:#00D">100</span>.times { |i| <span style="color:#080;font-weight:bold">yield</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>i<span style="font-weight:bold;color:#666">}</span></span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span> }
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { <span style="color:#036;font-weight:bold">Stream</span>.new }
</pre></div>
</div>
</div>

<a name='Comparadores%20de%20Rutas%20Personalizados'></a>
<h3>Comparadores de Rutas Personalizados</h3>

<p>Como se mostró anteriormente, Sinatra permite utilizar Strings y expresiones
regulares para definir las rutas. Sin embargo, la cosa no termina ahí. Podés
definir tus propios comparadores muy fácilmente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PattronCualquieraMenos</span>
  <span style="color:#036;font-weight:bold">Match</span> = <span style="color:#036;font-weight:bold">Struct</span>.new(<span style="color:#A60">:captures</span>)

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(excepto)
    <span style="color:#33B">@excepto</span>  = excepto
    <span style="color:#33B">@capturas</span> = <span style="color:#036;font-weight:bold">Match</span>.new([])
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">match</span>(str)
    <span style="color:#33B">@capturas</span> <span style="color:#080;font-weight:bold">unless</span> <span style="color:#33B">@excepto</span> === str
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">cualquiera_menos</span>(patron)
  <span style="color:#036;font-weight:bold">PatronCualquieraMenos</span>.new(patron)
<span style="color:#080;font-weight:bold">end</span>

get cualquiera_menos(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/index</span><span style="color:#710">"</span></span>) <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Tené en cuenta que el ejemplo anterior es un poco rebuscado. Un resultado
similar puede conseguirse más sencillamente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  pass <span style="color:#080;font-weight:bold">if</span> request.path_info == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/index</span><span style="color:#710">"</span></span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O, usando un lookahead negativo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">%r{</span><span style="color:#808">^(?!/index$)</span><span style="color:#404">}</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Archivos%20Est%C3%A1ticos'></a>
<h3>Archivos Estáticos</h3>

<p>Los archivos estáticos son servidos desde el directorio público
<code>./public</code>. Podés especificar una ubicación diferente ajustando la
opción <code>:public_folder</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:public_folder</span>, <span style="color:#036;font-weight:bold">File</span>.dirname(<span style="color:#069">__FILE__</span>) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/estaticos</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Notá que el nombre del directorio público no está incluido en la URL. Por
ejemplo, el archivo <code>./public/css/style.css</code> se accede a través de
<code>http://ejemplo.com/css/style.css</code>.</p>

<p>Usá la configuración <code>:static_cache_control</code> para agregar el encabezado
<code>Cache-Control</code> (ver la sección de configuración para más detalles).</p>

<a name='Vistas%20/%20Plantillas'></a>
<h3>Vistas / Plantillas</h3>

<p>Cada lenguaje de plantilla se expone a través de un método de renderizado que
lleva su nombre. Estos métodos simplemente devuelven un string:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Renderiza <code>views/index.erb</code>.</p>

<p>En lugar del nombre de la plantilla podés proporcionar directamente el
contenido de la misma:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  codigo = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">&lt;%= Time.now %&gt;</span><span style="color:#710">"</span></span>
  erb codigo
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Los métodos de renderizado, aceptan además un segundo argumento, el hash de
opciones:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  erb <span style="color:#A60">:index</span>, <span style="color:#A60">:layout</span> =&gt; <span style="color:#A60">:post</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Renderiza <code>views/index.erb</code> embebido en <code>views/post.erb</code> (por
defecto, la plantilla <code>:index</code> es embebida en <code>views/layout.erb</code> siempre y
cuando este último archivo exista).</p>

<p>Cualquier opción que Sinatra no entienda le será pasada al motor de renderizado
de la plantilla:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>, <span style="color:#A60">:format</span> =&gt; <span style="color:#A60">:html5</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Además podés definir las opciones para un lenguaje de plantillas de forma
general:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:haml</span>, <span style="color:#A60">:format</span> =&gt; <span style="color:#A60">:html5</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Las opciones pasadas al método de renderizado tienen precedencia sobre las
definidas mediante <code>set</code>.</p>

<p>Opciones disponibles:</p>

<dl>
<dt>locals</dt>
  <dd>
    Lista de variables locales pasadas al documento. Resultan muy útiles cuando
    se combinan con parciales.
    Ejemplo: <tt>erb "&lt;%= foo %&gt;", :locals =&gt; {:foo =&gt; "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    Encoding utilizado cuando el de un string es dudoso. Por defecto toma el
    valor de <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Directorio desde donde se cargan las vistas. Por defecto toma el valor de
    <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
    Si es <tt>true</tt> o <tt>false</tt> indica que se debe usar, o nó, un layout,
    respectivamente. También puede ser un símbolo que especifique qué plantilla
    usar. Ejemplo: <tt>erb :index, :layout =&gt; !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    Content-Type que produce la plantilla. El valor por defecto depende de cada
    lenguaje de plantillas.
  </dd>

  <dt>scope</dt>
  <dd>
    Ámbito en el que se renderiza la plantilla. Por defecto utiliza la instancia
    de la aplicación. Tené en cuenta que si cambiás esta opción las variables de
    instancia y los helpers van a dejar de estar disponibles.
  </dd>

  <dt>layout_engine</dt>
  <dd>
    Motor de renderizado de plantillas que usa para el layout. Resulta
    conveniente para lenguajes que no soportan layouts. Por defecto toma el valor
    del motor usado para renderizar la plantilla.
    Ejemplo: <tt>set :rdoc, :layout_engine =&gt; :erb</tt>
  </dd>

  <dd>
    Se asume que las plantillas están ubicadas directamente bajo el directorio
    <tt>./views</tt>. Para usar un directorio de vistas diferente:
    <tt>set :views, settings.root + '/plantillas'</tt>
  </dd>

  <dd>
    Es importante acordarse que siempre tenés que referenciar a las plantillas con
    símbolos, incluso cuando se encuentran en un subdirectorio (en este caso
    tenés que usar: <tt>'subdir/plantilla'</tt>). Tenés que usar un símbolo porque los
    métodos de renderización van a renderizar directamente cualquier string que se
    les pase como argumento.
  </dd>
</dl>
<a name='Lenguajes%20de%20Plantillas%20Disponibles'></a>
<h3>Lenguajes de Plantillas Disponibles</h3>

<p>Algunos lenguajes tienen varias implementaciones. Para especificar que
implementación usar (y para ser thread-safe), deberías requerirla antes de
usarla:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rdiscount</span><span style="color:#710">'</span></span> <span style="color:#777"># o require 'bluecloth'</span>
get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { markdown <span style="color:#A60">:index</span> }
</pre></div>
</div>
</div>

<a name='Plantillas%20Haml'></a>
<h3>Plantillas Haml</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
<tr>
<td>Expresiones de Archivo</td>
    <td><tt>.haml</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>haml :index, :format =&gt; :html5</tt></td>
  </tr>
</table>
<a name='Plantillas%20Erb'></a>
<h3>Plantillas Erb</h3>

<table>
<tr>
<td>Dependencias</td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
      o erb (incluida en Ruby)
    </td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td>
<tt>.erb</tt>, <tt>.rhtml</tt> o <tt>.erubis</tt> (solamente con Erubis)</td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>
<a name='Plantillas%20Builder'></a>
<h3>Plantillas Builder</h3>

<table>
<tr>
<td>Dependencias</td>
    <td>
      <a href="http://builder.rubyforge.org/" title="builder">builder</a>
    </td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.builder</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>builder { |xml| xml.em "hola" }</tt></td>
  </tr>
</table>
<p>Además, acepta un bloque con la definición de la plantilla (ver el ejemplo).</p>

<a name='Plantillas%20Nokogiri'></a>
<h3>Plantillas Nokogiri</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>nokogiri { |xml| xml.em "hola" }</tt></td>
  </tr>
</table>
<p>Además, acepta un bloque con la definición de la plantilla (ver el ejemplo).</p>

<a name='Plantillas%20Sass'></a>
<h3>Plantillas Sass</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.sass</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>sass :stylesheet, :style =&gt; :expanded</tt></td>
  </tr>
</table>
<a name='Plantillas%20SCSS'></a>
<h3>Plantillas SCSS</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.scss</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>scss :stylesheet, :style =&gt; :expanded</tt></td>
  </tr>
</table>
<a name='Plantillas%20Less'></a>
<h3>Plantillas Less</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.less</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>
<a name='Plantillas%20Liquid'></a>
<h3>Plantillas Liquid</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.liquid</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>liquid :index, :locals =&gt; { :clave =&gt; 'valor' }</tt></td>
  </tr>
</table>
<p>Como no vas a poder llamar a métodos de Ruby (excepto por <code>yield</code>) desde una
plantilla Liquid, casi siempre vas a querer pasarle locales.</p>

<a name='Plantillas%20Markdown'></a>
<h3>Plantillas Markdown</h3>

<table>
<tr>
<td>Dependencias</td>
    <td>
      <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
      <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
      <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
      <a href="http://kramdown.rubyforge.org/" title="kramdown">kramdown</a> o
      <a href="http://maruku.rubyforge.org/" title="maruku">maruku</a>
    </td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td>
<tt>.markdown</tt>, <tt>.mkd</tt> y <tt>.md</tt>
</td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>markdown :index, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>
<p>No es posible llamar métodos desde markdown, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinación con otro motor de renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:resumen</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:texto</span> =&gt; markdown(<span style="color:#A60">:introduccion</span>) }
</pre></div>
</div>
</div>

<p>Tené en cuenta que también podés llamar al método <code>markdown</code> desde otras
plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Hola</span> <span style="color:#036;font-weight:bold">Desde</span> Haml!
%p= markdown(<span style="color:#A60">:saludos</span>)
</pre></div>
</div>
</div>

<p>Como no podés utilizar Ruby desde Markdown, no podés usar layouts escritos en
Markdown. De todos modos, es posible usar un motor de renderizado para el
layout distinto al de la plantilla pasando la opción <code>:layout_engine</code>.</p>

<a name='Plantillas%20Textile'></a>
<h3>Plantillas Textile</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.textile</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>textile :index, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>
<p>No es posible llamar métodos desde textile, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinación con otro motor de renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:resumen</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:texto</span> =&gt; textile(<span style="color:#A60">:introduccion</span>) }
</pre></div>
</div>
</div>

<p>Tené en cuenta que también podés llamar al método <code>textile</code> desde otras
plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Hola</span> <span style="color:#036;font-weight:bold">Desde</span> Haml!
%p= textile(<span style="color:#A60">:saludos</span>)
</pre></div>
</div>
</div>

<p>Como no podés utilizar Ruby desde Textile, no podés usar layouts escritos en
Textile. De todos modos, es posible usar un motor de renderizado para el
layout distinto al de la plantilla pasando la opción <code>:layout_engine</code>.</p>

<a name='Plantillas%20RDoc'></a>
<h3>Plantillas RDoc</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://rdoc.rubyforge.org/" title="RDoc">RDoc</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.rdoc</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>rdoc :README, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>
<p>No es posible llamar métodos desde rdoc, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinación con otro motor de renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:resumen</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:texto</span> =&gt; rdoc(<span style="color:#A60">:introduccion</span>) }
</pre></div>
</div>
</div>

<p>Tené en cuenta que también podés llamar al método <code>rdoc</code> desde otras
plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Hola</span> <span style="color:#036;font-weight:bold">Desde</span> Haml!
%p= rdoc(<span style="color:#A60">:saludos</span>)
</pre></div>
</div>
</div>

<p>Como no podés utilizar Ruby desde RDoc, no podés usar layouts escritos en RDoc.
De todos modos, es posible usar un motor de renderizado para el layout distinto
al de la plantilla pasando la opción <code>:layout_engine</code>.</p>

<a name='Plantillas%20Radius'></a>
<h3>Plantillas Radius</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://radius.rubyforge.org/" title="Radius">Radius</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.radius</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>radius :index, :locals =&gt; { :clave =&gt; 'valor' }</tt></td>
  </tr>
</table>
<p>Como no vas a poder llamar a métodos de Ruby (excepto por <code>yield</code>) desde una
plantilla Radius, casi siempre vas a querer pasarle locales.</p>

<a name='Plantillas%20Markaby'></a>
<h3>Plantillas Markaby</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.mab</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>markaby { h1 "Bienvenido!" }</tt></td>
  </tr>
</table>
<p>Además, acepta un bloque con la definición de la plantilla (ver el ejemplo).</p>

<a name='Plantillas%20RABL'></a>
<h3>Plantillas RABL</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.rabl</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>
<a name='Plantillas%20Slim'></a>
<h3>Plantillas Slim</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.slim</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>
<a name='Plantillas%20Creole'></a>
<h3>Plantillas Creole</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.creole</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>creole :wiki, :layout_engine =&gt; :erb</tt></td>
  </tr>
</table>
<p>No es posible llamar métodos desde creole, ni pasarle locales. Por lo tanto,
generalmente vas a usarlo en combinación con otro motor de renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>erb <span style="color:#A60">:resumen</span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:texto</span> =&gt; cerole(<span style="color:#A60">:introduccion</span>) }
</pre></div>
</div>
</div>

<p>Tené en cuenta que también podés llamar al método <code>creole</code> desde otras
plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%h1 <span style="color:#036;font-weight:bold">Hola</span> <span style="color:#036;font-weight:bold">Desde</span> Haml!
%p= creole(<span style="color:#A60">:saludos</span>)
</pre></div>
</div>
</div>

<p>Como no podés utilizar Ruby desde Creole, no podés usar layouts escritos en
Creloe. De todos modos, es posible usar un motor de renderizado para el layout
distinto al de la plantilla pasando la opción <code>:layout_engine</code>.</p>

<a name='Plantillas%20CoffeeScript'></a>
<h3>Plantillas CoffeeScript</h3>

<table>
<tr>
<td>Dependencias</td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a> y un
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        mecanismo para ejecutar javascript
      </a>
    </td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.coffee</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>
<a name='Plantillas%20Stylus'></a>
<h3>Plantillas Stylus</h3>

<table>
<tr>
<td>Dependencias</td>
    <td>
      <a href="https://github.com/lucasmazza/ruby-stylus" title="Ruby Stylus">
        Stylus
      </a> y un
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        mecanismo para ejecutar javascript
      </a>
    </td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.styl</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>stylus :index</tt></td>
  </tr>
</table>
<a name='Plantillas%20Yajl'></a>
<h3>Plantillas Yajl</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.yajl</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td>
      <tt>
        yajl :index,
             :locals =&gt; { :key =&gt; 'qux' },
             :callback =&gt; 'present',
             :variable =&gt; 'resource'
      </tt>
    </td>
  </tr>
</table>
<p>El contenido de La plantilla se evalúa como código Ruby, y la variable <code>json</code> es convertida a JSON mediante <code>#to_json</code>.</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>json = { <span style="color:#A60">:foo</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span> }
json[<span style="color:#A60">:baz</span>] = key
</pre></div>
</div>
</div>

<p>Las opciones <code>:callback</code> y <code>:variable</code> se pueden utilizar para decorar el objeto renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>var resource = {<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">foo</span><span style="color:#710">"</span></span><span style="color:#A60"><span style="color:#A60">:</span><span style="color:#630">"</span><span style="color:#A60">bar</span><span style="color:#630">"</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">baz</span><span style="color:#710">"</span></span><span style="color:#A60"><span style="color:#A60">:</span><span style="color:#630">"</span><span style="color:#A60">qux</span><span style="color:#630">"</span></span>}; present(resource);
</pre></div>
</div>
</div>

<a name='Plantillas%20WLang'></a>
<h3>Plantillas WLang</h3>

<table>
<tr>
<td>Dependencias</td>
    <td><a href="https://github.com/blambeau/wlang/" title="wlang">wlang</a></td>
  </tr>
<tr>
<td>Extensiones de Archivo</td>
    <td><tt>.wlang</tt></td>
  </tr>
<tr>
<td>Ejemplo</td>
    <td><tt>wlang :index, :locals =&gt; { :clave =&gt; 'valor' }</tt></td>
  </tr>
</table>
<p>Como no vas a poder llamar a métodos de Ruby (excepto por <code>yield</code>) desde una
plantilla WLang, casi siempre vas a querer pasarle locales.</p>

<a name='Plantillas%20Embebidas'></a>
<h3>Plantillas Embebidas</h3>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%div.titulo Hola Mundo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Renderiza el template embebido en el string.</p>

<a name='Accediendo%20a%20Variables%20en%20Plantillas'></a>
<h3>Accediendo a Variables en Plantillas</h3>

<p>Las plantillas son evaluadas dentro del mismo contexto que los manejadores de
ruta. Las variables de instancia asignadas en los manejadores de ruta son
accesibles directamente por las plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:id</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@foo</span> = <span style="color:#036;font-weight:bold">Foo</span>.find(params[<span style="color:#A60">:id</span>])
  haml <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%h1= @foo.nombre</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O es posible especificar un Hash de variables locales explícitamente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:id</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  foo = <span style="color:#036;font-weight:bold">Foo</span>.find(params[<span style="color:#A60">:id</span>])
  haml <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%h1= bar.nombre</span><span style="color:#710">'</span></span>, <span style="color:#A60">:locals</span> =&gt; { <span style="color:#A60">:bar</span> =&gt; foo }
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Esto es usado típicamente cuando se renderizan plantillas como parciales desde
adentro de otras plantillas.</p>

<a name='Plantillas%20Inline'></a>
<h3>Plantillas Inline</h3>

<p>Las plantillas pueden ser definidas al final del archivo fuente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rubygems</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777">__END__

@@ layout
%html
  = yield

@@ index
%div.titulo Hola mundo!!!!!</span>
</pre></div>
</div>
</div>

<p>NOTA: únicamente las plantillas inline definidas en el archivo fuente que
requiere sinatra son cargadas automáticamente. Llamá <code>enable
:inline_templates</code> explícitamente si tenés plantillas inline en otros
archivos fuente.</p>

<a name='Plantillas%20Nombradas'></a>
<h3>Plantillas Nombradas</h3>

<p>Las plantillas también pueden ser definidas usando el método top-level
<code>template</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>template <span style="color:#A60">:layout</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">%html</span><span style="color:#b0b">\n</span><span style="color:#D20">  =yield</span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

template <span style="color:#A60">:index</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%div.titulo Hola Mundo!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Si existe una plantilla con el nombre “layout”, va a ser usada cada vez que
una plantilla es renderizada. Podés desactivar los layouts individualmente
pasando <code>:layout =&gt; false</code> o globalmente con
<code>set :haml, :layout =&gt; false</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  haml <span style="color:#A60">:index</span>, <span style="color:#A60">:layout</span> =&gt; !request.xhr?
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Asociando%20Extensiones%20de%20Archivo'></a>
<h3>Asociando Extensiones de Archivo</h3>

<p>Para asociar una extensión de archivo con un motor de renderizado, usá
<code>Tilt.register</code>. Por ejemplo, si querés usar la extensión <code>tt</code> para
las plantillas Textile, podés hacer lo siguiente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Tilt</span>.register <span style="color:#A60">:tt</span>, <span style="color:#036;font-weight:bold">Tilt</span>[<span style="color:#A60">:textile</span>]
</pre></div>
</div>
</div>

<a name='Agregando%20Tu%20Propio%20Motor%20de%20Renderizado'></a>
<h3>Agregando Tu Propio Motor de Renderizado</h3>

<p>Primero, registrá tu motor con Tilt, y después, creá tu método de renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#036;font-weight:bold">Tilt</span>.register <span style="color:#A60">:mipg</span>, <span style="color:#036;font-weight:bold">MiMotorParaPlantillaGenial</span>

helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">mypg</span>(*args) render(<span style="color:#A60">:mypg</span>, *args) <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  mypg <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Renderiza <code>./views/index.mypg</code>. Mirá https://github.com/rtomayko/tilt
para aprender más de Tilt.</p>

<a name='Filtros'></a>
<h2>Filtros</h2>

<p>Los filtros <code>before</code> son evaluados antes de cada petición dentro del mismo
contexto que las rutas. Pueden modificar la petición y la respuesta. Las
variables de instancia asignadas en los filtros son accesibles por las rutas y
las plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@nota</span> = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hey!</span><span style="color:#710">'</span></span>
  request.path_info = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo/bar/baz</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@nota</span> <span style="color:#777">#=&gt; 'Hey!'</span>
  params[<span style="color:#A60">:splat</span>] <span style="color:#777">#=&gt; 'bar/baz'</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Los filtros <code>after</code> son evaluados después de cada petición dentro del mismo
contexto y también pueden modificar la petición y la respuesta. Las variables
de instancia asignadas en los filtros <code>before</code> y en las rutas son accesibles por
los filtros <code>after</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>after <span style="color:#080;font-weight:bold">do</span>
  puts response.status
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Nota: A menos que usés el método <code>body</code> en lugar de simplemente devolver un
string desde una ruta, el cuerpo de la respuesta no va a estar disponible en
un filtro after, debido a que todavía no se ha generado.</p>

<p>Los filtros aceptan un patrón opcional, que cuando está presente causa que los
mismos sean evaluados únicamente si el path de la petición coincide con ese
patrón:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/protegido/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  autenticar!
<span style="color:#080;font-weight:bold">end</span>

after <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/crear/:slug</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> |slug|
  session[<span style="color:#A60">:ultimo_slug</span>] = slug
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Al igual que las rutas, los filtros también pueden aceptar condiciones:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="color:#A60">:agent</span> =&gt; <span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">Songbird</span><span style="color:#404">/</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>

after <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/blog/*</span><span style="color:#710">'</span></span>, <span style="color:#A60">:host_name</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ejemplo.com</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Ayudantes'></a>
<h2>Ayudantes</h2>

<p>Usá el método top-level <em>helpers</em> para definir métodos ayudantes que
pueden ser utilizados dentro de los manejadores de rutas y las plantillas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bar</span>(nombre)
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>nombre<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">bar</span><span style="color:#710">"</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:nombre</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  bar(params[<span style="color:#A60">:nombre</span>])
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Por cuestiones organizativas, puede resultar conveniente organizar los métodos
ayudantes en distintos módulos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">FooUtils</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">foo</span>(nombre) <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>nombre<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">foo</span><span style="color:#710">"</span></span> <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">BarUtils</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bar</span>(nombre) <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>nombre<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">bar</span><span style="color:#710">"</span></span> <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

helpers <span style="color:#036;font-weight:bold">FooUtils</span>, <span style="color:#036;font-weight:bold">BarUtils</span>
</pre></div>
</div>
</div>

<p>El efecto de utilizar <em>helpers</em> de esta manera es el mismo que resulta de
incluir los módulos en la clase de la aplicación.</p>

<a name='Usando%20Sesiones'></a>
<h3>Usando Sesiones</h3>

<p>Una sesión es usada para mantener el estado a través de distintas peticiones.
Cuando están activadas, tenés un hash de sesión para cada sesión de usuario:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>enable <span style="color:#A60">:sessions</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">valor = </span><span style="color:#710">"</span></span> &lt;&lt; session[<span style="color:#A60">:valor</span>].inspect
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:valor</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  session[<span style="color:#A60">:valor</span>] = params[<span style="color:#A60">:valor</span>]
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Tené en cuenta que <code>enable :sessions</code> guarda todos los datos en una
cookie, lo que no es siempre deseable (guardar muchos datos va a incrementar
tu tráfico, por citar un ejemplo). Podés usar cualquier middleware Rack para
manejar sesiones, de la misma manera que usarías cualquier otro middleware,
pero con la salvedad de que <em>no</em> tenés que llamar a <code>enable :sessions</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Session</span>::<span style="color:#036;font-weight:bold">Pool</span>, <span style="color:#A60">:expire_after</span> =&gt; <span style="color:#00D">2592000</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">valor = </span><span style="color:#710">"</span></span> &lt;&lt; session[<span style="color:#A60">:valor</span>].inspect
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/:valor</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  session[<span style="color:#A60">:valor</span>] = params[<span style="color:#A60">:valor</span>]
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Para incrementar la seguridad, los datos de la sesión almacenados en
la cookie son firmados con un secreto de sesión. Este secreto, es
generado aleatoriamente por Sinatra. De cualquier manera, hay que
tener en cuenta que cada vez que inicies la aplicación se va a generar
uno nuevo. Así, si querés que todas las instancias de tu aplicación
compartan un único secreto, tenés que definirlo vos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:session_secret</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">super secreto</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Si necesitás una configuración más específica, <code>sessions</code> acepta un
Hash con opciones:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:sessions</span>, <span style="color:#A60">:domain</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo.com</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<a name='Interrupci%C3%B3n'></a>
<h3>Interrupción</h3>

<p>Para detener inmediatamente una petición dentro de un filtro o una ruta usá:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt
</pre></div>
</div>
</div>

<p>También podés especificar el estado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="color:#00D">410</span>
</pre></div>
</div>
</div>

<p>O el cuerpo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">esto va a ser el cuerpo</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>O los dos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="color:#00D">401</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">salí de acá!</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Con cabeceras:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt <span style="color:#00D">402</span>, { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Content-Type</span><span style="color:#710">'</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text/plain</span><span style="color:#710">'</span></span> }, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">venganza</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>Obviamente, es posible utilizar <code>halt</code> con una plantilla:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>halt erb(<span style="color:#A60">:error</span>)
</pre></div>
</div>
</div>

<a name='Paso'></a>
<h3>Paso</h3>

<p>Una ruta puede pasarle el procesamiento a la siguiente ruta que coincida con
la petición usando <code>pass</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/adivina/:quien</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  pass <span style="color:#080;font-weight:bold">unless</span> params[<span style="color:#A60">:quien</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Franco</span><span style="color:#710">'</span></span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Adivinaste!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/adivina/*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Erraste!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Se sale inmediatamente del bloque de la ruta y se le pasa el control a la
siguiente ruta que coincida. Si no coincide ninguna ruta, se devuelve un 404.</p>

<a name='Ejecutando%20Otra%20Ruta'></a>
<h3>Ejecutando Otra Ruta</h3>

<p>Cuando querés obtener el resultado de la llamada a una ruta, <code>pass</code> no te va a
servir. Para lograr esto, podés usar <code>call</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  status, headers, body = call env.merge(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">PATH_INFO</span><span style="color:#710">"</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span>)
  [status, headers, body.map(&amp;<span style="color:#A60">:upcase</span>)]
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">bar</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Notá que en el ejemplo anterior, es conveniente mover <code>"bar"</code> a un
helper, y llamarlo desde <code>/foo</code> y <code>/bar</code>. Así, vas a simplificar
las pruebas y a mejorar el rendimiento.</p>

<p>Si querés que la petición se envíe a la misma instancia de la aplicación en
lugar de a otra, usá <code>call!</code> en lugar de <code>call</code>.</p>

<p>En la especificación de Rack podés encontrar más información sobre
<code>call</code>.</p>

<a name='Asignando%20el%20C%C3%B3digo%20de%20Estado,%20los%20Encabezados%20y%20el%20Cuerpo%20de%20una%20Respuesta'></a>
<h3>Asignando el Código de Estado, los Encabezados y el Cuerpo de una Respuesta</h3>

<p>Es posible, y se recomienda, asignar el código de estado y el cuerpo de una
respuesta con el valor de retorno de una ruta. De cualquier manera, en varios
escenarios, puede que sea conveniente asignar el cuerpo en un punto arbitrario
del flujo de ejecución con el método <code>body</code>. A partir de ahí, podés usar ese
mismo método para acceder al cuerpo de la respuesta:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  body <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">bar</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

after <span style="color:#080;font-weight:bold">do</span>
  puts body
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>También es posible pasarle un bloque a <code>body</code>, que será ejecutado por el Rack
handler (podés usar esto para implementar streaming, mirá “Valores de retorno”).</p>

<p>De manera similar, también podés asignar el código de estado y encabezados:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  status <span style="color:#00D">418</span>
  headers \
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Allow</span><span style="color:#710">"</span></span>   =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">BREW, POST, GET, PROPFIND, WHEN</span><span style="color:#710">"</span></span>,
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Refresh</span><span style="color:#710">"</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt</span><span style="color:#710">"</span></span>
  body <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">I'm a tea pot!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>También, al igual que <code>body</code>, tanto <code>status</code> como <code>headers</code> pueden utilizarse
para obtener sus valores cuando no se les pasa argumentos.</p>

<a name='Streaming%20De%20Respuestas'></a>
<h3>Streaming De Respuestas</h3>

<p>A veces vas a querer empezar a enviar la respuesta a pesar de que todavía no
terminaste de generar su cuerpo. También es posible que, en algunos casos,
quieras seguir enviando información hasta que el cliente cierre la conexión.
Cuando esto ocurra, el <code>stream</code> helper te va a ser de gran ayuda:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  stream <span style="color:#080;font-weight:bold">do</span> |out|
    out &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Esto va a ser legen -</span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span>
    sleep <span style="color:#60E">0.5</span>
    out &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20"> (esperalo) </span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span>
    sleep <span style="color:#00D">1</span>
    out &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">- dario!</span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Podés implementar APIs de streaming,
<a href="http://dev.w3.org/html5/eventsource/">Server-Sent Events</a> y puede ser usado
como base para <a href="http://es.wikipedia.org/wiki/WebSockets">WebSockets</a>. También
puede ser usado para incrementar el throughput si solo una parte del contenido
depende de un recurso lento.</p>

<p>Hay que tener en cuenta que el comportamiento del streaming, especialmente el
número de peticiones concurrentes, depende del servidor web utilizado para
servir la aplicación. Puede que algunos servidores, como es el caso de
WEBRick, no soporten streaming directamente, así el cuerpo de la respuesta será
enviado completamente de una vez cuando el bloque pasado a <code>stream</code> finalice su
ejecución. Si estás usando Shotgun, el streaming no va a funcionar.</p>

<p>Cuando se pasa <code>keep_open</code> como parámetro, no se va a enviar el mensaje
<code>close</code> al objeto de stream. Queda en vos cerrarlo en el punto de ejecución
que quieras. Nuevamente, hay que tener en cuenta que este comportamiento es
posible solo en servidores que soporten eventos, como Thin o Rainbows. El
resto de los servidores van a cerrar el stream de todos modos:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:server</span>, <span style="color:#A60">:thin</span>
conexiones = []

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># mantenemos abierto el stream</span>
  stream(<span style="color:#A60">:keep_open</span>) { |salida| conexiones &lt;&lt; salida }
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># escribimos a todos los streams abiertos</span>
  conexiones.each { |salida| salida &lt;&lt; params[<span style="color:#A60">:mensaje</span>] &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#b0b">\n</span><span style="color:#710">"</span></span> }
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">mensaje enviado</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Log%20(Registro)'></a>
<h3>Log (Registro)</h3>

<p>En el ámbito de la petición, el helper <code>logger</code> (registrador) expone
una instancia de <code>Logger</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  logger.info <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">cargando datos</span><span style="color:#710">"</span></span>
  <span style="color:#777"># ...</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Este logger tiene en cuenta la configuración de logueo de tu Rack
handler. Si el logueo está desactivado, este método va a devolver un
objeto que se comporta como un logger pero que en realidad no hace
nada. Así, no vas a tener que preocuparte por esta situación.</p>

<p>Tené en cuenta que el logueo está habilitado por defecto únicamente
para <code>Sinatra::Application</code>. Si heredaste de
<code>Sinatra::Base</code>, probablemente quieras habilitarlo manualmente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  configure <span style="color:#A60">:production</span>, <span style="color:#A60">:development</span> <span style="color:#080;font-weight:bold">do</span>
    enable <span style="color:#A60">:logging</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Para evitar que se inicialice cualquier middleware de logging, configurá
<code>logging</code> a <code>nil</code>. Tené en cuenta que, cuando hagas esto, <code>logger</code> va a
devolver <code>nil</code>. Un caso común es cuando querés usar tu propio logger. Sinatra
va a usar lo que encuentre en <code>env['rack.logger']</code>.</p>

<a name='Tipos%20Mime'></a>
<h3>Tipos Mime</h3>

<p>Cuando usás <code>send_file</code> o archivos estáticos tal vez tengas tipos mime
que Sinatra no entiende. Usá <code>mime_type</code> para registrarlos a través de la
extensión de archivo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#080;font-weight:bold">do</span>
  mime_type <span style="color:#A60">:foo</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text/foo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>También lo podés usar con el ayudante <code>content_type</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  content_type <span style="color:#A60">:foo</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">foo foo foo</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Generando%20URLs'></a>
<h3>Generando URLs</h3>

<p>Para generar URLs deberías usar el método <code>url</code>. Por ejemplo, en Haml:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>%a{<span style="color:#A60">:href</span> =&gt; url(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span>)} foo
</pre></div>
</div>
</div>

<p>Tiene en cuenta proxies inversos y encaminadores de Rack, si están presentes.</p>

<p>Este método también puede invocarse mediante su alias <code>to</code>  (mirá un ejemplo
a continuación).</p>

<a name='Redirecci%C3%B3n%20del%20Navegador'></a>
<h3>Redirección del Navegador</h3>

<p>Podés redireccionar al navegador con el método <code>redirect</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  redirect to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Cualquier parámetro adicional se utiliza de la misma manera que los argumentos
pasados a <code>halt</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>redirect to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span>), <span style="color:#00D">303</span>
redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">http://google.com</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">te confundiste de lugar, compañero</span><span style="color:#710">'</span></span>
</pre></div>
</div>
</div>

<p>También podés redireccionar fácilmente de vuelta hacia la página desde donde
vino el usuario con <code>redirect back</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">&lt;a href='/bar'&gt;hacer algo&lt;/a&gt;</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  hacer_algo
  redirect back
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Para pasar argumentos con una redirección, podés agregarlos a la cadena de
búsqueda:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>redirect to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar?suma=42</span><span style="color:#710">'</span></span>)
</pre></div>
</div>
</div>

<p>O usar una sesión:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>enable <span style="color:#A60">:sessions</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  session[<span style="color:#A60">:secreto</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>
  redirect to(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/bar</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  session[<span style="color:#A60">:secreto</span>]
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Cache%20Control'></a>
<h3>Cache Control</h3>

<p>Asignar tus encabezados correctamente es el cimiento para realizar un cacheo
HTTP correcto.</p>

<p>Podés asignar el encabezado Cache-Control fácilmente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  cache_control <span style="color:#A60">:public</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">cachealo!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Pro tip: configurar el cacheo en un filtro <code>before</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="color:#080;font-weight:bold">do</span>
  cache_control <span style="color:#A60">:public</span>, <span style="color:#A60">:must_revalidate</span>, <span style="color:#A60">:max_age</span> =&gt; <span style="color:#00D">60</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Si estás usando el helper <code>expires</code> para definir el encabezado correspondiente,
<code>Cache-Control</code> se va a definir automáticamente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before <span style="color:#080;font-weight:bold">do</span>
  expires <span style="color:#00D">500</span>, <span style="color:#A60">:public</span>, <span style="color:#A60">:must_revalidate</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Para usar cachés adecuadamente, deberías considerar usar <code>etag</code> o
<code>last_modified</code>. Es recomendable que llames a estos helpers <em>antes</em> de hacer
cualquier trabajo pesado, ya que van a enviar la respuesta inmediatamente si
el cliente ya tiene la versión actual en su caché:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/articulo/:id</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#33B">@articulo</span> = <span style="color:#036;font-weight:bold">Articulo</span>.find params[<span style="color:#A60">:id</span>]
  last_modified <span style="color:#33B">@articulo</span>.updated_at
  etag <span style="color:#33B">@articulo</span>.sha1
  erb <span style="color:#A60">:articulo</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>También es posible usar una
<a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak ETag</a>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>etag <span style="color:#33B">@articulo</span>.sha1, <span style="color:#A60">:weak</span>
</pre></div>
</div>
</div>

<p>Estos helpers no van a cachear nada por vos, sino que van a facilitar la
información necesaria para poder hacerlo. Si estás buscando soluciones rápidas
de cacheo con proxys inversos, mirá
<a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">rack/cache</span><span style="color:#710">"</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">sinatra</span><span style="color:#710">"</span></span>

use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Cache</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  cache_control <span style="color:#A60">:public</span>, <span style="color:#A60">:max_age</span> =&gt; <span style="color:#00D">36000</span>
  sleep <span style="color:#00D">5</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">hola</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Usá la configuración <code>:static_cache_control</code> para agregar el encabezado
<code>Cache-Control</code> a archivos estáticos (ver la sección de configuración
para más detalles).</p>

<p>De acuerdo con la RFC 2616 tu aplicación debería comportarse diferente si a las
cabeceras If-Match o If-None-Match se le asigna el valor <code>*</code> cuando el
recurso solicitado ya existe. Sinatra asume para peticiones seguras (como get)
e idempotentes (como put) que el recurso existe, mientras que para el resto
(como post), que no. Podes cambiar este comportamiento con la opción
<code>:new_resource</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/crear</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  etag <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>, <span style="color:#A60">:new_resource</span> =&gt; <span style="color:#069">true</span>
  <span style="color:#036;font-weight:bold">Articulo</span>.create
  erb <span style="color:#A60">:nuevo_articulo</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Si querés seguir usando una weak ETag, indicalo con la opción <code>:kind</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>etag <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>, <span style="color:#A60">:new_resource</span> =&gt; <span style="color:#069">true</span>, <span style="color:#A60">:kind</span> =&gt; <span style="color:#A60">:weak</span>
</pre></div>
</div>
</div>

<a name='Enviando%20Archivos'></a>
<h3>Enviando Archivos</h3>

<p>Para enviar archivos, podés usar el método <code>send_file</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  send_file <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo.png</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Además acepta un par de opciones:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>send_file <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo.png</span><span style="color:#710">'</span></span>, <span style="color:#A60">:type</span> =&gt; <span style="color:#A60">:jpg</span>
</pre></div>
</div>
</div>

<p>Estas opciones son:</p>

<p>[filename]
  nombre del archivo devuelto, por defecto es el nombre real del archivo.</p>

<p>[last_modified]
  valor para el encabezado Last-Modified, por defecto toma el mtime del archivo.</p>

<p>[type]
  el content type que se va a utilizar, si no está presente se intenta adivinar
  a partir de la extensión del archivo.</p>

<p>[disposition]
  se utiliza para el encabezado Content-Disposition, y puede tomar alguno de los
  siguientes valores: <code>nil</code> (por defecto), <code>:attachment</code> e
  <code>:inline</code></p>

<p>[length]
  encabezado Content-Length, por defecto toma el tamaño del archivo.</p>

<p>[status]
  código de estado devuelto. Resulta útil al enviar un archivo estático como una
  página de error.</p>

<p>Si el Rack handler lo soporta, se intentará no transmitir directamente desde el
proceso de Ruby. Si usás este método, Sinatra se va a encargar automáticamente
peticiones de rango.</p>

<a name='Accediendo%20al%20objeto%20de%20la%20petici%C3%B3n'></a>
<h3>Accediendo al objeto de la petición</h3>

<p>El objeto de la petición entrante puede ser accedido desde el nivel de la
petición (filtros, rutas y manejadores de errores) a través del método
<code>request</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># app corriendo en http://ejemplo.com/ejemplo</span>
get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  t = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">%w[</span><span style="color:#D20">text/css text/html application/javascript</span><span style="color:#710">]</span></span>
  request.accept              <span style="color:#777"># ['text/html', '*/*']</span>
  request.accept? <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">text/xml</span><span style="color:#710">'</span></span>  <span style="color:#777"># true</span>
  request.preferred_type(t)   <span style="color:#777"># 'text/html'</span>
  request.body                <span style="color:#777"># cuerpo de la petición enviado por el cliente (ver más abajo)</span>
  request.scheme              <span style="color:#777"># "http"</span>
  request.script_name         <span style="color:#777"># "/ejemplo"</span>
  request.path_info           <span style="color:#777"># "/foo"</span>
  request.port                <span style="color:#777"># 80</span>
  request.request_method      <span style="color:#777"># "GET"</span>
  request.query_string        <span style="color:#777"># ""</span>
  request.content_length      <span style="color:#777"># longitud de request.body</span>
  request.media_type          <span style="color:#777"># tipo de medio de request.body</span>
  request.host                <span style="color:#777"># "ejemplo.com"</span>
  request.get?                <span style="color:#777"># true (hay métodos análogos para los otros verbos)</span>
  request.form_data?          <span style="color:#777"># false</span>
  request[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">UNA_CABECERA</span><span style="color:#710">"</span></span>]     <span style="color:#777"># valor de la cabecera UNA_CABECERA</span>
  request.referrer            <span style="color:#777"># la referencia del cliente o '/'</span>
  request.user_agent          <span style="color:#777"># user agent (usado por la condición :agent)</span>
  request.cookies             <span style="color:#777"># hash de las cookies del browser</span>
  request.xhr?                <span style="color:#777"># es una petición ajax?</span>
  request.url                 <span style="color:#777"># "http://ejemplo.com/ejemplo/foo"</span>
  request.path                <span style="color:#777"># "/ejemplo/foo"</span>
  request.ip                  <span style="color:#777"># dirección IP del cliente</span>
  request.secure?             <span style="color:#777"># false (sería true sobre ssl)</span>
  request.forwarded?          <span style="color:#777"># true (si se está corriendo atrás de un proxy inverso)</span>
  requuest.env                <span style="color:#777"># hash de entorno directamente entregado por Rack</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Algunas opciones, como <code>script_name</code> o <code>path_info</code> pueden
también ser escritas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>before { request.path_info = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/</span><span style="color:#710">"</span></span> }

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/</span><span style="color:#710">"</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">todas las peticiones llegan acá</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>El objeto <code>request.body</code> es una instancia de IO o StringIO:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/api</span><span style="color:#710">"</span></span> <span style="color:#080;font-weight:bold">do</span>
  request.body.rewind  <span style="color:#777"># en caso de que alguien ya lo haya leído</span>
  datos = <span style="color:#036;font-weight:bold">JSON</span>.parse request.body.read
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Hola </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>datos[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nombre</span><span style="color:#710">'</span></span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Archivos%20Adjuntos'></a>
<h3>Archivos Adjuntos</h3>

<p>Podés usar el método helper <code>attachment</code> para indicarle al navegador que
almacene la respuesta en el disco en lugar de mostrarla en pantalla:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  attachment
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">guardalo!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>También podés pasarle un nombre de archivo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  attachment <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">info.txt</span><span style="color:#710">"</span></span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">guardalo!</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Fecha%20y%20Hora'></a>
<h3>Fecha y Hora</h3>

<p>Sinatra pone a tu disposición el helper <code>time_for</code>, que genera un objeto <code>Time</code>
a partir del valor que recibe como argumento. Este valor puede ser un
<code>String</code>, pero también es capaz de convertir objetos <code>DateTime</code>, <code>Date</code> y de
otras clases similares:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  pass <span style="color:#080;font-weight:bold">if</span> <span style="color:#036;font-weight:bold">Time</span>.now &gt; time_for(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Dec 23, 2012</span><span style="color:#710">'</span></span>)
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">todavía hay tiempo</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Este método es usado internamente por métodos como <code>expires</code> y <code>last_modified</code>,
entre otros. Por lo tanto, es posible extender el comportamiento de estos
métodos sobreescribiendo <code>time_for</code> en tu aplicación:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">time_for</span>(value)
    <span style="color:#080;font-weight:bold">case</span> value
    <span style="color:#080;font-weight:bold">when</span> <span style="color:#A60">:ayer</span> <span style="color:#080;font-weight:bold">then</span> <span style="color:#036;font-weight:bold">Time</span>.now - <span style="color:#00D">24</span>*<span style="color:#00D">60</span>*<span style="color:#00D">60</span>
    <span style="color:#080;font-weight:bold">when</span> <span style="color:#A60">:mañana</span> <span style="color:#080;font-weight:bold">then</span> <span style="color:#036;font-weight:bold">Time</span>.now + <span style="color:#00D">24</span>*<span style="color:#00D">60</span>*<span style="color:#00D">60</span>
    <span style="color:#080;font-weight:bold">else</span> <span style="color:#080;font-weight:bold">super</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  last_modified <span style="color:#A60">:ayer</span>
  expires <span style="color:#A60">:mañana</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">hola</span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Buscando%20los%20Archivos%20de%20las%20Plantillas'></a>
<h3>Buscando los Archivos de las Plantillas</h3>

<p>El helper <code>find_template</code> se utiliza para encontrar los archivos de las
plantillas que se van a renderizar:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>find_template settings.views, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">foo</span><span style="color:#710">'</span></span>, <span style="color:#036;font-weight:bold">Tilt</span>[<span style="color:#A60">:haml</span>] <span style="color:#080;font-weight:bold">do</span> |archivo|
  puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">podría ser </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>archivo<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Si bien esto no es muy útil, lo interesante es que podés sobreescribir este
método, y así enganchar tu propio mecanismo de búsqueda. Por ejemplo, para
poder utilizar más de un directorio de vistas:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:views</span>, [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vistas</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">plantillas</span><span style="color:#710">'</span></span>]

helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">find_template</span>(views, name, engine, &amp;block)
    Array(views).each { |v| <span style="color:#080;font-weight:bold">super</span>(v, name, engine, &amp;block) }
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Otro ejemplo consiste en usar directorios diferentes para los distintos motores
de renderizado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:views</span>, <span style="color:#A60">:sass</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vistas/sass</span><span style="color:#710">'</span></span>, <span style="color:#A60">:haml</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">plantillas</span><span style="color:#710">'</span></span>, <span style="color:#A60">:defecto</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vistas</span><span style="color:#710">'</span></span>

helpers <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">find_template</span>(views, name, engine, &amp;block)
    _, folder = views.detect { |k,v| engine == <span style="color:#036;font-weight:bold">Tilt</span>[k] }
    folder ||= views[<span style="color:#A60">:defecto</span>]
    <span style="color:#080;font-weight:bold">super</span>(folder, name, engine, &amp;block)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>¡Es muy fácil convertir estos ejemplos en una extensión y compartirla!.</p>

<p>Notá que <code>find_template</code> no verifica si un archivo existe realmente, sino
que llama al bloque que recibe para cada path posible. Esto no representa un
problema de rendimiento debido a que <code>render</code> va a usar <code>break</code> ni bien
encuentre un archivo que exista. Además, las ubicaciones de las plantillas (y
su contenido) se cachean cuando no estás en el modo de desarrollo. Es bueno
tener en cuenta lo anteiror si escribís un método medio loco.</p>

<a name='Configuraci%C3%B3n'></a>
<h2>Configuración</h2>

<p>Ejecutar una vez, en el inicio, en cualquier entorno:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># asignando una opción</span>
  set <span style="color:#A60">:opcion</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">valor</span><span style="color:#710">'</span></span>

  <span style="color:#777"># asignando varias opciones</span>
  set <span style="color:#A60">:a</span> =&gt; <span style="color:#00D">1</span>, <span style="color:#A60">:b</span> =&gt; <span style="color:#00D">2</span>

  <span style="color:#777"># atajo para `set :opcion, true`</span>
  enable <span style="color:#A60">:opcion</span>

  <span style="color:#777"># atajo para `set :opcion, false`</span>
  disable <span style="color:#A60">:opcion</span>

  <span style="color:#777"># también podés tener configuraciones dinámicas usando bloques</span>
  set(<span style="color:#A60">:css_dir</span>) { <span style="color:#036;font-weight:bold">File</span>.join(views, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">css</span><span style="color:#710">'</span></span>) }
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ejecutar únicamente cuando el entorno (la variable de entorno RACK_ENV) es
<code>:production</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#A60">:production</span> <span style="color:#080;font-weight:bold">do</span>
  ...
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Ejecutar cuando el entorno es <code>:production</code> o <code>:test</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#A60">:production</span>, <span style="color:#A60">:test</span> <span style="color:#080;font-weight:bold">do</span>
  ...
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Podés acceder a estas opciones utilizando el método <code>settings</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>configure <span style="color:#080;font-weight:bold">do</span>
  set <span style="color:#A60">:foo</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  settings.foo? <span style="color:#777"># =&gt; true</span>
  settings.foo  <span style="color:#777"># =&gt; 'bar'</span>
  ...
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Configurando%20la%20Protecci%C3%B3n%20de%20Ataques'></a>
<h3>Configurando la Protección de Ataques</h3>

<p>Sinatra usa <a href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a>
para defender a tu aplicación de los ataques más comunes. Si por algún motivo,
querés desactivar esta funcionalidad, podés hacerlo como se indica a
continuación (tené en cuenta que tu aplicación va a quedar expuesta a un
montón de vulnerabilidades bien conocidas):</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>disable <span style="color:#A60">:protection</span>
</pre></div>
</div>
</div>

<p>También es posible desactivar una única capa de defensa:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:protection</span>, <span style="color:#A60">:except</span> =&gt; <span style="color:#A60">:path_traversal</span>
</pre></div>
</div>
</div>

<p>O varias:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>set <span style="color:#A60">:protection</span>, <span style="color:#A60">:except</span> =&gt; [<span style="color:#A60">:path_traversal</span>, <span style="color:#A60">:session_hijacking</span>]
</pre></div>
</div>
</div>

<a name='Configuraciones%20Disponibles'></a>
<h3>Configuraciones Disponibles</h3>

<dl>
<dt>absolute_redirects</dt>
  <dd>
    Si está deshabilitada, Sinatra va a permitir
    redirecciones relativas, sin embargo, como consecuencia
    de esto, va a dejar de cumplir con el RFC 2616 (HTTP
    1.1), que solamente permite redirecciones absolutas.

    Activalo si tu apliación está corriendo atrás de un proxy
    inverso que no se ha configurado adecuadamente. Notá que
    el helper <tt>url</tt> va a seguir produciendo URLs absolutas, a
    menos que le pasés <tt>false</tt> como segundo parámetro.

    Deshabilitada por defecto.
  </dd>

  <dt>add_charsets</dt>
  <dd>
    Tipos mime a los que el helper <tt>content_type</tt> les
    añade automáticamente el charset.

    En general, no deberías asignar directamente esta opción,
    sino añadirle los charsets que quieras:
    <tt>settings.add_charsets &lt;&lt; "application/foobar"</tt>
  </dd>

  <dt>app_file</dt>
  <dd>
    Path del archivo principal de la aplicación, se utiliza
    para detectar la raíz del proyecto, el directorio de las
    vistas y el público, así como las plantillas inline.
  </dd>

  <dt>bind</dt>
  <dd>
    Dirección IP que utilizará el servidor integrado (por
    defecto: 0.0.0.0).
  </dd>

  <dt>default_encoding</dt>
  <dd>
    Encoding utilizado cuando el mismo se desconoce (por
    defecto <tt>"utf-8"</tt>).
  </dd>

  <dt>dump_errors</dt>
  <dd>
    Mostrar errores en el log.
  </dd>

  <dt>environment</dt>
  <dd>
    Entorno actual, por defecto toma el valor de
    <tt>ENV['RACK_ENV']</tt>, o <tt>"development"</tt> si no
    está disponible.
  </dd>

  <dt>logging</dt>
  <dd>
    Define si se utiliza el logger.
  </dd>

  <dt>lock</dt>
  <dd>
    Coloca un lock alrededor de cada petición, procesando
    solamente una por proceso.

    Habilitá esta opción si tu aplicación no es thread-safe.
    Se encuentra deshabilitada por defecto.
  </dd>

  <dt>method_override</dt>
  <dd>
    Utiliza el parámetro <tt>_method</tt> para permtir
    formularios put/delete en navegadores que no los
    soportan.
  </dd>

  <dt>port</dt>
  <dd>
    Puerto en el que escuchará el servidor integrado.
  </dd>

  <dt>prefixed_redirects</dt>
  <dd>
    Define si inserta <tt>request.script_name</tt> en las
    redirecciones cuando no se proporciona un path absoluto.
    De esta manera, cuando está habilitada,
    <tt>redirect '/foo'</tt> se comporta de la misma manera
    que <tt>redirect to('/foo')</tt>. Se encuentra
    deshabilitada por defecto.
  </dd>

  <dt>protection</dt>
  <dd>
    Define si deben activarse las protecciones para los
    ataques web más comunes. Para más detalles mirá la
    sección sobre la configuración de protección de ataques
    más arriba.
  </dd>

  <dt>public_dir</dt>
  <dd>
    Alias para <tt>public_folder</tt>, que se encuentra a
    continuación.
  </dd>

  <dt>public_folder</dt>
  <dd>
    Path del directorio desde donde se sirven los archivos
    públicos. Solo se utiliza cuando se sirven archivos
    estáticos (ver la opción <tt>static</tt>). Si no
    está presente, se infiere del valor de la opción
    <tt>app_file</tt>.
  </dd>

  <dt>reload_templates</dt>
  <dd>
    Define si se recargan las plantillas entre peticiones.

    Se encuentra activado en el entorno de desarrollo.
  </dd>

  <dt>root</dt>
  <dd>
    Path del directorio raíz del proyecto. Si no está
    presente, se infiere del valor de la opción
    <tt>app_file</tt>.
  </dd>

  <dt>raise_errors</dt>
  <dd>
    Elevar excepciones (detiene la aplicación). Se
    encuentra activada por defecto cuando el valor de
    <tt>environment</tt>  es <tt>"test"</tt>. En caso
    contrario estará desactivada.
  </dd>

  <dt>run</dt>
  <dd>
    Cuando está habilitada, Sinatra se va a encargar de
    iniciar el servidor web, no la habilités cuando estés
    usando rackup o algún otro medio.
  </dd>

  <dt>running</dt>
  <dd>
    Indica si el servidor integrado está ejecutandose, ¡no
    cambiés esta configuración!.
  </dd>

  <dt>server</dt>
  <dd>
    Servidor, o lista de servidores, para usar como servidor
    integrado. Por defecto: <tt>['thin', 'mongrel', 'webrick']</tt>,
    el orden establece la prioridad.
  </dd>

  <dt>sessions</dt>
  <dd>
    Habilita el soporte de sesiones basadas en cookies a
    través de <tt>Rack::Session::Cookie</tt>. Ver la
    sección 'Usando Sesiones' para más información.
  </dd>

  <dt>show_exceptions</dt>
  <dd>
    Muestra un stack trace en el navegador cuando ocurre una
    excepción. Se encuentra activada por defecto cuando el
    valor de <tt>environment</tt> es <tt>"development"</tt>.
    En caso contrario estará desactivada.
  </dd>

  <dt>static</dt>
  <dd>
    Define si Sinatra debe encargarse de servir archivos
    estáticos.

    Deshabilitala cuando usés un servidor capaz de
    hacerlo por sí solo, porque mejorará el
    rendimiento. Se encuentra habilitada por
    defecto en el estilo clásico y desactivado en el
    el modular.
  </dd>

  <dt>static_cache_control</dt>
  <dd>
    Cuando Sinatra está sirviendo archivos estáticos, y
    está opción está habilitada, les va a agregar encabezados
    <tt>Cache-Control</tt> a las respuestas. Para esto
    utiliza el helper <tt>cache_control</tt>. Se encuentra
    deshabilitada por defecto. Notar que es necesario
    utilizar un array cuando se asignan múltiples valores:
    <tt>set :static_cache_control, [:public, :max_age =&gt; 300]</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Path del directorio de las vistas. Si no está presente,
    se infiere del valor de la opción <tt>app_file</tt>.
  </dd>
</dl>
<a name='Entornos'></a>
<h2>Entornos</h2>

<p>Existen tres entornos (<code>environments</code>) predefinidos: <code>development</code>,
<code>production</code> y <code>test</code>. El entorno por defecto es
<code>development</code> y tiene algunas particularidades:</p>

<ul>
<li>Se recargan las plantillas entre una petición y la siguiente, a diferencia
de <code>production</code> y <code>test</code>, donde se cachean.</li>
  <li>Se instalan manejadores de errores <code>not_found</code> y <code>error</code>
especiales que muestran un stack trace en el navegador cuando son disparados.</li>
</ul>
<p>Para utilizar alguno de los otros entornos puede asignarse el valor
correspondiente a la variable de entorno <code>RACK_ENV</code>, o bien utilizar la opción
<code>-e</code> al ejecutar la aplicación:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>ruby mi_app.rb -e &lt;ENTORNO&gt;
</pre></div>
</div>
</div>

<p>Los métodos <code>development?</code>, <code>test?</code> y <code>production?</code> te permiten conocer el
entorno actual.</p>

<a name='Manejo%20de%20Errores'></a>
<h2>Manejo de Errores</h2>

<p>Los manejadores de errores se ejecutan dentro del mismo contexto que las rutas
y los filtros <code>before</code>, lo que significa que podés usar, por ejemplo,
<code>haml</code>, <code>erb</code>, <code>halt</code>, etc.</p>

<h3>No encontrado <em>(Not Found)</em>
</h3>

<p>Cuando se eleva una excepción <code>Sinatra::NotFound</code>, o el código de
estado de la respuesta es 404, el manejador <code>not_found</code> es invocado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>not_found <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">No existo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Error'></a>
<h3>Error</h3>

<p>El manejador <code>error</code> es invocado cada vez que una excepción es elevada
desde un bloque de ruta o un filtro. El objeto de la excepción se puede
obtener de la variable Rack <code>sinatra.error</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Disculpá, ocurrió un error horrible - </span><span style="color:#710">'</span></span> + env[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra.error</span><span style="color:#710">'</span></span>].name
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Errores personalizados:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#036;font-weight:bold">MiErrorPersonalizado</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Lo que pasó fue...</span><span style="color:#710">'</span></span> + env[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra.error</span><span style="color:#710">'</span></span>].message
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Entonces, si pasa esto:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  raise <span style="color:#036;font-weight:bold">MiErrorPersonalizado</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">algo malo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Obtenés esto:</p>

<p>Lo que pasó fue… algo malo</p>

<p>También, podés instalar un manejador de errores para un código de estado:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#00D">403</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Acceso prohibido</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/secreto</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#00D">403</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>O un rango:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>error <span style="color:#00D">400</span>..<span style="color:#00D">510</span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Boom</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Sinatra instala manejadores <code>not_found</code> y <code>error</code> especiales
cuando se ejecuta dentro del entorno de desarrollo “development”.</p>

<a name='Rack%20Middleware'></a>
<h2>Rack Middleware</h2>

<p>Sinatra corre sobre Rack[http://rack.rubyforge.org/], una interfaz minimalista
que es un estándar para frameworks webs escritos en Ruby. Una de las
capacidades más interesantes de Rack para los desarrolladores de aplicaciones
es el soporte de “middleware” – componentes que se ubican entre el servidor y
tu aplicación, supervisando y/o manipulando la petición/respuesta HTTP para
proporcionar varios tipos de funcionalidades comunes.</p>

<p>Sinatra hace muy sencillo construir tuberías de Rack middleware a través del
método top-level <code>use</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mi_middleware_personalizado</span><span style="color:#710">'</span></span>

use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Lint</span>
use <span style="color:#036;font-weight:bold">MiMiddlewarePersonalizado</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/hola</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola Mundo</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Las semánticas de <code>use</code> son idénticas a las definidas para el DSL
Rack::Builder[http://rack.rubyforge.org/doc/classes/Rack/Builder.html] (más
frecuentemente usado desde archivos rackup). Por ejemplo, el método <code>use</code>
acepta argumentos múltiples/variables así como bloques:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>use <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Auth</span>::<span style="color:#036;font-weight:bold">Basic</span> <span style="color:#080;font-weight:bold">do</span> |nombre_de_usuario, password|
  nombre_de_usuario == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin</span><span style="color:#710">'</span></span> &amp;&amp; password == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">secreto</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Rack es distribuido con una variedad de middleware estándar para logging,
debugging, enrutamiento URL, autenticación, y manejo de sesiones. Sinatra
usa muchos de estos componentes automáticamente de acuerdo a su configuración
para que típicamente no tengas que usarlas (con <code>use</code>) explícitamente.</p>

<p>Podés encontrar middleware útil en
<a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>,
<a href="https://github.com/rack/rack-contrib#readme">rack-contrib</a>,
con <a href="http://coderack.org/">CodeRack</a> o en la
<a href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>.</p>

<a name='Pruebas'></a>
<h2>Pruebas</h2>

<p>Las pruebas para las aplicaciones Sinatra pueden ser escritas utilizando
cualquier framework o librería de pruebas basada en Rack. Se recomienda usar
<a href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mi_app_sinatra</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test/unit</span><span style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rack/test</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiAppTest</span> &lt; <span style="color:#036;font-weight:bold">Test</span>::<span style="color:#036;font-weight:bold">Unit</span>::<span style="color:#036;font-weight:bold">TestCase</span>
  include <span style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">Test</span>::<span style="color:#036;font-weight:bold">Methods</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">app</span>
    <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Application</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">test_mi_defecto</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
    assert_equal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola Mundo!</span><span style="color:#710">'</span></span>, last_response.body
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">test_con_parametros</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/saludar</span><span style="color:#710">'</span></span>, <span style="color:#A60">:name</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Franco</span><span style="color:#710">'</span></span>
    assert_equal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola Frank!</span><span style="color:#710">'</span></span>, last_response.body
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">test_con_entorno_rack</span>
    get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>, {}, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">HTTP_USER_AGENT</span><span style="color:#710">'</span></span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Songbird</span><span style="color:#710">'</span></span>
    assert_equal <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Estás usando Songbird!</span><span style="color:#710">"</span></span>, last_response.body
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Sinatra::Base%20-%20Middleware,%20Librer%C3%ADas,%20y%20Aplicaciones%20Modulares'></a>
<h2>Sinatra::Base - Middleware, Librerías, y Aplicaciones Modulares</h2>

<p>Definir tu aplicación en el top-level funciona bien para micro-aplicaciones
pero trae inconvenientes considerables a la hora de construir componentes
reutilizables como Rack middleware, Rails metal, simple librerías con un
componente de servidor, o incluso extensiones de Sinatra. El DSL de top-level
asume una configuración apropiada para micro-aplicaciones (por ejemplo, un
único archivo de aplicación, los directorios <code>./public</code> y
<code>./views</code>, logging, página con detalles de excepción, etc.). Ahí es
donde <code>Sinatra::Base</code> entra en el juego:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  set <span style="color:#A60">:sessions</span>, <span style="color:#069">true</span>
  set <span style="color:#A60">:foo</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bar</span><span style="color:#710">'</span></span>

  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola Mundo!</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Las subclases de <code>Sinatra::Base</code> tienen disponibles exactamente los
mismos métodos que los provistos por el DSL de top-level. La mayoría de las
aplicaciones top-level se pueden convertir en componentes
<code>Sinatra::Base</code> con dos modificaciones:</p>

<ul>
<li>Tu archivo debe requerir <code>sinatra/base</code> en lugar de <code>sinatra</code>; de otra
manera, todos los métodos del DSL de sinatra son importados dentro del
espacio de nombres principal.</li>
  <li>Poné las rutas, manejadores de errores, filtros y opciones de tu aplicación
en una subclase de <code>Sinatra::Base</code>.</li>
</ul>
<p><code>Sinatra::Base</code> es una pizarra en blanco. La mayoría de las opciones están
desactivadas por defecto, incluyendo el servidor incorporado. Mirá
<a href="http://sinatra.github.com/configuration.html">Opciones y Configuraciones</a>
para detalles sobre las opciones disponibles y su comportamiento.</p>

<a name='Estilo%20Modular%20vs.%20Cl%C3%A1sico'></a>
<h3>Estilo Modular vs. Clásico</h3>

<p>Contrariamente a la creencia popular, no hay nada de malo con el estilo clásico.
Si se ajusta a tu aplicación, no es necesario que la cambies a una modular.</p>

<p>Las desventaja de usar el estilo clásico en lugar del modular consiste en que
solamente podés tener una aplicación Sinatra por proceso Ruby. Si tenés
planificado usar más, cambiá al estilo modular. Al mismo tiempo, tené en
cuenta que no hay ninguna razón por la cuál no puedas mezclar los estilos
clásico y modular.</p>

<p>A continuación se detallan las diferencias (sutiles) entre las configuraciones
de ambos estilos:</p>

<table>
<tr>
<td>Configuración</td>
    <td>Clásica</td>
    <td>Modular</td>
  </tr>
<tr>
<td>app_file</td>
    <td>archivo que carga sinatra</td>
    <td>archivo con la subclase de Sinatra::Base</td>
  </tr>
<tr>
<td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
  </tr>
<tr>
<td>logging</td>
    <td>true</td>
    <td>false</td>
  </tr>
<tr>
<td>method_override</td>
    <td>true</td>
    <td>false</td>
  </tr>
<tr>
<td>inline_templates</td>
    <td>true</td>
    <td>false</td>
  </tr>
<tr>
<td>static</td>
    <td>true</td>
    <td>false</td>
  </tr>
</table>
<a name='Sirviendo%20una%20Aplicaci%C3%B3n%20Modular'></a>
<h3>Sirviendo una Aplicación Modular</h3>

<p>Las dos opciones más comunes para iniciar una aplicación modular son, iniciarla
activamente con <code>run!</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># mi_app.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  <span style="color:#777"># ... código de la app  ...</span>

  <span style="color:#777"># iniciar el servidor si el archivo fue ejecutado directamente</span>
  run! <span style="color:#080;font-weight:bold">if</span> app_file == <span style="color:#d70">$0</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Iniciar con:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>ruby mi_app.rb
</pre></div>
</div>
</div>

<p>O, con un archivo <code>config.ru</code>, que permite usar cualquier handler Rack:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># config.ru</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./mi_app</span><span style="color:#710">'</span></span>
run <span style="color:#036;font-weight:bold">MiApp</span>
</pre></div>
</div>
</div>

<p>Después ejecutar:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>rackup -p 4567
</pre></div>
</div>
</div>

<a name='Usando%20una%20Aplicaci%C3%B3n%20Cl%C3%A1sica%20con%20un%20Archivo%20config.ru'></a>
<h3>Usando una Aplicación Clásica con un Archivo config.ru</h3>

<p>Escribí el archivo de tu aplicación:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># app.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola mundo!</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Y el <code>config.ru</code> correspondiente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./app</span><span style="color:#710">'</span></span>
run <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Application</span>
</pre></div>
</div>
</div>

<a name='%C2%BFCu%C3%A1ndo%20Usar%20config.ru?'></a>
<h3>¿Cuándo Usar config.ru?</h3>

<p>Indicadores de que probablemente querés usar <code>config.ru</code>:</p>

<ul>
<li>Querés realizar el deploy con un hanlder Rack distinto (Passenger, Unicorn,
Heroku, …).</li>
  <li>Querés usar más de una subclase de <code>Sinatra::Base</code>.</li>
  <li>Querés usar Sinatra únicamente para middleware, pero no como un endpoint.</li>
</ul>
<p><b>No hay necesidad de utilizar un archivo <code>config.ru</code> exclusivamente
porque tenés una aplicación modular, y no necesitás una aplicación modular para
iniciarla con <code>config.ru</code>.</b></p>

<a name='Utilizando%20Sinatra%20como%20Middleware'></a>
<h3>Utilizando Sinatra como Middleware</h3>

<p>Sinatra no solo es capaz de usar otro Rack middleware, sino que a su vez,
cualquier aplicación Sinatra puede ser agregada delante de un endpoint Rack
como middleware. Este endpoint puede ser otra aplicación Sinatra, o cualquier
aplicación basada en Rack (Rails/Ramaze/Camping/…):</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PantallaDeLogin</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  enable <span style="color:#A60">:sessions</span>

  get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/login</span><span style="color:#710">'</span></span>) { haml <span style="color:#A60">:login</span> }

  post(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/login</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#080;font-weight:bold">if</span> params[<span style="color:#A60">:nombre</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin</span><span style="color:#710">'</span></span> &amp;&amp; params[<span style="color:#A60">:password</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin</span><span style="color:#710">'</span></span>
      session[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nombre_de_usuario</span><span style="color:#710">'</span></span>] = params[<span style="color:#A60">:nombre</span>]
    <span style="color:#080;font-weight:bold">else</span>
      redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/login</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  <span style="color:#777"># el middleware se ejecutará antes que los filtros</span>
  use <span style="color:#036;font-weight:bold">PantallaDeLogin</span>

  before <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#080;font-weight:bold">unless</span> session[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nombre_de_usuario</span><span style="color:#710">'</span></span>]
      halt <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Acceso denegado, por favor &lt;a href='/login'&gt;iniciá sesión&lt;/a&gt;.</span><span style="color:#710">"</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

  get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Hola </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>session[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">nombre_de_usuario</span><span style="color:#710">'</span></span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">.</span><span style="color:#710">"</span></span> }
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<a name='Creaci%C3%B3n%20Din%C3%A1mica%20de%20Aplicaciones'></a>
<h3>Creación Dinámica de Aplicaciones</h3>

<p>Puede que en algunas ocasiones quieras crear nuevas aplicaciones en
tiempo de ejecución sin tener que asignarlas a una constante. Para
esto tenés <code>Sinatra.new</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>
mi_app = <span style="color:#036;font-weight:bold">Sinatra</span>.new { get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">hola</span><span style="color:#710">"</span></span> } }
mi_app.run!
</pre></div>
</div>
</div>

<p>Acepta como argumento opcional una aplicación desde la que se
heredará:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#777"># config.ru</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>

controller = <span style="color:#036;font-weight:bold">Sinatra</span>.new <span style="color:#080;font-weight:bold">do</span>
  enable <span style="color:#A60">:logging</span>
  helpers <span style="color:#036;font-weight:bold">MisHelpers</span>
<span style="color:#080;font-weight:bold">end</span>

map(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/a</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">do</span>
  run <span style="color:#036;font-weight:bold">Sinatra</span>.new(controller) { get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span> } }
<span style="color:#080;font-weight:bold">end</span>

map(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/b</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">do</span>
  run <span style="color:#036;font-weight:bold">Sinatra</span>.new(controller) { get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">b</span><span style="color:#710">'</span></span> } }
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Construir aplicaciones de esta forma resulta especialmente útil para
testear extensiones Sinatra o para usar Sinatra en tus librerías.</p>

<p>Por otro lado, hace extremadamente sencillo usar Sinatra como
middleware:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra/base</span><span style="color:#710">'</span></span>

use <span style="color:#036;font-weight:bold">Sinatra</span> <span style="color:#080;font-weight:bold">do</span>
  get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>) { ... }
<span style="color:#080;font-weight:bold">end</span>

run <span style="color:#036;font-weight:bold">ProyectoRails</span>::<span style="color:#036;font-weight:bold">Application</span>
</pre></div>
</div>
</div>

<a name='%C3%81mbitos%20y%20Ligaduras'></a>
<h2>Ámbitos y Ligaduras</h2>

<p>El ámbito en el que te encontrás determina que métodos y variables están
disponibles.</p>

<a name='%C3%81mbito%20de%20Aplicaci%C3%B3n/Clase'></a>
<h3>Ámbito de Aplicación/Clase</h3>

<p>Cada aplicación Sinatra es una subclase de <code>Sinatra::Base</code>. Si estás
usando el DSL de top-level (<code>require 'sinatra'</code>), entonces esta clase es
<code>Sinatra::Application</code>, de otra manera es la subclase que creaste
explícitamente. Al nivel de la clase tenés métodos como <code>get</code> o <code>before</code>, pero
no podés acceder a los objetos <code>request</code> o <code>session</code>, ya que hay una única
clase de la aplicación para todas las peticiones.</p>

<p>Las opciones creadas utilizando <code>set</code> son métodos al nivel de la clase:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  <span style="color:#777"># Ey, estoy en el ámbito de la aplicación!</span>
  set <span style="color:#A60">:foo</span>, <span style="color:#00D">42</span>
  foo <span style="color:#777"># =&gt; 42</span>

  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/foo</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Hey, ya no estoy en el ámbito de la aplicación!</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Tenés la ligadura al ámbito de la aplicación dentro de:</p>

<ul>
<li>El cuerpo de la clase de tu aplicación</li>
  <li>Métodos definidos por extensiones</li>
  <li>El bloque pasado a <code>helpers</code>
</li>
  <li>Procs/bloques usados como el valor para <code>set</code>
</li>
</ul>
<p>Este ámbito puede alcanzarse de las siguientes maneras:</p>

<ul>
<li>A través del objeto pasado a los bloques de configuración (<code>configure { |c| ...}</code>)</li>
  <li>Llamando a <code>settings</code> desde dentro del ámbito de la petición</li>
</ul>
<a name='%C3%81mbito%20de%20Petici%C3%B3n/Instancia'></a>
<h3>Ámbito de Petición/Instancia</h3>

<p>Para cada petición entrante, una nueva instancia de la clase de tu aplicación
es creada y todos los bloques de rutas son ejecutados en ese ámbito. Desde este
ámbito podés acceder a los objetos <code>request</code> y <code>session</code> o llamar a los métodos
de renderización como <code>erb</code> o <code>haml</code>. Podés acceder al ámbito de la aplicación
desde el ámbito de la petición utilizando <code>settings</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MiApp</span> &lt; <span style="color:#036;font-weight:bold">Sinatra</span>::<span style="color:#036;font-weight:bold">Base</span>
  <span style="color:#777"># Ey, estoy en el ámbito de la aplicación!</span>
  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/definir_ruta/:nombre</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#777"># Ámbito de petición para '/definir_ruta/:nombre'</span>
    <span style="color:#33B">@valor</span> = <span style="color:#00D">42</span>

    settings.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:nombre</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>) <span style="color:#080;font-weight:bold">do</span>
      <span style="color:#777"># Ámbito de petición para "/#{params[:nombre]}"</span>
      <span style="color:#33B">@valor</span> <span style="color:#777"># =&gt; nil (no es la misma petición)</span>
    <span style="color:#080;font-weight:bold">end</span>

    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Ruta definida!</span><span style="color:#710">"</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
</div>

<p>Tenés la ligadura al ámbito de la petición dentro de:</p>

<ul>
<li>bloques pasados a get/head/post/put/delete/options</li>
  <li>filtros before/after</li>
  <li>métodos ayudantes</li>
  <li>plantillas/vistas</li>
</ul>
<a name='%C3%81mbito%20de%20Delegaci%C3%B3n'></a>
<h3>Ámbito de Delegación</h3>

<p>El ámbito de delegación solo reenvía métodos al ámbito de clase. De cualquier
manera, no se comporta 100% como el ámbito de clase porque no tenés la ligadura
de la clase: únicamente métodos marcados explícitamente para delegación están
disponibles y no compartís variables/estado con el ámbito de clase (léase:
tenés un <code>self</code> diferente). Podés agregar delegaciones de método llamando a
<code>Sinatra::Delegator.delegate :nombre_del_metodo</code>.</p>

<p>Tenés la ligadura al ámbito de delegación dentro de:</p>

<ul>
<li>La ligadura del top-level, si hiciste <code>require "sinatra"</code>
</li>
  <li>Un objeto extendido con el mixin <code>Sinatra::Delegator</code>
</li>
</ul>
<p>Pegale una mirada al código: acá está el
<a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633">Sinatra::Delegator mixin</a>
que <a href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">extiende el objeto main</a>.</p>

<a name='L%C3%ADnea%20de%20Comandos'></a>
<h2>Línea de Comandos</h2>

<p>Las aplicaciones Sinatra pueden ser ejecutadas directamente:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>ruby miapp.rb [-h] [-x] [-e ENTORNO] [-p PUERTO] [-o HOST] [-s MANEJADOR]
</pre></div>
</div>
</div>

<p>Las opciones son:</p>

<pre><code>-h # ayuda
-p # asigna el puerto (4567 es usado por defecto)
-o # asigna el host (0.0.0.0 es usado por defecto)
-e # asigna el entorno (development es usado por defecto)
-s # especifica el servidor/manejador rack (thin es usado por defecto)
-x # activa el mutex lock (está desactivado por defecto)
</code></pre>

<a name='Versiones%20de%20Ruby%20Soportadas'></a>
<h2>Versiones de Ruby Soportadas</h2>

<p>Las siguientes versiones de Ruby son soportadas oficialmente:</p>

<dl>
<dt>Ruby 1.8.7</dt>
  <dd>
    1.8.7 es soportado completamente. Sin embargo, si no hay nada que te lo
    prohíba, te recomendamos que usés 1.9.2 o cambies a JRuby o Rubinius. No se
    dejará de dar soporte a 1.8.7 hasta Sinatra 2.0 y Ruby 2.0, aunque si se
    libera la versión 1.8.8 de Ruby las cosas podrían llegar a cambiar. Sin
    embargo, que eso ocurra es muy poco probable, e incluso el caso de que lo
    haga, puede que se siga dando soporte a 1.8.7. <b>Hemos dejado de soportar
    Ruby 1.8.6.</b> Si querés ejecutar Sinatra sobre 1.8.6, podés utilizar la
    versión 1.2, pero tené en cuenta que una vez que Sinatra 1.4.0 sea liberado,
    ya no se corregirán errores por más que se reciban reportes de los mismos.
  </dd>

  <dt>Ruby 1.9.2</dt>
  <dd>
    1.9.2 es soportado y recomendado. No usés 1.9.2p0, porque se producen fallos
    de segmentación cuando se ejecuta Sinatra. El soporte se mantendrá al menos
    hasta que se libere la versión 1.9.4/2.0 de Ruby. El soporte para la última
    versión de la serie 1.9 se mantendrá mientras lo haga el core team de Ruby.
  </dd>

  <dt>Ruby 1.9.3</dt>
  <dd>
    1.9.3 es soportado y recomendado. Tené en cuenta que el cambio a 1.9.3 desde
    una versión anterior va a invalidar todas las sesiones.
  </dd>

  <dt>Rubinius</dt>
  <dd>
    Rubinius es soportado oficialmente (Rubinius &gt;= 1.2.4). Todo funciona
    correctamente, incluyendo los lenguajes de plantillas. La próxima versión,
    2.0, también es soportada, incluyendo el modo 1.9.
  </dd>

  <dt>JRuby</dt>
  <dd>
    JRuby es soportado oficialmente (JRuby &gt;= 1.6.7). No se conocen problemas
    con librerías de plantillas de terceras partes. Sin embargo, si elegís usar
    JRuby, deberías examinar sus Rack handlers porque el servidor web Thin no es
    soportado completamente. El soporte de JRuby para extensiones C se encuentra
    en una etapa experimental, sin embargo, de momento solamente RDiscount,
    Redcarpet, RedCloth y Yajl, así como Thin y Mongrel se ven afectadas.
  </dd>
</dl>
<p>Siempre le prestamos atención a las nuevas versiones de Ruby.</p>

<p>Las siguientes implementaciones de Ruby no se encuentran soportadas
oficialmente. De cualquier manera, pueden ejecutar Sinatra:</p>

<ul>
<li>Versiones anteriores de JRuby y Rubinius</li>
  <li>Ruby Enterprise Edition</li>
  <li>MacRuby, Maglev e IronRuby</li>
  <li>Ruby 1.9.0 y 1.9.1 (pero no te recomendamos que los usés)</li>
</ul>
<p>No estar soportada oficialmente, significa que si las cosas solamente se rompen
ahí y no en una plataforma soportada, asumimos que no es nuestro problema sino
el suyo.</p>

<p>Nuestro servidor CI también se ejecuta sobre ruby-head (que será la próxima
versión 2.0.0) y la rama 1.9.4. Como están en movimiento constante, no podemos
garantizar nada. De todas formas, podés contar con que tanto 1.9.4-p0 como
2.0.0-p0 sea soportadas.</p>

<p>Sinatra debería funcionar en cualquier sistema operativo soportado por la
implementación de Ruby elegida.</p>

<p>En este momento, no vas a poder ejecutar Sinatra en Cardinal, SmallRuby,
BlueRuby o cualquier versión de Ruby anterior a 1.8.7.</p>

<a name='A%20la%20Vanguardia'></a>
<h2>A la Vanguardia</h2>

<p>Si querés usar el código de Sinatra más reciente, sentite libre de ejecutar
tu aplicación sobre la rama master, en general es bastante estable.</p>

<p>También liberamos prereleases de vez en cuando, así, podés hacer</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>gem install sinatra --pre
</pre></div>
</div>
</div>

<p>Para obtener algunas de las últimas características.</p>

<a name='Con%20Bundler'></a>
<h3>Con Bundler</h3>

<p>Esta es la manera recomendada para ejecutar tu aplicación sobre la última
versión de Sinatra usando <a href="http://gembundler.com/">Bundler</a>.</p>

<p>Primero, instalá bundler si no lo hiciste todavía:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>gem install bundler
</pre></div>
</div>
</div>

<p>Después, en el directorio de tu proyecto, creá un archivo <code>Gemfile</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>source <span style="color:#A60">:rubygems</span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sinatra</span><span style="color:#710">'</span></span>, <span style="color:#A60">:git</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">git://github.com/sinatra/sinatra.git</span><span style="color:#710">"</span></span>

<span style="color:#777"># otras dependencias</span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haml</span><span style="color:#710">'</span></span>                    <span style="color:#777"># por ejemplo, si usás haml</span>
gem <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">activerecord</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">~&gt; 3.0</span><span style="color:#710">'</span></span>  <span style="color:#777"># quizás también necesités ActiveRecord 3.x</span>
</pre></div>
</div>
</div>

<p>Tené en cuenta que tenés que listar todas las dependencias directas de tu
aplicación. No es necesario listar las dependencias de Sinatra (Rack y Tilt)
porque Bundler las agrega directamente.</p>

<p>Ahora podés arrancar tu aplicación así:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>bundle exec ruby miapp.rb
</pre></div>
</div>
</div>

<a name='Con%20Git'></a>
<h3>Con Git</h3>

<p>Cloná el repositorio localmente y ejecutá tu aplicación, asegurándote que el
directorio <code>sinatra/lib</code> esté en el <code>$LOAD_PATH</code>:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>cd miapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib miapp.rb
</pre></div>
</div>
</div>

<p>Para actualizar el código fuente de Sinatra en el futuro:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>cd miapp/sinatra
git pull
</pre></div>
</div>
</div>

<a name='Instalaci%C3%B3n%20Global'></a>
<h3>Instalación Global</h3>

<p>Podés construir la gem vos mismo:</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</pre></div>
</div>
</div>

<p>Si instalás tus gems como root, el último paso debería ser</p>

<div>
<div class="CodeRay">
  <div class="code"><pre>sudo rake install
</pre></div>
</div>
</div>

<a name='Versionado'></a>
<h2>Versionado</h2>

<p>Sinatra utiliza el <a href="http://semver.org/">Versionado Semántico</a>,
siguiendo las especificaciones SemVer y SemVerTag.</p>

<a name='Lecturas%20Recomendadas'></a>
<h2>Lecturas Recomendadas</h2>

<ul>
<li>
<a href="http://www.sinatrarb.com/">Sito web del proyecto</a> - Documentación
adicional, noticias, y enlaces a otros recursos.</li>
  <li>
<a href="http://www.sinatrarb.com/contributing">Contribuyendo</a> - ¿Encontraste un
error?. ¿Necesitás ayuda?. ¿Tenés un parche?.</li>
  <li><a href="http://github.com/sinatra/sinatra/issues">Seguimiento de problemas</a></li>
  <li><a href="http://twitter.com/sinatra">Twitter</a></li>
  <li><a href="http://groups.google.com/group/sinatrarb/topics">Lista de Correo</a></li>
  <li>
<a href="irc://chat.freenode.net/#sinatra">IRC: #sinatra</a> en http://freenode.net</li>
  <li>
<a href="http://sinatra-book.gittr.com">Sinatra Book</a> Tutorial (en inglés).</li>
  <li>
<a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a> Recetas contribuidas
por la comunidad (en inglés).</li>
  <li>Documentación de la API para la
<a href="http://rubydoc.info/gems/sinatra">última versión liberada</a> o para la
<a href="http://rubydoc.info/github/sinatra/sinatra">rama de desarrollo actual</a>
en http://rubydoc.info/</li>
  <li><a href="http://travis-ci.org/sinatra/sinatra">Servidor de CI</a></li>
</ul>
</body></html>
