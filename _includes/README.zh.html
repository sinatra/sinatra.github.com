<div class='toc'>
	<ol class='level-1'>
		<li><a href='#&%2336335;&%2330001;'>&#36335;&#30001;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2326465;&%2320214;'>&#26465;&#20214;</a></li>
			<li><a href='#&%2336820;&%2322238;&%2320540;'>&#36820;&#22238;&#20540;</a></li>
			<li><a href='#&%2333258;&%2323450;&%2320041;&%2336335;&%2330001;&%2321305;&%2337197;&%2322120;'>&#33258;&#23450;&#20041;&#36335;&#30001;&#21305;&#37197;&#22120;</a></li>
		</ol>
		<li><a href='#&%2338745;&%2324577;&%2325991;&%2320214;'>&#38745;&#24577;&#25991;&#20214;</a></li>
		<li><a href='#&%2335270;&%2322270;%20/%20&%2327169;&%2326495;'>&#35270;&#22270; / &#27169;&#26495;</a></li>
		<ol class='level-2'>
			<li><a href='#Haml&%2327169;&%2326495;'>Haml&#27169;&#26495;</a></li>
			<li><a href='#Erb&%2327169;&%2326495;'>Erb&#27169;&#26495;</a></li>
			<li><a href='#Erubis'>Erubis</a></li>
			<li><a href='#Builder%20&%2327169;&%2326495;'>Builder &#27169;&#26495;</a></li>
			<li><a href='#Nokogiri%20&%2327169;&%2326495;'>Nokogiri &#27169;&#26495;</a></li>
			<li><a href='#Sass%20&%2327169;&%2326495;'>Sass &#27169;&#26495;</a></li>
			<li><a href='#Scss%20&%2327169;&%2326495;'>Scss &#27169;&#26495;</a></li>
			<li><a href='#Less%20&%2327169;&%2326495;'>Less &#27169;&#26495;</a></li>
			<li><a href='#Liquid%20&%2327169;&%2326495;'>Liquid &#27169;&#26495;</a></li>
			<li><a href='#Markdown%20&%2327169;&%2326495;'>Markdown &#27169;&#26495;</a></li>
			<li><a href='#Textile%20&%2327169;&%2326495;'>Textile &#27169;&#26495;</a></li>
			<li><a href='#RDoc%20&%2327169;&%2326495;'>RDoc &#27169;&#26495;</a></li>
			<li><a href='#Radius%20&%2327169;&%2326495;'>Radius &#27169;&#26495;</a></li>
			<li><a href='#Markaby%20&%2327169;&%2326495;'>Markaby &#27169;&#26495;</a></li>
			<li><a href='#Slim%20&%2327169;&%2326495;'>Slim &#27169;&#26495;</a></li>
			<li><a href='#Creole%20&%2327169;&%2326495;'>Creole &#27169;&#26495;</a></li>
			<li><a href='#CoffeeScript%20&%2327169;&%2326495;'>CoffeeScript &#27169;&#26495;</a></li>
			<li><a href='#&%2323884;&%2320837;&%2327169;&%2326495;&%2323383;&%2331526;&%2320018;'>&#23884;&#20837;&#27169;&#26495;&#23383;&#31526;&#20018;</a></li>
			<li><a href='#&%2322312;&%2327169;&%2326495;&%2320013;&%2335775;&%2338382;&%2321464;&%2337327;'>&#22312;&#27169;&#26495;&#20013;&#35775;&#38382;&#21464;&#37327;</a></li>
			<li><a href='#&%2320869;&%2332852;&%2327169;&%2326495;'>&#20869;&#32852;&#27169;&#26495;</a></li>
			<li><a href='#&%2320855;&%2321517;&%2327169;&%2326495;'>&#20855;&#21517;&#27169;&#26495;</a></li>
			<li><a href='#&%2320851;&%2332852;&%2325991;&%2320214;&%2325193;&%2323637;&%2321517;'>&#20851;&#32852;&#25991;&#20214;&#25193;&#23637;&#21517;</a></li>
			<li><a href='#&%2328155;&%2321152;&%2320320;&%2333258;&%2324049;&%2330340;&%2327169;&%2329256;&%2324341;&%2325806;'>&#28155;&#21152;&#20320;&#33258;&#24049;&#30340;&#27169;&#29256;&#24341;&#25806;</a></li>
		</ol>
		<li><a href='#&%2336807;&%2328388;&%2322120;'>&#36807;&#28388;&#22120;</a></li>
		<li><a href='#&%2336741;&%2321161;&%2326041;&%2327861;'>&#36741;&#21161;&#26041;&#27861;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2320351;&%2329992;%20Sessions'>&#20351;&#29992; Sessions</a></li>
			<li><a href='#&%2325346;&%2336215;'>&#25346;&#36215;</a></li>
			<li><a href='#&%2335753;&%2336335;'>&#35753;&#36335;</a></li>
			<li><a href='#&%2335302;&%2321457;&%2321478;&%2319968;&%2320010;&%2336335;&%2330001;'>&#35302;&#21457;&#21478;&#19968;&#20010;&#36335;&#30001;</a></li>
			<li><a href='#&%2335774;&%2323450;%20&%2328040;&%2324687;&%2320307;&%2365292;&%2329366;&%2324577;&%2330721;&%2321644;&%2328040;&%2324687;&%2322836;'>&#35774;&#23450; &#28040;&#24687;&#20307;&#65292;&#29366;&#24577;&#30721;&#21644;&#28040;&#24687;&#22836;</a></li>
			<li><a href='#&%2323186;&%2320307;&%2331867;&%2322411;'>&#23186;&#20307;&#31867;&#22411;</a></li>
			<li><a href='#&%2329983;&%2325104;%20URL'>&#29983;&#25104; URL</a></li>
			<li><a href='#&%2327983;&%2335272;&%2322120;&%2337325;&%2323450;&%2321521;'>&#27983;&#35272;&#22120;&#37325;&#23450;&#21521;</a></li>
			<li><a href='#&%2332531;&%2323384;&%2325511;&%2321046;'>&#32531;&#23384;&#25511;&#21046;</a></li>
			<li><a href='#&%2321457;&%2336865;&%2325991;&%2320214;'>&#21457;&#36865;&#25991;&#20214;</a></li>
			<li><a href='#&%2335775;&%2338382;&%2335831;&%2327714;&%2323545;&%2335937;'>&#35775;&#38382;&#35831;&#27714;&#23545;&#35937;</a></li>
			<li><a href='#&%2338468;&%2320214;'>&#38468;&#20214;</a></li>
			<li><a href='#&%2326597;&%2325214;&%2327169;&%2326495;&%2325991;&%2320214;'>&#26597;&#25214;&#27169;&#26495;&#25991;&#20214;</a></li>
		</ol>
		<li><a href='#&%2337197;&%2332622;'>&#37197;&#32622;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2321487;&%2336873;&%2330340;&%2335774;&%2332622;'>&#21487;&#36873;&#30340;&#35774;&#32622;</a></li>
		</ol>
		<li><a href='#&%2338169;&%2335823;&%2322788;&%2329702;'>&#38169;&#35823;&#22788;&#29702;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2326410;&%2325214;&%2321040;'>&#26410;&#25214;&#21040;</a></li>
			<li><a href='#&%2338169;&%2335823;'>&#38169;&#35823;</a></li>
		</ol>
		<li><a href='#Rack%20&%2320013;&%2338388;&%2320214;'>Rack &#20013;&#38388;&#20214;</a></li>
		<li><a href='#&%2327979;&%2335797;'>&#27979;&#35797;</a></li>
		<li><a href='#Sinatra::Base%20-%20&%2320013;&%2338388;&%2320214;&%2365292;&%2331243;&%2324207;&%2324211;&%2321644;&%2327169;&%2322359;&%2321270;&%2324212;&%2329992;'>Sinatra::Base - &#20013;&#38388;&#20214;&#65292;&#31243;&#24207;&#24211;&#21644;&#27169;&#22359;&#21270;&#24212;&#29992;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2327169;&%2322359;&%2321270;%20vs.%20&%2320256;&%2332479;&%2330340;&%2326041;&%2324335;'>&#27169;&#22359;&#21270; vs. &#20256;&#32479;&#30340;&#26041;&#24335;</a></li>
			<li><a href='#&%2336816;&%2334892;&%2319968;&%2320010;&%2327169;&%2322359;&%2321270;&%2324212;&%2329992;'>&#36816;&#34892;&#19968;&#20010;&#27169;&#22359;&#21270;&#24212;&#29992;</a></li>
			<li><a href='#&%2320351;&%2329992;config.ru&%2336816;&%2334892;&%2320256;&%2332479;&%2326041;&%2324335;&%2330340;&%2324212;&%2329992;'>&#20351;&#29992;config.ru&#36816;&#34892;&#20256;&#32479;&#26041;&#24335;&#30340;&#24212;&#29992;</a></li>
			<li><a href='#&%2320160;&%2320040;&%2326102;&%2320505;&%2329992;%20config.ru?'>&#20160;&#20040;&#26102;&#20505;&#29992; config.ru?</a></li>
			<li><a href='#&%2325226;Sinatra&%2324403;&%2325104;&%2320013;&%2338388;&%2320214;&%2326469;&%2320351;&%2329992;'>&#25226;Sinatra&#24403;&#25104;&#20013;&#38388;&#20214;&#26469;&#20351;&#29992;</a></li>
		</ol>
		<li><a href='#&%2321464;&%2337327;&%2322495;&%2321644;&%2332465;&%2323450;'>&#21464;&#37327;&#22495;&#21644;&#32465;&#23450;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2324212;&%2329992;/&%2331867;%20&%2321464;&%2337327;&%2322495;'>&#24212;&#29992;/&#31867; &#21464;&#37327;&#22495;</a></li>
			<li><a href='#&%2335831;&%2327714;/&%2323454;&%2320363;%20&%2321464;&%2337327;&%2322495;'>&#35831;&#27714;/&#23454;&#20363; &#21464;&#37327;&#22495;</a></li>
			<li><a href='#&%2320195;&%2329702;&%2321464;&%2337327;&%2322495;'>&#20195;&#29702;&#21464;&#37327;&#22495;</a></li>
		</ol>
		<li><a href='#&%2321629;&%2320196;&%2334892;'>&#21629;&#20196;&#34892;</a></li>
		<li><a href='#&%2324517;&%2335201;&%2326465;&%2320214;'>&#24517;&#35201;&#26465;&#20214;</a></li>
		<li><a href='#&%2332039;&%2336861;&%2321069;&%2327839;'>&#32039;&#36861;&#21069;&#27839;</a></li>
		<ol class='level-2'>
			<li><a href='#&%2336890;&%2336807;Bundler'>&#36890;&#36807;Bundler</a></li>
			<li><a href='#&%2320351;&%2329992;&%2333258;&%2324049;&%2330340;'>&#20351;&#29992;&#33258;&#24049;&#30340;</a></li>
			<li><a href='#&%2320840;&%2323616;&%2323433;&%2335013;'>&#20840;&#23616;&#23433;&#35013;</a></li>
		</ol>
		<li><a href='#&%2326356;&%2322810;'>&#26356;&#22810;</a></li>
	</ol>
</div>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>

<p><em>&#27880;&#65306;&#26412;&#25991;&#26723;&#20165;&#20165;&#26159;&#33521;&#25991;&#29256;&#30340;&#32763;&#35793;&#65292;&#20250;&#20986;&#29616;&#20869;&#23481;&#27809;&#26377;&#21450;&#26102;&#26356;&#26032;&#30340;&#24773;&#20917;&#21457;&#29983;&#12290;
&#22914;&#26377;&#19981;&#19968;&#33268;&#30340;&#22320;&#26041;&#65292;&#35831;&#20197;&#33521;&#25991;&#29256;&#20026;&#20934;&#12290;</em></p>

<p>Sinatra&#26159;&#19968;&#20010;&#22522;&#20110;Ruby&#35821;&#35328;&#65292;&#20197;&#26368;&#23567;&#31934;&#21147;&#20026;&#20195;&#20215;&#24555;&#36895;&#21019;&#24314;web&#24212;&#29992;&#20026;&#30446;&#30340;&#30340;<a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>&#65288;
&#39046;&#22495;&#19987;&#23646;&#35821;&#35328;&#65289;&#65306;</p>

<pre><code class="ruby"># myapp.rb
require 'sinatra'

get '/' do
  'Hello world!'
end
</code></pre>

<p>&#23433;&#35013;gem&#28982;&#21518;&#36816;&#34892;&#65306;</p>

<pre><code class="shell">gem install sinatra
ruby myapp.rb
</code></pre>

<p>&#22312;&#35813;&#22320;&#22336;&#26597;&#30475;&#65306; <a href="http://localhost:4567">localhost:4567</a></p>

<p>&#25512;&#33616;&#21516;&#26102;&#36816;&#34892;<code>gem install thin</code>&#65292;Sinatra&#20250;&#20248;&#20808;&#36873;&#25321;thin&#20316;&#20026;&#26381;&#21153;&#22120;&#12290;</p>

<a name='&%2336335;&%2330001;'></a>
<h2>&#36335;&#30001;</h2>

<p>&#22312;Sinatra&#20013;&#65292;&#19968;&#20010;&#36335;&#30001;&#26159;&#19968;&#20010;HTTP&#26041;&#27861;&#19982;URL&#21305;&#37197;&#33539;&#24335;&#30340;&#37197;&#23545;&#12290;
&#27599;&#20010;&#36335;&#30001;&#37117;&#19982;&#19968;&#20010;&#20195;&#30721;&#22359;&#20851;&#32852;&#65306;</p>

<pre><code class="ruby">get '/' do
  .. &#26174;&#31034;&#19968;&#20123;&#20107;&#29289; ..
end

post '/' do
  .. &#21019;&#24314;&#19968;&#20123;&#20107;&#29289; ..
end

put '/' do
  .. &#26356;&#26032;&#19968;&#20123;&#20107;&#29289; ..
end

delete '/' do
  .. &#28040;&#28781;&#19968;&#20123;&#20107;&#29289; ..
end

options '/' do
  .. &#28385;&#36275;&#19968;&#20123;&#20107;&#29289; ..
end
</code></pre>

<p>&#36335;&#30001;&#25353;&#29031;&#23427;&#20204;&#34987;&#23450;&#20041;&#30340;&#39034;&#24207;&#36827;&#34892;&#21305;&#37197;&#12290; &#31532;&#19968;&#20010;&#19982;&#35831;&#27714;&#21305;&#37197;&#30340;&#36335;&#30001;&#20250;&#34987;&#35843;&#29992;&#12290;</p>

<p>&#36335;&#30001;&#33539;&#24335;&#21487;&#20197;&#21253;&#25324;&#20855;&#21517;&#21442;&#25968;&#65292;&#21487;&#36890;&#36807;<code>params</code>&#21704;&#24076;&#34920;&#33719;&#24471;&#65306;</p>

<pre><code class="ruby">get '/hello/:name' do
  # &#21305;&#37197; "GET /hello/foo" &#21644; "GET /hello/bar"
  # params[:name] &#30340;&#20540;&#26159; 'foo' &#25110;&#32773; 'bar'
  "Hello #{params[:name]}!"
end
</code></pre>

<p>&#20320;&#21516;&#26679;&#21487;&#20197;&#36890;&#36807;&#20195;&#30721;&#22359;&#21442;&#25968;&#33719;&#24471;&#20855;&#21517;&#21442;&#25968;&#65306;</p>

<pre><code class="ruby">get '/hello/:name' do |n|
  "Hello #{n}!"
end
</code></pre>

<p>&#36335;&#30001;&#33539;&#24335;&#20063;&#21487;&#20197;&#21253;&#21547;&#36890;&#37197;&#31526;&#21442;&#25968;&#65292; &#21487;&#20197;&#36890;&#36807;<code>params[:splat]</code>&#25968;&#32452;&#33719;&#24471;&#12290;</p>

<pre><code class="ruby">get '/say/*/to/*' do
  # &#21305;&#37197; /say/hello/to/world
  params[:splat] # =&gt; ["hello", "world"]
end

get '/download/*.*' do
  # &#21305;&#37197; /download/path/to/file.xml
  params[:splat] # =&gt; ["path/to/file", "xml"]
end
</code></pre>

<p>&#36890;&#36807;&#27491;&#21017;&#34920;&#36798;&#24335;&#21305;&#37197;&#30340;&#36335;&#30001;&#65306;</p>

<pre><code class="ruby">get %r{/hello/([\w]+)} do
  "Hello, #{params[:captures].first}!"
end
</code></pre>

<p>&#25110;&#32773;&#20351;&#29992;&#20195;&#30721;&#22359;&#21442;&#25968;&#65306;</p>

<pre><code class="ruby">get %r{/hello/([\w]+)} do |c|
  "Hello, #{c}!"
end
</code></pre>

<a name='&%2326465;&%2320214;'></a>
<h3>&#26465;&#20214;</h3>

<p>&#36335;&#30001;&#20063;&#21487;&#20197;&#21253;&#21547;&#22810;&#26679;&#30340;&#21305;&#37197;&#26465;&#20214;&#65292;&#27604;&#22914;user agent&#65306;</p>

<pre><code class="ruby">get '/foo', :agent =&gt; /Songbird (\d\.\d)[\d\/]*?/ do
  "&#20320;&#27491;&#22312;&#20351;&#29992;Songbird&#65292;&#29256;&#26412;&#26159; #{params[:agent][0]}"
end

get '/foo' do
  # &#21305;&#37197;&#38500;Songbird&#20197;&#22806;&#30340;&#27983;&#35272;&#22120;
end
</code></pre>

<p>&#20854;&#20182;&#21487;&#36873;&#30340;&#26465;&#20214;&#26159; <code>host_name</code> &#21644; <code>provides</code>&#65306;</p>

<pre><code class="ruby">get '/', :host_name =&gt; /^admin\./ do
  "&#31649;&#29702;&#21592;&#21306;&#22495;&#65292;&#26080;&#26435;&#36827;&#20837;&#65281;"
end

get '/', :provides =&gt; 'html' do
  haml :index
end

get '/', :provides =&gt; ['rss', 'atom', 'xml'] do
  builder :feed
end
</code></pre>

<p>&#20320;&#20063;&#21487;&#20197;&#24456;&#36731;&#26494;&#22320;&#23450;&#20041;&#33258;&#24049;&#30340;&#26465;&#20214;&#65306;</p>

<pre><code class="ruby">set(:probability) { |value| condition { rand &lt;= value } }

get '/win_a_car', :probability =&gt; 0.1 do
  "You won!"
end

get '/win_a_car' do
  "Sorry, you lost."
end
</code></pre>

<a name='&%2336820;&%2322238;&%2320540;'></a>
<h3>&#36820;&#22238;&#20540;</h3>

<p>&#36335;&#30001;&#20195;&#30721;&#22359;&#30340;&#36820;&#22238;&#20540;&#33267;&#23569;&#20915;&#23450;&#20102;&#36820;&#22238;&#32473;HTTP&#23458;&#25143;&#31471;&#30340;&#21709;&#24212;&#20307;&#65292;
&#25110;&#32773;&#33267;&#23569;&#20915;&#23450;&#20102;&#22312;Rack&#22534;&#26632;&#20013;&#30340;&#19979;&#19968;&#20010;&#20013;&#38388;&#20214;&#12290;
&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#23558;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#65292;&#23601;&#20687;&#19978;&#38754;&#30340;&#20363;&#23376;&#20013;&#30340;&#19968;&#26679;&#12290;
&#20294;&#26159;&#20854;&#20182;&#20540;&#20063;&#26159;&#21487;&#20197;&#25509;&#21463;&#30340;&#12290;</p>

<p>&#20320;&#21487;&#20197;&#36820;&#22238;&#20219;&#20309;&#23545;&#35937;&#65292;&#25110;&#32773;&#26159;&#19968;&#20010;&#21512;&#29702;&#30340;Rack&#21709;&#24212;&#65292; Rack
body&#23545;&#35937;&#25110;&#32773;HTTP&#29366;&#24577;&#30721;&#65306;</p>

<p>&#37027;&#26679;&#65292;&#25105;&#20204;&#21487;&#20197;&#36731;&#26494;&#30340;&#23454;&#29616;&#20363;&#22914;&#27969;&#24335;&#20256;&#36755;&#30340;&#20363;&#23376;&#65306;</p>

<pre><code class="ruby">class Stream
  def each
    100.times { |i| yield "#{i}\n" }
  end
end

get('/') { Stream.new }
</code></pre>

<a name='&%2333258;&%2323450;&%2320041;&%2336335;&%2330001;&%2321305;&%2337197;&%2322120;'></a>
<h3>&#33258;&#23450;&#20041;&#36335;&#30001;&#21305;&#37197;&#22120;</h3>

<p>&#22914;&#19978;&#26174;&#31034;&#65292;Sinatra&#20869;&#32622;&#20102;&#23545;&#20110;&#20351;&#29992;&#23383;&#31526;&#20018;&#21644;&#27491;&#21017;&#34920;&#36798;&#24335;&#20316;&#20026;&#36335;&#30001;&#21305;&#37197;&#30340;&#25903;&#25345;&#12290;
&#20294;&#26159;&#65292;&#23427;&#24182;&#27809;&#26377;&#21482;&#38480;&#20110;&#27492;&#12290; &#20320;&#21487;&#20197;&#38750;&#24120;&#23481;&#26131;&#22320;&#23450;&#20041;&#20320;&#33258;&#24049;&#30340;&#21305;&#37197;&#22120;:</p>

<pre><code class="ruby">class AllButPattern
  Match = Struct.new(:captures)

  def initialize(except)
    @except   = except
    @captures = Match.new([])
  end

  def match(str)
    @captures unless @except === str
  end
end

def all_but(pattern)
  AllButPattern.new(pattern)
end

get all_but("/index") do
  # ...
end
</code></pre>

<p>&#35831;&#27880;&#24847;&#19978;&#38754;&#30340;&#20363;&#23376;&#21487;&#33021;&#36229;&#24037;&#31243;&#20102;&#65292; &#22240;&#20026;&#23427;&#20063;&#21487;&#20197;&#29992;&#26356;&#31616;&#21333;&#30340;&#26041;&#24335;&#34920;&#36848;:</p>

<pre><code class="ruby">get // do
  pass if request.path_info == "/index"
  # ...
end
</code></pre>

<p>&#25110;&#32773;&#65292;&#20351;&#29992;&#28040;&#26497;&#21521;&#21069;&#26597;&#25214;:</p>

<pre><code class="ruby">get %r{^(?!/index$)} do
  # ...
end
</code></pre>

<a name='&%2338745;&%2324577;&%2325991;&%2320214;'></a>
<h2>&#38745;&#24577;&#25991;&#20214;</h2>

<p>&#38745;&#24577;&#25991;&#20214;&#26159;&#20174; <code>./public_folder</code> &#30446;&#24405;&#25552;&#20379;&#26381;&#21153;&#12290;&#20320;&#21487;&#20197;&#36890;&#36807;&#35774;&#32622;<code>:public</code>
&#36873;&#39033;&#35774;&#23450;&#19968;&#20010;&#19981;&#21516;&#30340;&#20301;&#32622;&#65306;</p>

<pre><code class="ruby">set :public_folder, File.dirname(__FILE__) + '/static'
</code></pre>

<p>&#35831;&#27880;&#24847;public&#30446;&#24405;&#21517;&#24182;&#27809;&#26377;&#34987;&#21253;&#21547;&#22312;URL&#20043;&#20013;&#12290;&#25991;&#20214;
<code>./public/css/style.css</code>&#26159;&#36890;&#36807;
<code>http://example.com/css/style.css</code>&#22320;&#22336;&#35775;&#38382;&#30340;&#12290;</p>

<a name='&%2335270;&%2322270;%20/%20&%2327169;&%2326495;'></a>
<h2>&#35270;&#22270; / &#27169;&#26495;</h2>

<p>&#27169;&#26495;&#34987;&#20551;&#23450;&#30452;&#25509;&#20301;&#20110;<code>./views</code>&#30446;&#24405;&#12290; &#35201;&#20351;&#29992;&#19981;&#21516;&#30340;&#35270;&#22270;&#30446;&#24405;&#65306;</p>

<pre><code class="ruby">set :views, File.dirname(__FILE__) + '/templates'
</code></pre>

<p>&#35831;&#35760;&#20303;&#19968;&#20214;&#38750;&#24120;&#37325;&#35201;&#30340;&#20107;&#24773;&#65292;&#20320;&#21482;&#21487;&#20197;&#36890;&#36807;&#31526;&#21495;&#24341;&#29992;&#27169;&#26495;&#65292; &#21363;&#20351;&#23427;&#20204;&#22312;&#23376;&#30446;&#24405;&#19979;
&#65288;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#20351;&#29992; <code>:'subdir/template'</code>&#65289;&#12290; &#20320;&#24517;&#39035;&#20351;&#29992;&#19968;&#20010;&#31526;&#21495;&#65292;
&#22240;&#20026;&#28210;&#26579;&#26041;&#27861;&#20250;&#30452;&#25509;&#22320;&#28210;&#26579;&#20219;&#20309;&#20256;&#20837;&#30340;&#23383;&#31526;&#20018;&#12290;</p>

<a name='Haml&%2327169;&%2326495;'></a>
<h3>Haml&#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>haml</code> gem/library&#20197;&#28210;&#26579; HAML &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#20320;&#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; haml
require 'haml'

get '/' do
  haml :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.haml</code>&#12290;</p>

<p><a href="http://haml.info/docs/yardoc/file.HAML_REFERENCE.html#options">Haml&#30340;&#36873;&#39033;</a>
&#21487;&#20197;&#36890;&#36807;Sinatra&#30340;&#37197;&#32622;&#20840;&#23616;&#35774;&#23450;&#65292; &#21442;&#35265;
<a href="http://www.sinatrarb.com/configuration.html">&#36873;&#39033;&#21644;&#37197;&#32622;</a>&#65292;
&#20063;&#21487;&#20197;&#20010;&#21035;&#30340;&#34987;&#35206;&#30422;&#12290;</p>

<pre><code class="ruby">set :haml, {:format =&gt; :html5 } # &#40664;&#35748;&#30340;Haml&#36755;&#20986;&#26684;&#24335;&#26159; :xhtml

get '/' do
  haml :index, :haml_options =&gt; {:format =&gt; :html4 } # &#34987;&#35206;&#30422;&#65292;&#21464;&#25104;:html4
end
</code></pre>

<a name='Erb&%2327169;&%2326495;'></a>
<h3>Erb&#27169;&#26495;</h3>

<pre><code class="ruby"># &#20320;&#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; erb
require 'erb'

get '/' do
  erb :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.erb</code></p>

<a name='Erubis'></a>
<h3>Erubis</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>erubis</code> gem/library&#20197;&#28210;&#26579; erubis &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#20320;&#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; erubis
require 'erubis'

get '/' do
  erubis :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.erubis</code></p>

<p>&#20351;&#29992;Erubis&#20195;&#26367;Erb&#20063;&#26159;&#21487;&#33021;&#30340;:</p>

<pre><code class="ruby">require 'erubis'
Tilt.register :erb, Tilt[:erubis]

get '/' do
  erb :index
end
</code></pre>

<p>&#20351;&#29992;Erubis&#26469;&#28210;&#26579; <code>./views/index.erb</code>&#12290;</p>

<a name='Builder%20&%2327169;&%2326495;'></a>
<h3>Builder &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>builder</code> gem/library &#20197;&#28210;&#26579; builder templates&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837;builder
require 'builder'

get '/' do
  builder :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.builder</code>&#12290;</p>

<a name='Nokogiri%20&%2327169;&%2326495;'></a>
<h3>Nokogiri &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>nokogiri</code> gem/library &#20197;&#28210;&#26579; nokogiri &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; nokogiri
require 'nokogiri'

get '/' do
  nokogiri :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.nokogiri</code>&#12290;</p>

<a name='Sass%20&%2327169;&%2326495;'></a>
<h3>Sass &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>haml</code> &#25110;&#32773; <code>sass</code> gem/library &#20197;&#28210;&#26579; Sass &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; haml &#25110;&#32773; sass
require 'sass'

get '/stylesheet.css' do
  sass :stylesheet
end
</code></pre>

<p>&#28210;&#26579; <code>./views/stylesheet.sass</code>&#12290;</p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Sass
&#30340;&#36873;&#39033;</a>
&#21487;&#20197;&#36890;&#36807;Sinatra&#36873;&#39033;&#20840;&#23616;&#35774;&#23450;&#65292; &#21442;&#32771;
<a href="http://www.sinatrarb.com/configuration.html">&#36873;&#39033;&#21644;&#37197;&#32622;&#65288;&#33521;&#25991;&#65289;</a>,
&#20063;&#21487;&#20197;&#22312;&#20010;&#20307;&#30340;&#22522;&#30784;&#19978;&#35206;&#30422;&#12290;</p>

<pre><code class="ruby">set :sass, {:style =&gt; :compact } # &#40664;&#35748;&#30340; Sass &#26679;&#24335;&#26159; :nested

get '/stylesheet.css' do
  sass :stylesheet, :style =&gt; :expanded # &#35206;&#30422;
end
</code></pre>

<a name='Scss%20&%2327169;&%2326495;'></a>
<h3>Scss &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>haml</code> &#25110;&#32773; <code>sass</code> gem/library &#26469;&#28210;&#26579; Scss templates&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; haml &#25110;&#32773; sass
require 'sass'

get '/stylesheet.css' do
  scss :stylesheet
end
</code></pre>

<p>&#28210;&#26579; <code>./views/stylesheet.scss</code>&#12290;</p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Scss&#30340;&#36873;&#39033;</a>
&#21487;&#20197;&#36890;&#36807;Sinatra&#36873;&#39033;&#20840;&#23616;&#35774;&#23450;&#65292; &#21442;&#32771;
<a href="http://www.sinatrarb.com/configuration.html">&#36873;&#39033;&#21644;&#37197;&#32622;&#65288;&#33521;&#25991;&#65289;</a>,
&#20063;&#21487;&#20197;&#22312;&#20010;&#20307;&#30340;&#22522;&#30784;&#19978;&#35206;&#30422;&#12290;</p>

<pre><code class="ruby">set :scss, :style =&gt; :compact # default Scss style is :nested

get '/stylesheet.css' do
  scss :stylesheet, :style =&gt; :expanded # overridden
end
</code></pre>

<a name='Less%20&%2327169;&%2326495;'></a>
<h3>Less &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>less</code> gem/library &#20197;&#28210;&#26579; Less &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; less
require 'less'

get '/stylesheet.css' do
  less :stylesheet
end
</code></pre>

<p>&#28210;&#26579; <code>./views/stylesheet.less</code>&#12290;</p>

<a name='Liquid%20&%2327169;&%2326495;'></a>
<h3>Liquid &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>liquid</code> gem/library &#26469;&#28210;&#26579; Liquid &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; liquid
require 'liquid'

get '/' do
  liquid :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.liquid</code>&#12290;</p>

<p>&#22240;&#20026;&#20320;&#19981;&#33021;&#22312;Liquid &#27169;&#26495;&#20013;&#35843;&#29992; Ruby &#26041;&#27861; (&#38500;&#20102; <code>yield</code>) &#65292;
&#20320;&#20960;&#20046;&#24635;&#26159;&#38656;&#35201;&#20256;&#36882;locals&#32473;&#23427;&#65306;</p>

<pre><code class="ruby">liquid :index, :locals =&gt; { :key =&gt; 'value' }
</code></pre>

<a name='Markdown%20&%2327169;&%2326495;'></a>
<h3>Markdown &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>rdiscount</code> gem/library &#20197;&#28210;&#26579; Markdown &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837;rdiscount
require "rdiscount"

get '/' do
  markdown :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.markdown</code> (<code>md</code> &#21644; <code>mkd</code> &#20063;&#26159;&#21512;&#29702;&#30340;&#25991;&#20214;&#25193;&#23637;&#21517;)&#12290;</p>

<p>&#22312;markdown&#20013;&#26159;&#19981;&#21487;&#20197;&#35843;&#29992;&#26041;&#27861;&#30340;&#65292;&#20063;&#19981;&#21487;&#20197;&#20256;&#36882; locals&#32473;&#23427;&#12290;
&#20320;&#22240;&#27492;&#19968;&#33324;&#20250;&#32467;&#21512;&#20854;&#20182;&#30340;&#28210;&#26579;&#24341;&#25806;&#26469;&#20351;&#29992;&#23427;&#65306;</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; markdown(:introduction) }
</code></pre>

<p>&#35831;&#27880;&#24847;&#20320;&#20063;&#21487;&#20197;&#20174;&#20854;&#20182;&#27169;&#26495;&#20013;&#35843;&#29992; markdown &#26041;&#27861;&#65306;</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= markdown(:greetings)
</code></pre>

<p>&#26082;&#28982;&#20320;&#19981;&#33021;&#22312;Markdown&#20013;&#35843;&#29992;Ruby&#65292;&#20320;&#19981;&#33021;&#20351;&#29992;Markdown&#32534;&#20889;&#30340;&#24067;&#23616;&#12290;
&#19981;&#36807;&#65292;&#20351;&#29992;&#20854;&#20182;&#28210;&#26579;&#24341;&#25806;&#20316;&#20026;&#27169;&#29256;&#30340;&#24067;&#23616;&#26159;&#21487;&#33021;&#30340;&#65292;
&#36890;&#36807;&#20256;&#36882;<code>:layout_engine</code>&#36873;&#39033;:</p>

<pre><code class="ruby">get '/' do
  markdown :index, :layout_engine =&gt; :erb
end
</code></pre>

<p>&#36825;&#23558;&#20250;&#28210;&#26579; <code>./views/index.md</code> &#24182;&#20351;&#29992; <code>./views/layout.erb</code> &#20316;&#20026;&#24067;&#23616;&#12290;</p>

<p>&#35831;&#35760;&#20303;&#20320;&#21487;&#20197;&#20840;&#23616;&#35774;&#23450;&#36825;&#20010;&#36873;&#39033;:</p>

<pre><code class="ruby">set :markdown, :layout_engine =&gt; :haml, :layout =&gt; :post

get '/' do
  markdown :index
end
</code></pre>

<p>&#36825;&#23558;&#20250;&#28210;&#26579; <code>./views/index.markdown</code> (&#21644;&#20219;&#20309;&#20854;&#20182;&#30340; Markdown &#27169;&#29256;) &#24182;&#20351;&#29992;
<code>./views/post.haml</code> &#20316;&#20026;&#24067;&#23616;.</p>

<p>&#20063;&#21487;&#33021;&#20351;&#29992;BlueCloth&#32780;&#19981;&#26159;RDiscount&#26469;&#35299;&#26512;Markdown&#25991;&#20214;:</p>

<pre><code class="ruby">require 'bluecloth'

Tilt.register 'markdown', BlueClothTemplate
Tilt.register 'mkd',      BlueClothTemplate
Tilt.register 'md',       BlueClothTemplate

get '/' do
  markdown :index
end
</code></pre>

<p>&#20351;&#29992;BlueCloth&#26469;&#28210;&#26579; <code>./views/index.md</code> &#12290;</p>

<a name='Textile%20&%2327169;&%2326495;'></a>
<h3>Textile &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>RedCloth</code> gem/library &#20197;&#28210;&#26579; Textile &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837;redcloth
require "redcloth"

get '/' do
  textile :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.textile</code>&#12290;</p>

<p>&#22312;textile&#20013;&#26159;&#19981;&#21487;&#20197;&#35843;&#29992;&#26041;&#27861;&#30340;&#65292;&#20063;&#19981;&#21487;&#20197;&#20256;&#36882; locals&#32473;&#23427;&#12290;
&#20320;&#22240;&#27492;&#19968;&#33324;&#20250;&#32467;&#21512;&#20854;&#20182;&#30340;&#28210;&#26579;&#24341;&#25806;&#26469;&#20351;&#29992;&#23427;&#65306;</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; textile(:introduction) }
</code></pre>

<p>&#35831;&#27880;&#24847;&#20320;&#20063;&#21487;&#20197;&#20174;&#20854;&#20182;&#27169;&#26495;&#20013;&#35843;&#29992;<code>textile</code>&#26041;&#27861;&#65306;</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= textile(:greetings)
</code></pre>

<p>&#26082;&#28982;&#20320;&#19981;&#33021;&#22312;Textile&#20013;&#35843;&#29992;Ruby&#65292;&#20320;&#19981;&#33021;&#20351;&#29992;Textile&#32534;&#20889;&#30340;&#24067;&#23616;&#12290;
&#19981;&#36807;&#65292;&#20351;&#29992;&#20854;&#20182;&#28210;&#26579;&#24341;&#25806;&#20316;&#20026;&#27169;&#29256;&#30340;&#24067;&#23616;&#26159;&#21487;&#33021;&#30340;&#65292;
&#36890;&#36807;&#20256;&#36882;<code>:layout_engine</code>&#36873;&#39033;:</p>

<pre><code class="ruby">get '/' do
  textile :index, :layout_engine =&gt; :erb
end
</code></pre>

<p>&#36825;&#23558;&#20250;&#28210;&#26579; <code>./views/index.textile</code> &#24182;&#20351;&#29992; <code>./views/layout.erb</code>
&#20316;&#20026;&#24067;&#23616;&#12290;</p>

<p>&#35831;&#35760;&#20303;&#20320;&#21487;&#20197;&#20840;&#23616;&#35774;&#23450;&#36825;&#20010;&#36873;&#39033;:</p>

<pre><code class="ruby">set :textile, :layout_engine =&gt; :haml, :layout =&gt; :post

get '/' do
  textile :index
end
</code></pre>

<p>&#36825;&#23558;&#20250;&#28210;&#26579; <code>./views/index.textile</code> (&#21644;&#20219;&#20309;&#20854;&#20182;&#30340; Textile &#27169;&#29256;) &#24182;&#20351;&#29992;
<code>./views/post.haml</code> &#20316;&#20026;&#24067;&#23616;.</p>

<a name='RDoc%20&%2327169;&%2326495;'></a>
<h3>RDoc &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>RDoc</code> gem/library &#20197;&#28210;&#26579;RDoc&#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837;rdoc/markup/to_html
require "rdoc"
require "rdoc/markup/to_html"

get '/' do
  rdoc :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.rdoc</code>&#12290;</p>

<p>&#22312;rdoc&#20013;&#26159;&#19981;&#21487;&#20197;&#35843;&#29992;&#26041;&#27861;&#30340;&#65292;&#20063;&#19981;&#21487;&#20197;&#20256;&#36882;locals&#32473;&#23427;&#12290;
&#20320;&#22240;&#27492;&#19968;&#33324;&#20250;&#32467;&#21512;&#20854;&#20182;&#30340;&#28210;&#26579;&#24341;&#25806;&#26469;&#20351;&#29992;&#23427;&#65306;</p>

<pre><code class="ruby">erb :overview, :locals =&gt; { :text =&gt; rdoc(:introduction) }
</code></pre>

<p>&#35831;&#27880;&#24847;&#20320;&#20063;&#21487;&#20197;&#20174;&#20854;&#20182;&#27169;&#26495;&#20013;&#35843;&#29992;<code>rdoc</code>&#26041;&#27861;&#65306;</p>

<pre><code class="ruby">%h1 Hello From Haml!
%p= rdoc(:greetings)
</code></pre>

<p>&#26082;&#28982;&#20320;&#19981;&#33021;&#22312;RDoc&#20013;&#35843;&#29992;Ruby&#65292;&#20320;&#19981;&#33021;&#20351;&#29992;RDoc&#32534;&#20889;&#30340;&#24067;&#23616;&#12290;
&#19981;&#36807;&#65292;&#20351;&#29992;&#20854;&#20182;&#28210;&#26579;&#24341;&#25806;&#20316;&#20026;&#27169;&#29256;&#30340;&#24067;&#23616;&#26159;&#21487;&#33021;&#30340;&#65292;
&#36890;&#36807;&#20256;&#36882;<code>:layout_engine</code>&#36873;&#39033;:</p>

<pre><code class="ruby">get '/' do
  rdoc :index, :layout_engine =&gt; :erb
end
</code></pre>

<p>&#36825;&#23558;&#20250;&#28210;&#26579; <code>./views/index.rdoc</code> &#24182;&#20351;&#29992; <code>./views/layout.erb</code> &#20316;&#20026;&#24067;&#23616;&#12290;</p>

<p>&#35831;&#35760;&#20303;&#20320;&#21487;&#20197;&#20840;&#23616;&#35774;&#23450;&#36825;&#20010;&#36873;&#39033;:</p>

<pre><code class="ruby">set :rdoc, :layout_engine =&gt; :haml, :layout =&gt; :post

get '/' do
  rdoc :index
end
</code></pre>

<p>&#36825;&#23558;&#20250;&#28210;&#26579; <code>./views/index.rdoc</code> (&#21644;&#20219;&#20309;&#20854;&#20182;&#30340; RDoc &#27169;&#29256;) &#24182;&#20351;&#29992;
<code>./views/post.haml</code> &#20316;&#20026;&#24067;&#23616;.</p>

<a name='Radius%20&%2327169;&%2326495;'></a>
<h3>Radius &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>radius</code> gem/library &#20197;&#28210;&#26579; Radius &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837;radius
require 'radius'

get '/' do
  radius :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.radius</code>&#12290;</p>

<p>&#22240;&#20026;&#20320;&#19981;&#33021;&#22312;Radius &#27169;&#26495;&#20013;&#35843;&#29992; Ruby &#26041;&#27861; (&#38500;&#20102; <code>yield</code>) &#65292;
&#20320;&#20960;&#20046;&#24635;&#26159;&#38656;&#35201;&#20256;&#36882;locals&#32473;&#23427;&#65306;</p>

<pre><code class="ruby">radius :index, :locals =&gt; { :key =&gt; 'value' }
</code></pre>

<a name='Markaby%20&%2327169;&%2326495;'></a>
<h3>Markaby &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837;<code>markaby</code> gem/library&#20197;&#28210;&#26579;Markaby&#27169;&#26495;&#65306;</p>

<pre><code class="ruby">#&#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; markaby
require 'markaby'

get '/' do
  markaby :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.mab</code>&#12290;</p>

<p>&#20320;&#20063;&#21487;&#20197;&#20351;&#29992;&#23884;&#20837;&#30340; Markaby:</p>

<pre><code class="ruby">get '/' do
  markaby { h1 "Welcome!" }
end
</code></pre>

<a name='Slim%20&%2327169;&%2326495;'></a>
<h3>Slim &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>slim</code> gem/library &#26469;&#28210;&#26579; Slim &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; slim
require 'slim'

get '/' do
  slim :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.slim</code>&#12290;</p>

<a name='Creole%20&%2327169;&%2326495;'></a>
<h3>Creole &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>creole</code> gem/library &#26469;&#28210;&#26579; Creole &#27169;&#26495;&#65306;</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837; creole
require 'creole'

get '/' do
  creole :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.creole</code>&#12290;</p>

<a name='CoffeeScript%20&%2327169;&%2326495;'></a>
<h3>CoffeeScript &#27169;&#26495;</h3>

<p>&#38656;&#35201;&#24341;&#20837; <code>coffee-script</code> gem/library &#24182;&#33267;&#23569;&#28385;&#36275;&#19979;&#38754;&#26465;&#20214;&#19968;&#39033;
&#20197;&#25191;&#34892;Javascript:</p>

<ul>
<li><p><code>node</code> (&#26469;&#33258; Node.js) &#22312;&#20320;&#30340;&#36335;&#24452;&#20013;</p></li>
<li><p>&#20320;&#27491;&#22312;&#36816;&#34892; OSX</p></li>
<li><p><code>therubyracer</code> gem/library</p></li>
</ul>
<p>&#35831;&#23519;&#30475;
<a href="http://github.com/josh/ruby-coffee-script">github.com/josh/ruby-coffee-script</a>
&#33719;&#21462;&#26356;&#26032;&#30340;&#36873;&#39033;&#12290;</p>

<p>&#29616;&#22312;&#20320;&#21487;&#20197;&#28210;&#26579; CoffeeScript &#27169;&#29256;&#20102;:</p>

<pre><code class="ruby"># &#38656;&#35201;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#24341;&#20837;coffee-script
require 'coffee-script'

get '/application.js' do
  coffee :application
end
</code></pre>

<p>&#28210;&#26579; <code>./views/application.coffee</code>&#12290;</p>

<a name='&%2323884;&%2320837;&%2327169;&%2326495;&%2323383;&%2331526;&%2320018;'></a>
<h3>&#23884;&#20837;&#27169;&#26495;&#23383;&#31526;&#20018;</h3>

<pre><code class="ruby">get '/' do
  haml '%div.title Hello World'
end
</code></pre>

<p>&#28210;&#26579;&#23884;&#20837;&#27169;&#26495;&#23383;&#31526;&#20018;&#12290;</p>

<a name='&%2322312;&%2327169;&%2326495;&%2320013;&%2335775;&%2338382;&%2321464;&%2337327;'></a>
<h3>&#22312;&#27169;&#26495;&#20013;&#35775;&#38382;&#21464;&#37327;</h3>

<p>&#27169;&#26495;&#21644;&#36335;&#30001;&#25191;&#34892;&#22120;&#22312;&#21516;&#26679;&#30340;&#19978;&#19979;&#25991;&#27714;&#20540;&#12290;
&#22312;&#36335;&#30001;&#25191;&#34892;&#22120;&#20013;&#36171;&#20540;&#30340;&#23454;&#20363;&#21464;&#37327;&#21487;&#20197;&#30452;&#25509;&#34987;&#27169;&#26495;&#35775;&#38382;&#12290;</p>

<pre><code class="ruby">get '/:id' do
  @foo = Foo.find(params[:id])
  haml '%h1= @foo.name'
end
</code></pre>

<p>&#25110;&#32773;&#65292;&#26174;&#24335;&#22320;&#25351;&#23450;&#19968;&#20010;&#26412;&#22320;&#21464;&#37327;&#30340;&#21704;&#24076;&#65306;</p>

<pre><code class="ruby">get '/:id' do
  foo = Foo.find(params[:id])
  haml '%h1= foo.name', :locals =&gt; { :foo =&gt; foo }
end
</code></pre>

<p>&#20856;&#22411;&#30340;&#20351;&#29992;&#24773;&#20917;&#26159;&#22312;&#21035;&#30340;&#27169;&#26495;&#20013;&#25353;&#29031;&#23616;&#37096;&#27169;&#26495;&#30340;&#26041;&#24335;&#26469;&#28210;&#26579;&#12290;</p>

<a name='&%2320869;&%2332852;&%2327169;&%2326495;'></a>
<h3>&#20869;&#32852;&#27169;&#26495;</h3>

<p>&#27169;&#26495;&#21487;&#20197;&#22312;&#28304;&#25991;&#20214;&#30340;&#26411;&#23614;&#23450;&#20041;&#65306;</p>

<pre><code class="ruby">require 'sinatra'

get '/' do
  haml :index
end

__END__

@@ layout
%html
  = yield

@@ index
%div.title Hello world!!!!!
</code></pre>

<p>&#27880;&#24847;&#65306;&#24341;&#20837;sinatra&#30340;&#28304;&#25991;&#20214;&#20013;&#23450;&#20041;&#30340;&#20869;&#32852;&#27169;&#26495;&#25165;&#33021;&#34987;&#33258;&#21160;&#36733;&#20837;&#12290;
&#22914;&#26524;&#20320;&#22312;&#20854;&#20182;&#28304;&#25991;&#20214;&#20013;&#26377;&#20869;&#32852;&#27169;&#26495;&#65292;
&#38656;&#35201;&#26174;&#24335;&#25191;&#34892;&#35843;&#29992;<code>enable :inline_templates</code>&#12290;</p>

<a name='&%2320855;&%2321517;&%2327169;&%2326495;'></a>
<h3>&#20855;&#21517;&#27169;&#26495;</h3>

<p>&#27169;&#26495;&#21487;&#20197;&#36890;&#36807;&#20351;&#29992;&#39030;&#23618; <code>template</code> &#26041;&#27861;&#23450;&#20041;&#65306;</p>

<pre><code class="ruby">template :layout do
  "%html\n  =yield\n"
end

template :index do
  '%div.title Hello World!'
end

get '/' do
  haml :index
end
</code></pre>

<p>&#22914;&#26524;&#23384;&#22312;&#21517;&#20026;&ldquo;layout&rdquo;&#30340;&#27169;&#26495;&#65292;&#35813;&#27169;&#26495;&#20250;&#22312;&#27599;&#20010;&#27169;&#26495;&#28210;&#26579;&#30340;&#26102;&#20505;&#34987;&#20351;&#29992;&#12290;
&#20320;&#21487;&#20197;&#21333;&#29420;&#22320;&#36890;&#36807;&#20256;&#36865; <code>:layout =&gt; false</code>&#26469;&#31105;&#29992;&#65292;
&#25110;&#32773;&#36890;&#36807;<code>set :haml, :layout =&gt; false</code>&#26469;&#31105;&#29992;&#20182;&#20204;&#12290;</p>

<pre><code class="ruby">get '/' do
  haml :index, :layout =&gt; !request.xhr?
end
</code></pre>

<a name='&%2320851;&%2332852;&%2325991;&%2320214;&%2325193;&%2323637;&%2321517;'></a>
<h3>&#20851;&#32852;&#25991;&#20214;&#25193;&#23637;&#21517;</h3>

<p>&#20026;&#20102;&#20851;&#32852;&#19968;&#20010;&#25991;&#20214;&#25193;&#23637;&#21517;&#21040;&#19968;&#20010;&#27169;&#29256;&#24341;&#25806;&#65292;&#20351;&#29992;
<code>Tilt.register</code>&#12290;&#27604;&#22914;&#65292;&#22914;&#26524;&#20320;&#21916;&#27426;&#20351;&#29992; <code>tt</code>
&#20316;&#20026;Textile&#27169;&#29256;&#30340;&#25193;&#23637;&#21517;&#65292;&#20320;&#21487;&#20197;&#36825;&#26679;&#20570;:</p>

<pre><code class="ruby">Tilt.register :tt, Tilt[:textile]
</code></pre>

<a name='&%2328155;&%2321152;&%2320320;&%2333258;&%2324049;&%2330340;&%2327169;&%2329256;&%2324341;&%2325806;'></a>
<h3>&#28155;&#21152;&#20320;&#33258;&#24049;&#30340;&#27169;&#29256;&#24341;&#25806;</h3>

<p>&#39318;&#20808;&#65292;&#36890;&#36807;Tilt&#27880;&#20876;&#20320;&#33258;&#24049;&#30340;&#24341;&#25806;&#65292;&#28982;&#21518;&#21019;&#24314;&#19968;&#20010;&#28210;&#26579;&#26041;&#27861;:</p>

<pre><code class="ruby">Tilt.register :myat, MyAwesomeTemplateEngine

helpers do
  def myat(*args) render(:myat, *args) end
end

get '/' do
  myat :index
end
</code></pre>

<p>&#28210;&#26579; <code>./views/index.myat</code>&#12290;&#23519;&#30475;
<a href="https://github.com/rtomayko/tilt">github.com/rtomayko/tilt</a>
&#26469;&#26356;&#22810;&#20102;&#35299;Tilt.</p>

<a name='&%2336807;&%2328388;&%2322120;'></a>
<h2>&#36807;&#28388;&#22120;</h2>

<p>&#21069;&#32622;&#36807;&#28388;&#22120;&#22312;&#27599;&#20010;&#35831;&#27714;&#21069;&#65292;&#22312;&#35831;&#27714;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#20013;&#34987;&#25191;&#34892;&#65292;
&#32780;&#19988;&#21487;&#20197;&#20462;&#25913;&#35831;&#27714;&#21644;&#21709;&#24212;&#12290; &#22312;&#36807;&#28388;&#22120;&#20013;&#35774;&#23450;&#30340;&#23454;&#20363;&#21464;&#37327;&#21487;&#20197;&#34987;&#36335;&#30001;&#21644;&#27169;&#26495;&#35775;&#38382;&#65306;</p>

<pre><code class="ruby">before do
  @note = 'Hi!'
  request.path_info = '/foo/bar/baz'
end

get '/foo/*' do
  @note #=&gt; 'Hi!'
  params[:splat] #=&gt; 'bar/baz'
end
</code></pre>

<p>&#21518;&#32622;&#36807;&#28388;&#22120;&#22312;&#27599;&#20010;&#35831;&#27714;&#20043;&#21518;&#65292;&#22312;&#35831;&#27714;&#30340;&#19978;&#19979;&#25991;&#29615;&#22659;&#20013;&#25191;&#34892;&#65292;
&#32780;&#19988;&#21487;&#20197;&#20462;&#25913;&#35831;&#27714;&#21644;&#21709;&#24212;&#12290;
&#22312;&#21069;&#32622;&#36807;&#28388;&#22120;&#21644;&#36335;&#30001;&#20013;&#35774;&#23450;&#30340;&#23454;&#20363;&#21464;&#37327;&#21487;&#20197;&#34987;&#21518;&#32622;&#36807;&#28388;&#22120;&#35775;&#38382;&#65306;</p>

<pre><code class="ruby">after do
  puts response.status
end
</code></pre>

<p>&#35831;&#27880;&#24847;&#65306;&#38500;&#38750;&#20320;&#26174;&#24335;&#20351;&#29992; <code>body</code> &#26041;&#27861;&#65292;&#32780;&#19981;&#26159;&#22312;&#36335;&#30001;&#20013;&#30452;&#25509;&#36820;&#22238;&#23383;&#31526;&#20018;&#65292;
&#28040;&#24687;&#20307;&#22312;&#21518;&#32622;&#36807;&#28388;&#22120;&#26159;&#19981;&#21487;&#29992;&#30340;&#65292; &#22240;&#20026;&#23427;&#22312;&#20043;&#21518;&#25165;&#20250;&#29983;&#25104;&#12290;</p>

<p>&#36807;&#28388;&#22120;&#21487;&#20197;&#21487;&#36873;&#22320;&#24102;&#26377;&#33539;&#24335;&#65292; &#21482;&#26377;&#35831;&#27714;&#36335;&#24452;&#28385;&#36275;&#35813;&#33539;&#24335;&#26102;&#25165;&#20250;&#25191;&#34892;&#65306;</p>

<pre><code class="ruby">before '/protected/*' do
  authenticate!
end

after '/create/:slug' do |slug|
  session[:last_slug] = slug
end
</code></pre>

<p>&#21644;&#36335;&#30001;&#19968;&#26679;&#65292;&#36807;&#28388;&#22120;&#20063;&#21487;&#20197;&#24102;&#26377;&#26465;&#20214;:</p>

<pre><code class="ruby">before :agent =&gt; /Songbird/ do
  # ...
end

after '/blog/*', :host_name =&gt; 'example.com' do
  # ...
end
</code></pre>

<a name='&%2336741;&%2321161;&%2326041;&%2327861;'></a>
<h2>&#36741;&#21161;&#26041;&#27861;</h2>

<p>&#20351;&#29992;&#39030;&#23618;&#30340; <code>helpers</code> &#26041;&#27861;&#26469;&#23450;&#20041;&#36741;&#21161;&#26041;&#27861;&#65292; &#20197;&#20415;&#22312;&#36335;&#30001;&#22788;&#29702;&#22120;&#21644;&#27169;&#26495;&#20013;&#20351;&#29992;&#65306;</p>

<pre><code class="ruby">helpers do
  def bar(name)
    "#{name}bar"
  end
end

get '/:name' do
  bar(params[:name])
end
</code></pre>

<a name='&%2320351;&%2329992;%20Sessions'></a>
<h3>&#20351;&#29992; Sessions</h3>

<p>Session&#34987;&#29992;&#26469;&#22312;&#35831;&#27714;&#20043;&#38388;&#20445;&#25345;&#29366;&#24577;&#12290;&#22914;&#26524;&#34987;&#28608;&#27963;&#65292;&#27599;&#19968;&#20010;&#29992;&#25143;&#20250;&#35805;
&#23545;&#24212;&#26377;&#19968;&#20010;session&#21704;&#24076;:</p>

<pre><code class="ruby">enable :sessions

get '/' do
  "value = " &lt;&lt; session[:value].inspect
end

get '/:value' do
  session[:value] = params[:value]
end
</code></pre>

<p>&#35831;&#27880;&#24847; <code>enable :sessions</code> &#23454;&#38469;&#19978;&#20445;&#23384;&#25152;&#26377;&#30340;&#25968;&#25454;&#22312;&#19968;&#20010;cookie&#20043;&#20013;&#12290;
&#36825;&#21487;&#33021;&#19981;&#20250;&#24635;&#26159;&#20570;&#20320;&#24819;&#35201;&#30340;&#65288;&#27604;&#22914;&#65292;&#20445;&#23384;&#22823;&#37327;&#30340;&#25968;&#25454;&#20250;&#22686;&#21152;&#20320;&#30340;&#27969;&#37327;&#65289;&#12290;
&#20320;&#21487;&#20197;&#20351;&#29992;&#20219;&#20309;&#30340;Rack session&#20013;&#38388;&#20214;&#65292;&#20026;&#20102;&#36825;&#20040;&#20570;&#65292; *&#19981;&#35201;*&#35843;&#29992;
<code>enable :sessions</code>&#65292;&#32780;&#26159; &#25353;&#29031;&#33258;&#24049;&#30340;&#38656;&#35201;&#24341;&#20837;&#20320;&#30340;&#20013;&#38388;&#20214;&#65306;</p>

<pre><code class="ruby">use Rack::Session::Pool, :expire_after =&gt; 2592000

get '/' do
  "value = " &lt;&lt; session[:value].inspect
end

get '/:value' do
  session[:value] = params[:value]
end
</code></pre>

<a name='&%2325346;&%2336215;'></a>
<h3>&#25346;&#36215;</h3>

<p>&#35201;&#24819;&#30452;&#25509;&#22320;&#20572;&#27490;&#35831;&#27714;&#65292;&#22312;&#36807;&#28388;&#22120;&#25110;&#32773;&#36335;&#30001;&#20013;&#20351;&#29992;&#65306;</p>

<pre><code class="ruby">halt
</code></pre>

<p>&#20320;&#20063;&#21487;&#20197;&#25351;&#23450;&#25346;&#36215;&#26102;&#30340;&#29366;&#24577;&#30721;&#65306;</p>

<pre><code class="ruby">halt 410
</code></pre>

<p>&#25110;&#32773;&#28040;&#24687;&#20307;&#65306;</p>

<pre><code class="ruby">halt 'this will be the body'
</code></pre>

<p>&#25110;&#32773;&#20004;&#32773;;</p>

<pre><code class="ruby">halt 401, 'go away!'
</code></pre>

<p>&#20063;&#21487;&#20197;&#24102;&#28040;&#24687;&#22836;&#65306;</p>

<pre><code class="ruby">halt 402, {'Content-Type' =&gt; 'text/plain'}, 'revenge'
</code></pre>

<a name='&%2335753;&%2336335;'></a>
<h3>&#35753;&#36335;</h3>

<p>&#19968;&#20010;&#36335;&#30001;&#21487;&#20197;&#25918;&#24323;&#22788;&#29702;&#65292;&#23558;&#22788;&#29702;&#35753;&#32473;&#19979;&#19968;&#20010;&#21305;&#37197;&#30340;&#36335;&#30001;&#65292;&#20351;&#29992; <code>pass</code>&#65306;</p>

<pre><code class="ruby">get '/guess/:who' do
  pass unless params[:who] == 'Frank'
  'You got me!'
end

get '/guess/*' do
  'You missed!'
end
</code></pre>

<p>&#36335;&#30001;&#20195;&#30721;&#22359;&#34987;&#30452;&#25509;&#36864;&#20986;&#65292;&#25511;&#21046;&#27969;&#32487;&#32493;&#21069;&#36827;&#21040;&#19979;&#19968;&#20010;&#21305;&#37197;&#30340;&#36335;&#30001;&#12290;
&#22914;&#26524;&#27809;&#26377;&#21305;&#37197;&#30340;&#36335;&#30001;&#65292;&#23558;&#36820;&#22238;404&#12290;</p>

<a name='&%2335302;&%2321457;&%2321478;&%2319968;&%2320010;&%2336335;&%2330001;'></a>
<h3>&#35302;&#21457;&#21478;&#19968;&#20010;&#36335;&#30001;</h3>

<p>&#26377;&#20123;&#26102;&#20505;&#65292;<code>pass</code> &#24182;&#19981;&#26159;&#20320;&#24819;&#35201;&#30340;&#65292;&#20320;&#24076;&#26395;&#24471;&#21040;&#30340;&#26159;&#21478;&#19968;&#20010;&#36335;&#30001;&#30340;&#32467;&#26524;
&#12290;&#31616;&#21333;&#30340;&#20351;&#29992; <code>call</code> &#21487;&#20197;&#20570;&#21040;&#36825;&#19968;&#28857;:</p>

<pre><code class="ruby">get '/foo' do
  status, headers, body = call env.merge("PATH_INFO" =&gt; '/bar')
  [status, headers, body.map(&amp;:upcase)]
end

get '/bar' do
  "bar"
end
</code></pre>

<p>&#35831;&#27880;&#24847;&#22312;&#20197;&#19978;&#20363;&#23376;&#20013;&#65292;&#20320;&#21487;&#20197;&#26356;&#21152;&#31616;&#21270;&#27979;&#35797;&#24182;&#22686;&#21152;&#24615;&#33021;&#65292;&#21482;&#35201;&#31616;&#21333;&#30340;&#31227;&#21160;</p>

<pre><code>&lt;tt&gt;"bar"&lt;/tt&gt;&#21040;&#19968;&#20010;&#34987;&lt;tt&gt;/foo&lt;/tt&gt;
</code></pre>

<p>&#21644; <code>/bar</code>&#21516;&#26102;&#20351;&#29992;&#30340;helper&#12290;</p>

<p>&#22914;&#26524;&#20320;&#24076;&#26395;&#35831;&#27714;&#34987;&#21457;&#36865;&#21040;&#21516;&#19968;&#20010;&#24212;&#29992;&#65292;&#32780;&#19981;&#26159;&#21103;&#26412;&#65292; &#20351;&#29992; <code>call!</code> &#32780;&#19981;&#26159;
<code>call</code>.</p>

<p>&#23519;&#30475; Rack specification &#22914;&#26524;&#20320;&#24819;&#26356;&#22810;&#20102;&#35299; <code>call</code>.</p>

<a name='&%2335774;&%2323450;%20&%2328040;&%2324687;&%2320307;&%2365292;&%2329366;&%2324577;&%2330721;&%2321644;&%2328040;&%2324687;&%2322836;'></a>
<h3>&#35774;&#23450; &#28040;&#24687;&#20307;&#65292;&#29366;&#24577;&#30721;&#21644;&#28040;&#24687;&#22836;</h3>

<p>&#36890;&#36807;&#36335;&#30001;&#20195;&#30721;&#22359;&#30340;&#36820;&#22238;&#20540;&#26469;&#35774;&#23450;&#29366;&#24577;&#30721;&#21644;&#28040;&#24687;&#20307;&#19981;&#20165;&#26159;&#21487;&#33021;&#30340;&#65292;&#32780;&#19988;&#26159;&#25512;&#33616;&#30340;&#12290;
&#20294;&#26159;&#65292;&#22312;&#26576;&#20123;&#22330;&#26223;&#20013;&#20320;&#21487;&#33021;&#24819;&#22312;&#20316;&#19994;&#27969;&#31243;&#20013;&#30340;&#29305;&#23450;&#28857;&#19978;&#35774;&#32622;&#28040;&#24687;&#20307;&#12290; &#20320;&#21487;&#20197;&#36890;&#36807;
<code>body</code> &#36741;&#21161;&#26041;&#27861;&#36825;&#20040;&#20570;&#12290; &#22914;&#26524;&#20320;&#36825;&#26679;&#20570;&#20102;&#65292;
&#20320;&#21487;&#20197;&#22312;&#37027;&#20197;&#21518;&#20351;&#29992;&#35813;&#26041;&#27861;&#33719;&#24471;&#28040;&#24687;&#20307;:</p>

<pre><code class="ruby">get '/foo' do
  body "bar"
end

after do
  puts body
end
</code></pre>

<p>&#20063;&#21487;&#20197;&#20256;&#19968;&#20010;&#20195;&#30721;&#22359;&#32473; <code>body</code>&#65292;&#23427;&#23558;&#20250;&#34987;Rack&#22788;&#29702;&#22120;&#25191;&#34892;&#65288;
&#36825;&#23558;&#21487;&#20197;&#34987;&#29992;&#26469;&#23454;&#29616;streaming&#65292;&#21442;&#35265;&ldquo;&#36820;&#22238;&#20540;&rdquo;&#65289;&#12290;</p>

<p>&#21644;&#28040;&#24687;&#20307;&#31867;&#20284;&#65292;&#20320;&#20063;&#21487;&#20197;&#35774;&#23450;&#29366;&#24577;&#30721;&#21644;&#28040;&#24687;&#22836;:</p>

<pre><code class="ruby">get '/foo' do
  status 418
  headers \
    "Allow"   =&gt; "BREW, POST, GET, PROPFIND, WHEN",
    "Refresh" =&gt; "Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt"
  body "I'm a tea pot!"
end
</code></pre>

<p>&#22914;&#21516; <code>body</code>, &#19981;&#24102;&#21442;&#25968;&#30340; <code>headers</code> &#21644; <code>status</code> &#21487;&#20197;&#29992;&#26469;&#35775;&#38382;
&#20182;&#20204;&#20320;&#30340;&#24403;&#21069;&#20540;.</p>

<a name='&%2323186;&%2320307;&%2331867;&%2322411;'></a>
<h3>&#23186;&#20307;&#31867;&#22411;</h3>

<p>&#24403;&#20351;&#29992; <code>send_file</code> &#25110;&#32773;&#38745;&#24577;&#25991;&#20214;&#30340;&#22330;&#21512;&#65292;&#20320;&#30340;&#23186;&#20307;&#31867;&#22411;&#21487;&#33021;
Sinatra&#24182;&#19981;&#29702;&#35299;&#12290;&#20351;&#29992; <code>mime_type</code> &#36890;&#36807;&#25991;&#20214;&#25193;&#23637;&#21517;&#26469;&#27880;&#20876;&#23427;&#20204;&#65306;</p>

<pre><code class="ruby">mime_type :foo, 'text/foo'
</code></pre>

<p>&#20320;&#20063;&#21487;&#20197;&#36890;&#36807; <code>content_type</code> &#36741;&#21161;&#26041;&#27861;&#20351;&#29992;&#65306;</p>

<pre><code class="ruby">get '/' do
  content_type :foo
  "foo foo foo"
end
</code></pre>

<a name='&%2329983;&%2325104;%20URL'></a>
<h3>&#29983;&#25104; URL</h3>

<p>&#20026;&#20102;&#29983;&#25104;URL&#65292;&#20320;&#38656;&#35201;&#20351;&#29992; <code>url</code> &#36741;&#21161;&#26041;&#27861;&#65292; &#20363;&#22914;&#65292;&#22312;Haml&#20013;:</p>

<pre><code class="ruby">%a{:href =&gt; url('/foo')} foo
</code></pre>

<p>&#23427;&#20250;&#26681;&#25454;&#21453;&#21521;&#20195;&#29702;&#21644;Rack&#36335;&#30001;&#65292;&#22914;&#26524;&#26377;&#30340;&#35805;&#65292;&#26469;&#35745;&#31639;&#29983;&#25104;&#30340;URL&#12290;</p>

<p>&#36825;&#20010;&#26041;&#27861;&#36824;&#26377;&#19968;&#20010;&#21035;&#21517; <code>to</code> (&#35265;&#19979;&#38754;&#30340;&#20363;&#23376;).</p>

<a name='&%2327983;&%2335272;&%2322120;&%2337325;&%2323450;&%2321521;'></a>
<h3>&#27983;&#35272;&#22120;&#37325;&#23450;&#21521;</h3>

<p>&#20320;&#21487;&#20197;&#36890;&#36807; <code>redirect</code> &#36741;&#21161;&#26041;&#27861;&#35302;&#21457;&#27983;&#35272;&#22120;&#37325;&#23450;&#21521;:</p>

<pre><code class="ruby">get '/foo' do
  redirect to('/bar')
end
</code></pre>

<p>&#20219;&#20309;&#39069;&#22806;&#30340;&#21442;&#25968;&#37117;&#20250;&#34987;&#20197; <code>halt</code>&#30456;&#21516;&#30340;&#26041;&#24335;&#26469;&#22788;&#29702;:</p>

<pre><code class="ruby">redirect to('/bar'), 303
redirect 'http://google.com', 'wrong place, buddy'
</code></pre>

<p>&#20320;&#21487;&#20197;&#26041;&#20415;&#30340;&#36890;&#36807; <code>redirect back</code>&#25226;&#29992;&#25143;&#37325;&#23450;&#21521;&#21040;&#26469;&#33258;&#30340;&#39029;&#38754;:</p>

<pre><code class="ruby">get '/foo' do
  "&lt;a href='/bar'&gt;do something&lt;/a&gt;"
end

get '/bar' do
  do_something
  redirect back
end
</code></pre>

<p>&#20026;&#20102;&#20256;&#36882;&#21442;&#25968;&#32473;redirect&#65292;&#25110;&#32773;&#21152;&#20837;query:</p>

<pre><code class="ruby">redirect to('/bar?sum=42')
</code></pre>

<p>&#25110;&#32773;&#20351;&#29992;session:</p>

<pre><code class="ruby">enable :sessions

get '/foo' do
  session[:secret] = 'foo'
  redirect to('/bar')
end

get '/bar' do
  session[:secret]
end
</code></pre>

<a name='&%2332531;&%2323384;&%2325511;&%2321046;'></a>
<h3>&#32531;&#23384;&#25511;&#21046;</h3>

<p>&#27491;&#30830;&#22320;&#35774;&#23450;&#28040;&#24687;&#22836;&#26159;&#24688;&#24403;&#30340;HTTP&#32531;&#23384;&#30340;&#22522;&#30784;&#12290;</p>

<p>&#20320;&#21487;&#20197;&#26041;&#20415;&#30340;&#35774;&#23450; Cache-Control &#28040;&#24687;&#22836;&#65292;&#20687;&#36825;&#26679;:</p>

<pre><code class="ruby">get '/' do
  cache_control :public
  "cache it!"
end
</code></pre>

<p>&#26680;&#24515;&#25552;&#31034;: &#22312;&#21069;&#32622;&#36807;&#28388;&#22120;&#20013;&#35774;&#23450;&#32531;&#23384;.</p>

<pre><code class="ruby">before do
  cache_control :public, :must_revalidate, :max_age =&gt; 60
end
</code></pre>

<p>&#22914;&#26524;&#20320;&#27491;&#22312;&#29992; <code>expires</code> &#36741;&#21161;&#26041;&#27861;&#35774;&#23450;&#23545;&#24212;&#30340;&#28040;&#24687;&#22836; <code>Cache-Control</code>
&#20250;&#33258;&#21160;&#35774;&#23450;&#65306;</p>

<pre><code class="ruby">before do
  expires 500, :public, :must_revalidate
end
</code></pre>

<p>&#20026;&#20102;&#21512;&#36866;&#22320;&#20351;&#29992;&#32531;&#23384;&#65292;&#20320;&#24212;&#35813;&#32771;&#34385;&#20351;&#29992; <code>etag</code> &#21644; <code>last_modified</code>&#26041;&#27861;&#12290;.
&#25512;&#33616;&#22312;&#25191;&#34892;&#32321;&#37325;&#20219;&#21153;*&#20043;&#21069;*&#20351;&#29992;&#36825;&#20123;helpers&#65292;
&#20182;&#20204;&#20250;&#31435;&#21051;&#21457;&#36865;&#21709;&#24212;&#65292;&#22914;&#26524;&#23458;&#25143;&#31471;&#22312;&#32531;&#23384;&#20013;&#24050;&#32463;&#26377;&#20102;&#24403;&#21069;&#29256;&#26412;&#12290;</p>

<pre><code class="ruby">get '/article/:id' do
  @article = Article.find params[:id]
  last_modified @article.updated_at
  etag @article.sha1
  erb :article
end
</code></pre>

<p>&#20351;&#29992; <a href="http://en.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak
ETag</a>
&#20063;&#26159;&#26377;&#21487;&#33021;&#30340;:</p>

<pre><code class="ruby">etag @article.sha1, :weak
</code></pre>

<p>&#36825;&#20123;&#36741;&#21161;&#26041;&#27861;&#24182;&#19981;&#20250;&#20026;&#20320;&#20570;&#20219;&#20309;&#32531;&#23384;&#65292;&#32780;&#26159;&#23558;&#24517;&#35201;&#30340;&#20449;&#24687;&#20256;&#36865;&#32473;&#20320;&#30340;&#32531;&#23384;
&#22914;&#26524;&#20320;&#22312;&#23547;&#25214;&#32531;&#23384;&#30340;&#24555;&#36895;&#35299;&#20915;&#26041;&#26696;&#65292;&#35797;&#35797;
<a href="https://github.com/rtomayko/rack-cache">rack-cache</a>:</p>

<pre><code class="ruby">require "rack/cache"
require "sinatra"

use Rack::Cache

get '/' do
  cache_control :public, :max_age =&gt; 36000
  sleep 5
  "hello"
end
</code></pre>

<a name='&%2321457;&%2336865;&%2325991;&%2320214;'></a>
<h3>&#21457;&#36865;&#25991;&#20214;</h3>

<p>&#20026;&#20102;&#21457;&#36865;&#25991;&#20214;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992; <code>send_file</code> &#36741;&#21161;&#26041;&#27861;:</p>

<pre><code class="ruby">get '/' do
  send_file 'foo.png'
end
</code></pre>

<p>&#20063;&#21487;&#20197;&#24102;&#19968;&#20123;&#36873;&#39033;:</p>

<pre><code class="ruby">send_file 'foo.png', :type =&gt; :jpg
</code></pre>

<p>&#21487;&#29992;&#30340;&#36873;&#39033;&#26377;:</p>

<dl>
<dt>filename</dt>
    <dd>&#21709;&#24212;&#20013;&#30340;&#25991;&#20214;&#21517;&#65292;&#40664;&#35748;&#26159;&#30495;&#23454;&#25991;&#20214;&#30340;&#21517;&#23383;&#12290;</dd>

    <dt>last_modified</dt>
    <dd>Last-Modified &#28040;&#24687;&#22836;&#30340;&#20540;&#65292;&#40664;&#35748;&#26159;&#25991;&#20214;&#30340;mtime&#65288;&#20462;&#25913;&#26102;&#38388;&#65289;&#12290;</dd>

    <dt>type</dt>
    <dd>&#20351;&#29992;&#30340;&#20869;&#23481;&#31867;&#22411;&#65292;&#22914;&#26524;&#27809;&#26377;&#20250;&#20174;&#25991;&#20214;&#25193;&#23637;&#21517;&#29468;&#27979;&#12290;</dd>

    <dt>disposition</dt>
    <dd>
        &#29992;&#20110; Content-Disposition&#65292;&#21487;&#33021;&#30340;&#21253;&#25324;&#65306; <tt>nil</tt> (&#40664;&#35748;), <tt>:attachment</tt> &#21644;
        <tt>:inline</tt>
    </dd>

    <dt>length</dt>
    <dd>Content-Length &#30340;&#20540;&#65292;&#40664;&#35748;&#26159;&#25991;&#20214;&#30340;&#22823;&#23567;&#12290;</dd>
</dl>
<p>&#22914;&#26524;Rack&#22788;&#29702;&#22120;&#25903;&#25345;&#65292;Ruby&#36827;&#31243;&#38500;streaming&#20197;&#22806;&#30340;&#26041;&#24335;&#20250;&#34987;&#20351;&#29992;&#12290;
&#22914;&#26524;&#20320;&#20351;&#29992;&#36825;&#20010;&#36741;&#21161;&#26041;&#27861;&#65292; Sinatra&#20250;&#33258;&#21160;&#22788;&#29702;range&#35831;&#27714;&#12290;</p>

<a name='&%2335775;&%2338382;&%2335831;&%2327714;&%2323545;&%2335937;'></a>
<h3>&#35775;&#38382;&#35831;&#27714;&#23545;&#35937;</h3>

<p>&#20256;&#20837;&#30340;&#35831;&#27714;&#23545;&#35937;&#21487;&#20197;&#22312;&#35831;&#27714;&#23618;&#65288;&#36807;&#28388;&#22120;&#65292;&#36335;&#30001;&#65292;&#38169;&#35823;&#22788;&#29702;&#65289; &#36890;&#36807; <code>request</code>
&#26041;&#27861;&#34987;&#35775;&#38382;&#65306;</p>

<pre><code class="ruby"># &#22312; http://example.com/example &#19978;&#36816;&#34892;&#30340;&#24212;&#29992;
get '/foo' do
  request.body              # &#34987;&#23458;&#25143;&#31471;&#35774;&#23450;&#30340;&#35831;&#27714;&#20307;&#65288;&#35265;&#19979;&#65289;
  request.scheme            # "http"
  request.script_name       # "/example"
  request.path_info         # "/foo"
  request.port              # 80
  request.request_method    # "GET"
  request.query_string      # ""
  request.content_length    # request.body&#30340;&#38271;&#24230;
  request.media_type        # request.body&#30340;&#23186;&#20307;&#31867;&#22411;
  request.host              # "example.com"
  request.get?              # true (&#20854;&#20182;&#21160;&#35789;&#20063;&#20855;&#26377;&#31867;&#20284;&#26041;&#27861;)
  request.form_data?        # false
  request["SOME_HEADER"]    # SOME_HEADER header&#30340;&#20540;
  request.referrer          # &#23458;&#25143;&#31471;&#30340;referrer &#25110;&#32773; '/'
  request.user_agent        # user agent (&#34987; :agent &#26465;&#20214;&#20351;&#29992;)
  request.cookies           # &#27983;&#35272;&#22120; cookies &#21704;&#24076;
  request.xhr?              # &#36825;&#26159;&#21542;&#26159;ajax&#35831;&#27714;&#65311;
  request.url               # "http://example.com/example/foo"
  request.path              # "/example/foo"
  request.ip                # &#23458;&#25143;&#31471;IP&#22320;&#22336;
  request.secure?           # false&#65288;&#22914;&#26524;&#26159;ssl&#21017;&#20026;true&#65289;
  request.forwarded?        # true &#65288;&#22914;&#26524;&#26159;&#36816;&#34892;&#22312;&#21453;&#21521;&#20195;&#29702;&#20043;&#21518;&#65289;
  request.env               # Rack&#20013;&#20351;&#29992;&#30340;&#26410;&#22788;&#29702;&#30340;env&#21704;&#24076;
end
</code></pre>

<p>&#19968;&#20123;&#36873;&#39033;&#65292;&#20363;&#22914; <code>script_name</code> &#25110;&#32773; <code>path_info</code> &#20063;&#26159;&#21487;&#20889;&#30340;&#65306;</p>

<pre><code class="ruby">before { request.path_info = "/" }

get "/" do
  "all requests end up here"
end
</code></pre>

<p><code>request.body</code> &#26159;&#19968;&#20010;IO&#25110;&#32773;StringIO&#23545;&#35937;&#65306;</p>

<pre><code class="ruby">post "/api" do
  request.body.rewind  # &#22914;&#26524;&#24050;&#32463;&#26377;&#20154;&#35835;&#20102;&#23427;
  data = JSON.parse request.body.read
  "Hello #{data['name']}!"
end
</code></pre>

<a name='&%2338468;&%2320214;'></a>
<h3>&#38468;&#20214;</h3>

<p>&#20320;&#21487;&#20197;&#20351;&#29992; <code>attachment</code> &#36741;&#21161;&#26041;&#27861;&#26469;&#21578;&#35785;&#27983;&#35272;&#22120;&#21709;&#24212;
&#24212;&#24403;&#34987;&#20889;&#20837;&#30913;&#30424;&#32780;&#19981;&#26159;&#22312;&#27983;&#35272;&#22120;&#20013;&#26174;&#31034;&#12290;</p>

<pre><code class="ruby">get '/' do
  attachment
  "store it!"
end
</code></pre>

<p>&#20320;&#20063;&#21487;&#20197;&#20256;&#36882;&#19968;&#20010;&#25991;&#20214;&#21517;:</p>

<pre><code class="ruby">get '/' do
  attachment "info.txt"
  "store it!"
end
</code></pre>

<a name='&%2326597;&%2325214;&%2327169;&%2326495;&%2325991;&%2320214;'></a>
<h3>&#26597;&#25214;&#27169;&#26495;&#25991;&#20214;</h3>

<p><code>find_template</code> &#36741;&#21161;&#26041;&#27861;&#34987;&#29992;&#20110;&#22312;&#28210;&#26579;&#26102;&#26597;&#25214;&#27169;&#26495;&#25991;&#20214;:</p>

<pre><code class="ruby">find_template settings.views, 'foo', Tilt[:haml] do |file|
  puts "could be #{file}"
end
</code></pre>

<p>&#36825;&#24182;&#19981;&#26159;&#24456;&#26377;&#29992;&#12290;&#20294;&#26159;&#22312;&#20320;&#38656;&#35201;&#37325;&#36733;&#36825;&#20010;&#26041;&#27861;
&#26469;&#23454;&#29616;&#20320;&#33258;&#24049;&#30340;&#26597;&#25214;&#26426;&#21046;&#30340;&#26102;&#20505;&#26377;&#29992;&#12290; &#27604;&#22914;&#65292;&#22914;&#26524;&#20320;&#24819;&#25903;&#25345;&#22810;&#20110;&#19968;&#20010;&#35270;&#22270;&#30446;&#24405;:</p>

<pre><code class="ruby">set :views, ['views', 'templates']

helpers do
  def find_template(views, name, engine, &amp;block)
    Array(views).each { |v| super(v, name, engine, &amp;block) }
  end
end
</code></pre>

<p>&#21478;&#19968;&#20010;&#20363;&#23376;&#26159;&#20026;&#19981;&#21516;&#30340;&#24341;&#25806;&#20351;&#29992;&#19981;&#21516;&#30340;&#30446;&#24405;:</p>

<pre><code class="ruby">set :views, :sass =&gt; 'views/sass', :haml =&gt; 'templates', :default =&gt; 'views'

helpers do
  def find_template(views, name, engine, &amp;block)
    _, folder = views.detect { |k,v| engine == Tilt[k] }
    folder ||= views[:default]
    super(folder, name, engine, &amp;block)
  end
end
</code></pre>

<p>&#20320;&#21487;&#20197;&#24456;&#23481;&#26131;&#22320;&#21253;&#35013;&#25104;&#19968;&#20010;&#25193;&#23637;&#28982;&#21518;&#19982;&#20182;&#20154;&#20998;&#20139;&#65281;</p>

<p>&#35831;&#27880;&#24847; <code>find_template</code> &#24182;&#19981;&#20250;&#26816;&#26597;&#25991;&#20214;&#30495;&#30340;&#23384;&#22312;&#65292;
&#32780;&#26159;&#23545;&#20219;&#20309;&#21487;&#33021;&#30340;&#36335;&#24452;&#35843;&#29992;&#32473;&#20837;&#30340;&#20195;&#30721;&#22359;&#12290;&#36825;&#24182;&#19981;&#20250;&#24102;&#26469;&#24615;&#33021;&#38382;&#39064;&#65292; &#22240;&#20026;
<code>render</code> &#20250;&#22312;&#25214;&#21040;&#25991;&#20214;&#30340;&#26102;&#20505;&#39532;&#19978;&#20351;&#29992; <code>break</code> &#12290;
&#21516;&#26679;&#30340;&#65292;&#27169;&#26495;&#30340;&#36335;&#24452;&#65288;&#21644;&#20869;&#23481;&#65289;&#20250;&#22312;&#38500;development mode&#20197;&#22806;&#30340;&#22330;&#21512;
&#34987;&#32531;&#23384;&#12290;&#20320;&#24212;&#35813;&#26102;&#21051;&#25552;&#37266;&#33258;&#24049;&#36825;&#19968;&#28857;&#65292; &#22914;&#26524;&#20320;&#30495;&#30340;&#24819;&#20889;&#19968;&#20010;&#38750;&#24120;&#30127;&#29378;&#30340;&#26041;&#27861;&#12290;</p>

<a name='&%2337197;&%2332622;'></a>
<h2>&#37197;&#32622;</h2>

<p>&#36816;&#34892;&#19968;&#27425;&#65292;&#22312;&#21551;&#21160;&#30340;&#26102;&#20505;&#65292;&#22312;&#20219;&#20309;&#29615;&#22659;&#19979;&#65306;</p>

<pre><code class="ruby">configure do
  # setting one option
  set :option, 'value'

  # setting multiple options
  set :a =&gt; 1, :b =&gt; 2

  # same as `set :option, true`
  enable :option

  # same as `set :option, false`
  disable :option

  # you can also have dynamic settings with blocks
  set(:css_dir) { File.join(views, 'css') }
end
</code></pre>

<p>&#21482;&#24403;&#29615;&#22659; (RACK_ENV environment &#21464;&#37327;) &#34987;&#35774;&#23450;&#20026; <code>:production</code>&#30340;&#26102;&#20505;&#36816;&#34892;&#65306;</p>

<pre><code class="ruby">configure :production do
  ...
end
</code></pre>

<p>&#24403;&#29615;&#22659;&#34987;&#35774;&#23450;&#20026; <code>:production</code> &#25110;&#32773; <code>:test</code>&#30340;&#26102;&#20505;&#36816;&#34892;&#65306;</p>

<pre><code class="ruby">configure :production, :test do
  ...
end
</code></pre>

<p>&#20320;&#21487;&#20197;&#20351;&#29992; <code>settings</code> &#33719;&#24471;&#36825;&#20123;&#37197;&#32622;:</p>

<pre><code class="ruby">configure do
  set :foo, 'bar'
end

get '/' do
  settings.foo? # =&gt; true
  settings.foo  # =&gt; 'bar'
  ...
end
</code></pre>

<a name='&%2321487;&%2336873;&%2330340;&%2335774;&%2332622;'></a>
<h3>&#21487;&#36873;&#30340;&#35774;&#32622;</h3>

<dl>
<dt>absolute_redirects</dt>
    <dd>
        <p>
            &#22914;&#26524;&#34987;&#31105;&#29992;&#65292;Sinatra&#20250;&#20801;&#35768;&#20351;&#29992;&#30456;&#23545;&#36335;&#24452;&#37325;&#23450;&#21521;&#65292; &#20294;&#26159;&#65292;Sinatra&#23601;&#19981;&#20877;&#36981;&#23432;
            RFC 2616&#26631;&#20934; (HTTP 1.1), &#35813;&#26631;&#20934;&#21482;&#20801;&#35768;&#32477;&#23545;&#36335;&#24452;&#37325;&#23450;&#21521;&#12290;

        </p>
<p>
            &#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#36816;&#34892;&#22312;&#19968;&#20010;&#26410;&#24688;&#24403;&#35774;&#32622;&#30340;&#21453;&#21521;&#20195;&#29702;&#20043;&#21518;&#65292;
            &#20320;&#38656;&#35201;&#21551;&#29992;&#36825;&#20010;&#36873;&#39033;&#12290;&#27880;&#24847; <tt>url</tt> &#36741;&#21161;&#26041;&#27861; &#20173;&#28982;&#20250;&#29983;&#25104;&#32477;&#23545; URL&#65292;&#38500;&#38750;&#20320;&#20256;&#20837;
            <tt>false</tt> &#20316;&#20026;&#31532;&#20108;&#21442;&#25968;&#12290;

        </p>
<p>
            &#40664;&#35748;&#31105;&#29992;&#12290;
    </p>
</dd>

    <dt>add_charsets</dt>
    <dd>
        <p>
            &#35774;&#23450; <tt>content_type</tt> &#36741;&#21161;&#26041;&#27861;&#20250; &#33258;&#21160;&#21152;&#19978;&#23383;&#31526;&#38598;&#20449;&#24687;&#30340;&#22810;&#23186;&#20307;&#31867;&#22411;&#12290;
        </p>

        <p>
            &#20320;&#24212;&#35813;&#28155;&#21152;&#32780;&#19981;&#26159;&#35206;&#30422;&#36825;&#20010;&#36873;&#39033;:
            <tt>settings.add_charsets 
        </tt></p>
    </dd>

    <dt>app_file</dt>
    <dd>
        &#20027;&#24212;&#29992;&#25991;&#20214;&#65292;&#29992;&#26469;&#26816;&#27979;&#39033;&#30446;&#30340;&#26681;&#36335;&#24452;&#65292; views&#21644;public&#25991;&#20214;&#22841;&#21644;&#20869;&#32852;&#27169;&#26495;&#12290;
    </dd>

    <dt>bind</dt>
    <dd>
        &#32465;&#23450;&#30340;IP &#22320;&#22336; (&#40664;&#35748;: 0.0.0.0)&#12290; &#20165;&#23545;&#20110;&#20869;&#32622;&#30340;&#26381;&#21153;&#22120;&#26377;&#29992;&#12290;
    </dd>

    <dt>default_encoding</dt>
    <dd>
        &#40664;&#35748;&#32534;&#30721; (&#40664;&#35748;&#20026; <tt>"utf-8"</tt>)&#12290;
    </dd>

    <dt>dump_errors</dt>
    <dd>
        &#22312;log&#20013;&#26174;&#31034;&#38169;&#35823;&#12290;
    </dd>

    <dt>environment</dt>
    <dd>
        &#24403;&#21069;&#29615;&#22659;&#65292;&#40664;&#35748;&#26159; <tt>ENV['RACK_ENV']</tt>&#65292; &#25110;&#32773; <tt>"development"</tt> &#22914;&#26524;&#19981;&#21487;&#29992;&#12290;
    </dd>

    <dt>logging</dt>
    <dd>
        &#20351;&#29992;logger
    </dd>

    <dt>lock</dt>
    <dd>
        <p>
            &#23545;&#27599;&#19968;&#20010;&#35831;&#27714;&#25918;&#32622;&#19968;&#20010;&#38145;&#65292; &#21482;&#20351;&#29992;&#36827;&#31243;&#24182;&#21457;&#22788;&#29702;&#35831;&#27714;&#12290;
        </p>

        <p>
            &#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#19981;&#26159;&#32447;&#31243;&#23433;&#20840;&#21017;&#38656;&#21551;&#21160;&#12290; &#40664;&#35748;&#31105;&#29992;&#12290;
        </p>
    </dd>

    <dt>method_override</dt>
    <dd>
        &#20351;&#29992; <tt>_method</tt> &#39764;&#27861;&#20197;&#20801;&#35768;&#22312;&#26087;&#30340;&#27983;&#35272;&#22120;&#20013;&#22312; &#34920;&#21333;&#20013;&#20351;&#29992; put/delete &#26041;&#27861;
    </dd>

    <dt>port</dt>
    <dd>
        &#30417;&#21548;&#30340;&#31471;&#21475;&#21495;&#12290;&#21482;&#23545;&#20869;&#32622;&#26381;&#21153;&#22120;&#26377;&#29992;&#12290;
    </dd>

    <dt>prefixed_redirects</dt>
    <dd>
        &#26159;&#21542;&#28155;&#21152; <tt>request.script_name</tt> &#21040;
        &#37325;&#23450;&#21521;&#35831;&#27714;&#65292;&#22914;&#26524;&#27809;&#26377;&#35774;&#23450;&#32477;&#23545;&#36335;&#24452;&#12290;&#37027;&#26679;&#30340;&#35805; <tt>redirect '/foo'</tt> &#20250;&#21644;
        <tt>redirect to('/foo')</tt>&#36215;&#30456;&#21516;&#20316;&#29992;&#12290;&#40664;&#35748;&#31105;&#29992;&#12290;
    </dd>

    <dt>public_folder</dt>
    <dd>
        public&#25991;&#20214;&#22841;&#30340;&#20301;&#32622;&#12290;
    </dd>

    <dt>reload_templates</dt>
    <dd>
        &#26159;&#21542;&#27599;&#20010;&#35831;&#27714;&#37117;&#37325;&#26032;&#36733;&#20837;&#27169;&#26495;&#12290; &#22312;development mode&#21644; Ruby 1.8.6
        &#20013;&#34987;&#20225;&#19994;&#65288;&#29992;&#26469; &#28040;&#38500;&#19968;&#20010;Ruby&#20869;&#23384;&#27844;&#28431;&#30340;bug&#65289;&#12290;
    </dd>

    <dt>root</dt>
    <dd>
        &#39033;&#30446;&#30340;&#26681;&#30446;&#24405;&#12290;
    </dd>

    <dt>raise_errors</dt>
    <dd>
        &#25243;&#20986;&#24322;&#24120;&#65288;&#24212;&#29992;&#20250;&#20572;&#19979;&#65289;&#12290;
    </dd>

    <dt>run</dt>
    <dd>
        &#22914;&#26524;&#21551;&#29992;&#65292;Sinatra&#20250;&#24320;&#21551;web&#26381;&#21153;&#22120;&#12290; &#22914;&#26524;&#20351;&#29992;rackup&#25110;&#20854;&#20182;&#26041;&#24335;&#21017;&#19981;&#35201;&#21551;&#29992;&#12290;
    </dd>

    <dt>running</dt>
    <dd>
        &#20869;&#32622;&#30340;&#26381;&#21153;&#22120;&#22312;&#36816;&#34892;&#21527;&#65311; &#19981;&#35201;&#20462;&#25913;&#36825;&#20010;&#35774;&#32622;&#65281;
    </dd>

    <dt>server</dt>
    <dd>
        &#26381;&#21153;&#22120;&#65292;&#25110;&#29992;&#20110;&#20869;&#32622;&#26381;&#21153;&#22120;&#30340;&#21015;&#34920;&#12290; &#40664;&#35748;&#26159; [&lsquo;thin&rsquo;, &lsquo;mongrel&rsquo;, &lsquo;webrick&rsquo;],
        &#39034;&#24207;&#34920;&#26126;&#20102; &#20248;&#20808;&#32423;&#12290;
    </dd>

    <dt>sessions</dt>
    <dd>
        &#24320;&#21551;&#22522;&#20110;cookie&#30340;sesson&#12290;
    </dd>

    <dt>show_exceptions</dt>
    <dd>
        &#22312;&#27983;&#35272;&#22120;&#20013;&#26174;&#31034;&#19968;&#20010;stack trace&#12290;
    </dd>

    <dt>static</dt>
    <dd>
        Sinatra&#26159;&#21542;&#22788;&#29702;&#38745;&#24577;&#25991;&#20214;&#12290; &#24403;&#26381;&#21153;&#22120;&#33021;&#22815;&#22788;&#29702;&#21017;&#31105;&#29992;&#12290; &#31105;&#29992;&#20250;&#22686;&#24378;&#24615;&#33021;&#12290;
        &#40664;&#35748;&#24320;&#21551;&#12290;
    </dd>

    <dt>views</dt>
    <dd>
        views &#25991;&#20214;&#22841;&#12290;
    </dd>
</dl>
<a name='&%2338169;&%2335823;&%2322788;&%2329702;'></a>
<h2>&#38169;&#35823;&#22788;&#29702;</h2>

<p>&#38169;&#35823;&#22788;&#29702;&#22312;&#19982;&#36335;&#30001;&#21644;&#21069;&#32622;&#36807;&#28388;&#22120;&#30456;&#21516;&#30340;&#19978;&#19979;&#25991;&#20013;&#36816;&#34892;&#65292;
&#36825;&#24847;&#21619;&#30528;&#20320;&#21487;&#20197;&#20351;&#29992;&#35768;&#22810;&#22909;&#19996;&#35199;&#65292;&#27604;&#22914; <code>haml</code>, <code>erb</code>, <code>halt</code>&#65292;&#31561;&#31561;&#12290;</p>

<a name='&%2326410;&%2325214;&%2321040;'></a>
<h3>&#26410;&#25214;&#21040;</h3>

<p>&#24403;&#19968;&#20010; <code>Sinatra::NotFound</code> &#38169;&#35823;&#34987;&#25243;&#20986;&#30340;&#26102;&#20505;&#65292;
&#25110;&#32773;&#21709;&#24212;&#29366;&#24577;&#30721;&#26159;404&#65292;<code>not_found</code> &#22788;&#29702;&#22120;&#20250;&#34987;&#35843;&#29992;&#65306;</p>

<pre><code class="ruby">not_found do
  'This is nowhere to be found'
end
</code></pre>

<a name='&%2338169;&%2335823;'></a>
<h3>&#38169;&#35823;</h3>

<p><code>error</code> &#22788;&#29702;&#22120;&#65292;&#22312;&#20219;&#20309;&#36335;&#30001;&#20195;&#30721;&#22359;&#25110;&#32773;&#36807;&#28388;&#22120;&#25243;&#20986;&#24322;&#24120;&#30340;&#26102;&#20505;&#20250;&#34987;&#35843;&#29992;&#12290;
&#24322;&#24120;&#23545;&#35937;&#21487;&#20197;&#36890;&#36807;<code>sinatra.error</code> Rack &#21464;&#37327;&#33719;&#24471;&#65306;</p>

<pre><code class="ruby">error do
  'Sorry there was a nasty error - ' + env['sinatra.error'].name
end
</code></pre>

<p>&#33258;&#23450;&#20041;&#38169;&#35823;&#65306;</p>

<pre><code class="ruby">error MyCustomError do
  'So what happened was...' + env['sinatra.error'].message
end
</code></pre>

<p>&#37027;&#20040;&#65292;&#24403;&#36825;&#20010;&#21457;&#29983;&#30340;&#26102;&#20505;&#65306;</p>

<pre><code class="ruby">get '/' do
  raise MyCustomError, 'something bad'
end
</code></pre>

<p>&#20320;&#20250;&#24471;&#21040;&#65306;</p>

<pre><code>So what happened was... something bad
</code></pre>

<p>&#21478;&#19968;&#31181;&#26367;&#20195;&#26041;&#27861;&#26159;&#65292;&#20026;&#19968;&#20010;&#29366;&#24577;&#30721;&#23433;&#35013;&#38169;&#35823;&#22788;&#29702;&#22120;&#65306;</p>

<pre><code class="ruby">error 403 do
  'Access forbidden'
end

get '/secret' do
  403
end
</code></pre>

<p>&#25110;&#32773;&#19968;&#20010;&#33539;&#22260;&#65306;</p>

<pre><code class="ruby">error 400..510 do
  'Boom'
end
</code></pre>

<p>&#22312;&#36816;&#34892;&#22312;development&#29615;&#22659;&#19979;&#26102;&#65292;Sinatra&#20250;&#23433;&#35013;&#29305;&#27530;&#30340; <code>not_found</code> &#21644; <code>error</code>
&#22788;&#29702;&#22120;&#12290;</p>

<a name='Rack%20&%2320013;&%2338388;&%2320214;'></a>
<h2>Rack &#20013;&#38388;&#20214;</h2>

<p>Sinatra &#20381;&#38752; <a href="http://rack.rubyforge.org/">Rack</a>, &#19968;&#20010;&#38754;&#21521;Ruby
web&#26694;&#26550;&#30340;&#26368;&#23567;&#26631;&#20934;&#25509;&#21475;&#12290;
Rack&#30340;&#19968;&#20010;&#26368;&#26377;&#36259;&#30340;&#38754;&#21521;&#24212;&#29992;&#24320;&#21457;&#32773;&#30340;&#33021;&#21147;&#26159;&#25903;&#25345;&ldquo;&#20013;&#38388;&#20214;&rdquo;&mdash;&mdash;&#22352;&#33853;&#22312;&#26381;&#21153;&#22120;&#21644;&#20320;&#30340;&#24212;&#29992;&#20043;&#38388;&#65292;
&#30417;&#35270; &#24182;/&#25110; &#25805;&#20316;HTTP&#35831;&#27714;/&#21709;&#24212;&#20197; &#25552;&#20379;&#22810;&#26679;&#31867;&#22411;&#30340;&#24120;&#29992;&#21151;&#33021;&#12290;</p>

<p>Sinatra &#35753;&#24314;&#31435;Rack&#20013;&#38388;&#20214;&#31649;&#36947;&#24322;&#24120;&#31616;&#21333;&#65292; &#36890;&#36807;&#39030;&#23618;&#30340; <code>use</code> &#26041;&#27861;&#65306;</p>

<pre><code class="ruby">require 'sinatra'
require 'my_custom_middleware'

use Rack::Lint
use MyCustomMiddleware

get '/hello' do
  'Hello World'
end
</code></pre>

<p><code>use</code> &#30340;&#35821;&#20041;&#21644;&#22312;
<a href="http://rack.rubyforge.org/doc/classes/Rack/Builder.html">Rack::Builder</a>
DSL(&#22312;rack&#25991;&#20214;&#20013;&#26368;&#39057;&#32321;&#20351;&#29992;)&#20013;&#23450;&#20041;&#30340;&#23436;&#20840;&#19968;&#26679;&#12290;&#20363;&#22914;&#65292;<code>use</code> &#26041;&#27861;&#25509;&#21463;
&#22810;&#20010;/&#21487;&#21464; &#21442;&#25968;&#65292;&#21253;&#25324;&#20195;&#30721;&#22359;&#65306;</p>

<pre><code class="ruby">use Rack::Auth::Basic do |username, password|
  username == 'admin' &amp;&amp; password == 'secret'
end
</code></pre>

<p>Rack&#20013;&#20998;&#24067;&#26377;&#22810;&#26679;&#30340;&#26631;&#20934;&#20013;&#38388;&#20214;&#65292;&#38024;&#23545;&#26085;&#24535;&#65292;
&#35843;&#35797;&#65292;URL&#36335;&#30001;&#65292;&#35748;&#35777;&#21644;session&#22788;&#29702;&#12290; Sinatra&#20250;&#33258;&#21160;&#20351;&#29992;&#36825;&#37324;&#38754;&#30340;&#22823;&#37096;&#20998;&#32452;&#20214;&#65292;
&#25152;&#20197;&#20320;&#19968;&#33324;&#19981;&#38656;&#35201;&#26174;&#31034;&#22320; <code>use</code> &#20182;&#20204;&#12290;</p>

<a name='&%2327979;&%2335797;'></a>
<h2>&#27979;&#35797;</h2>

<p>Sinatra&#30340;&#27979;&#35797;&#21487;&#20197;&#20351;&#29992;&#20219;&#20309;&#22522;&#20110;Rack&#30340;&#27979;&#35797;&#31243;&#24207;&#24211;&#25110;&#32773;&#26694;&#26550;&#26469;&#32534;&#20889;&#12290;
<a href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a> &#26159;&#25512;&#33616;&#20505;&#36873;&#65306;</p>

<pre><code class="ruby">require 'my_sinatra_app'
require 'test/unit'
require 'rack/test'

class MyAppTest &lt; Test::Unit::TestCase
  include Rack::Test::Methods

  def app
    Sinatra::Application
  end

  def test_my_default
    get '/'
    assert_equal 'Hello World!', last_response.body
  end

  def test_with_params
    get '/meet', :name =&gt; 'Frank'
    assert_equal 'Hello Frank!', last_response.body
  end

  def test_with_rack_env
    get '/', {}, 'HTTP_USER_AGENT' =&gt; 'Songbird'
    assert_equal "You're using Songbird!", last_response.body
  end
end
</code></pre>

<p>&#35831;&#27880;&#24847;: &#20869;&#32622;&#30340; Sinatra::Test &#27169;&#22359;&#21644; Sinatra::TestHarness &#31867; &#22312; 0.9.2
&#29256;&#26412;&#24050;&#24223;&#24323;&#12290;</p>

<a name='Sinatra::Base%20-%20&%2320013;&%2338388;&%2320214;&%2365292;&%2331243;&%2324207;&%2324211;&%2321644;&%2327169;&%2322359;&%2321270;&%2324212;&%2329992;'></a>
<h2>Sinatra::Base - &#20013;&#38388;&#20214;&#65292;&#31243;&#24207;&#24211;&#21644;&#27169;&#22359;&#21270;&#24212;&#29992;</h2>

<p>&#25226;&#20320;&#30340;&#24212;&#29992;&#23450;&#20041;&#22312;&#39030;&#23618;&#65292;&#23545;&#20110;&#24494;&#22411;&#24212;&#29992;&#36825;&#20250;&#24037;&#20316;&#24471;&#24456;&#22909;&#65292;
&#20294;&#26159;&#22312;&#26500;&#24314;&#21487;&#22797;&#29992;&#30340;&#32452;&#20214;&#26102;&#20505;&#20250;&#24102;&#26469;&#23458;&#35266;&#30340;&#19981;&#21033;&#65292; &#27604;&#22914;&#26500;&#24314;Rack&#20013;&#38388;&#20214;&#65292;Rails
metal&#65292;&#24102;&#26377;&#26381;&#21153;&#22120;&#32452;&#20214;&#30340;&#31616;&#21333;&#31243;&#24207;&#24211;&#65292;
&#25110;&#32773;&#29978;&#33267;&#26159;Sinatra&#25193;&#23637;&#12290;&#39030;&#23618;&#30340;DSL&#27745;&#26579;&#20102;Object&#21629;&#21517;&#31354;&#38388;&#65292;
&#24182;&#20551;&#23450;&#20102;&#19968;&#20010;&#24494;&#22411;&#24212;&#29992;&#39118;&#26684;&#30340;&#37197;&#32622; (&#20363;&#22914;, &#21333;&#19968;&#30340;&#24212;&#29992;&#25991;&#20214;&#65292; ./public &#21644;
./views &#30446;&#24405;&#65292;&#26085;&#24535;&#65292;&#24322;&#24120;&#32454;&#33410;&#39029;&#38754;&#65292;&#31561;&#31561;&#65289;&#12290; &#36825;&#26102;&#24212;&#35813;&#35753; Sinatra::Base
&#36208;&#21040;&#21488;&#21069;&#20102;&#65306;</p>

<pre><code class="ruby">require 'sinatra/base'

class MyApp &lt; Sinatra::Base
  set :sessions, true
  set :foo, 'bar'

  get '/' do
    'Hello world!'
  end
end
</code></pre>

<p>Sinatra::Base&#23376;&#31867;&#21487;&#29992;&#30340;&#26041;&#27861;&#23454;&#38469;&#19978;&#23601;&#26159;&#36890;&#36807;&#39030;&#23618; DSL &#21487;&#29992;&#30340;&#26041;&#27861;&#12290;
&#22823;&#37096;&#20998;&#39030;&#23618;&#24212;&#29992;&#21487;&#20197;&#36890;&#36807;&#20004;&#20010;&#25913;&#21464;&#36716;&#25442;&#25104;Sinatra::Base&#32452;&#20214;&#65306;</p>

<ul>
<li><p>&#20320;&#30340;&#25991;&#20214;&#24212;&#24403;&#24341;&#20837; <code>sinatra/base</code> &#32780;&#19981;&#26159; <code>sinatra</code>;
&#21542;&#21017;&#65292;&#25152;&#26377;&#30340;Sinatra&#30340; DSL &#26041;&#27861;&#23558;&#20250;&#34987;&#24341;&#36827;&#21040; &#20027;&#21629;&#21517;&#31354;&#38388;&#12290;</p></li>
<li><p>&#25226;&#20320;&#30340;&#24212;&#29992;&#30340;&#36335;&#30001;&#65292;&#38169;&#35823;&#22788;&#29702;&#65292;&#36807;&#28388;&#22120;&#21644;&#36873;&#39033;&#25918;&#22312;
&#19968;&#20010;Sinatra::Base&#30340;&#23376;&#31867;&#20013;&#12290;</p></li>
</ul>
<p><code>+Sinatra::Base+</code> &#26159;&#19968;&#24352;&#30333;&#32440;&#12290;&#22823;&#37096;&#20998;&#30340;&#36873;&#39033;&#40664;&#35748;&#26159;&#31105;&#29992;&#30340;&#65292;
&#21253;&#21547;&#20869;&#32622;&#30340;&#26381;&#21153;&#22120;&#12290;&#21442;&#35265;
<a href="http://sinatra.github.com/configuration.html">&#36873;&#39033;&#21644;&#37197;&#32622;</a>
&#26597;&#30475;&#21487;&#29992;&#36873;&#39033;&#30340;&#20855;&#20307;&#32454;&#33410;&#21644;&#20182;&#20204;&#30340;&#34892;&#20026;&#12290;</p>

<a name='&%2327169;&%2322359;&%2321270;%20vs.%20&%2320256;&%2332479;&%2330340;&%2326041;&%2324335;'></a>
<h3>&#27169;&#22359;&#21270; vs. &#20256;&#32479;&#30340;&#26041;&#24335;</h3>

<p>&#19982;&#36890;&#24120;&#30340;&#35748;&#35782;&#30456;&#21453;&#65292;&#20256;&#32479;&#30340;&#26041;&#24335;&#27809;&#26377;&#20219;&#20309;&#38169;&#35823;&#12290;
&#22914;&#26524;&#23427;&#36866;&#21512;&#20320;&#30340;&#24212;&#29992;&#65292;&#20320;&#19981;&#38656;&#35201;&#36716;&#25442;&#21040;&#27169;&#22359;&#21270;&#30340;&#24212;&#29992;&#12290;</p>

<p>&#21644;&#27169;&#22359;&#21270;&#26041;&#24335;&#30456;&#27604;&#21482;&#26377;&#20004;&#20010;&#32570;&#28857;:</p>

<ul>
<li><p>&#20320;&#23545;&#27599;&#20010;Ruby&#36827;&#31243;&#21482;&#33021;&#23450;&#20041;&#19968;&#20010;Sinatra&#24212;&#29992;&#65292;&#22914;&#26524;&#20320;&#38656;&#35201;&#26356;&#22810;&#65292;
&#20999;&#25442;&#21040;&#27169;&#22359;&#21270;&#26041;&#24335;&#12290;</p></li>
<li><p>&#20256;&#32479;&#26041;&#24335;&#20351;&#29992;&#20195;&#29702;&#26041;&#27861;&#27745;&#26579;&#20102; Object &#12290;&#22914;&#26524;&#20320;&#25171;&#31639; &#25226;&#20320;&#30340;&#24212;&#29992;&#23553;&#35013;&#36827;&#19968;&#20010;
library/gem&#65292;&#36716;&#25442;&#21040;&#27169;&#22359;&#21270;&#26041;&#24335;&#12290;</p></li>
</ul>
<p>&#27809;&#26377;&#20219;&#20309;&#21407;&#22240;&#38459;&#27490;&#20320;&#28151;&#21512;&#27169;&#22359;&#21270;&#21644;&#20256;&#32479;&#26041;&#24335;&#12290;</p>

<p>&#22914;&#26524;&#20174;&#19968;&#31181;&#36716;&#25442;&#21040;&#21478;&#19968;&#31181;&#65292;&#20320;&#38656;&#35201;&#27880;&#24847;settings&#20013;&#30340; &#19968;&#20123;&#24494;&#23567;&#30340;&#19981;&#21516;:</p>

<pre><code>Setting             Classic                 Modular

app_file            file loading sinatra    nil
run                 $0 == app_file          false
logging             true                    false
method_override     true                    false
inline_templates    true                    false
</code></pre>

<a name='&%2336816;&%2334892;&%2319968;&%2320010;&%2327169;&%2322359;&%2321270;&%2324212;&%2329992;'></a>
<h3>&#36816;&#34892;&#19968;&#20010;&#27169;&#22359;&#21270;&#24212;&#29992;</h3>

<p>&#26377;&#20004;&#31181;&#26041;&#24335;&#36816;&#34892;&#19968;&#20010;&#27169;&#22359;&#21270;&#24212;&#29992;&#65292;&#20351;&#29992; <code>run!</code>&#26469;&#36816;&#34892;:</p>

<pre><code class="ruby"># my_app.rb
require 'sinatra/base'

class MyApp &lt; Sinatra::Base
  # ... app code here ...

  # start the server if ruby file executed directly
  run! if app_file == $0
end
</code></pre>

<p>&#36816;&#34892;:</p>

<pre><code>ruby my_app.rb
</code></pre>

<p>&#25110;&#32773;&#20351;&#29992;&#19968;&#20010; <code>config.ru</code>&#65292;&#20801;&#35768;&#20320;&#20351;&#29992;&#20219;&#20309;Rack&#22788;&#29702;&#22120;:</p>

<pre><code class="ruby"># config.ru
require './my_app'
run MyApp
</code></pre>

<p>&#36816;&#34892;:</p>

<pre><code>rackup -p 4567
</code></pre>

<a name='&%2320351;&%2329992;config.ru&%2336816;&%2334892;&%2320256;&%2332479;&%2326041;&%2324335;&%2330340;&%2324212;&%2329992;'></a>
<h3>&#20351;&#29992;config.ru&#36816;&#34892;&#20256;&#32479;&#26041;&#24335;&#30340;&#24212;&#29992;</h3>

<p>&#32534;&#20889;&#20320;&#30340;&#24212;&#29992;:</p>

<pre><code class="ruby"># app.rb
require 'sinatra'

get '/' do
  'Hello world!'
end
</code></pre>

<p>&#21152;&#20837;&#30456;&#24212;&#30340; <code>config.ru</code>:</p>

<pre><code class="ruby">require './app'
run Sinatra::Application
</code></pre>

<a name='&%2320160;&%2320040;&%2326102;&%2320505;&%2329992;%20config.ru?'></a>
<h3>&#20160;&#20040;&#26102;&#20505;&#29992; config.ru?</h3>

<p>&#20197;&#19979;&#24773;&#20917;&#20320;&#21487;&#33021;&#38656;&#35201;&#20351;&#29992; <code>config.ru</code>:</p>

<ul>
<li><p>&#20320;&#35201;&#20351;&#29992;&#19981;&#21516;&#30340; Rack &#22788;&#29702;&#22120;&#37096;&#32626; (Passenger, Unicorn, Heroku, &hellip;).</p></li>
<li><p>&#20320;&#24819;&#20351;&#29992;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010; <code>Sinatra::Base</code>&#30340;&#23376;&#31867;.</p></li>
<li><p>&#20320;&#21482;&#24819;&#25226;Sinatra&#24403;&#20316;&#20013;&#38388;&#20214;&#20351;&#29992;&#65292;&#32780;&#19981;&#26159;&#31471;&#28857;&#12290;</p></li>
</ul>
<p><strong>&#20320;&#24182;&#19981;&#38656;&#35201;&#20999;&#25442;&#21040;<code>config.ru</code>&#20165;&#20165;&#22240;&#20026;&#20320;&#20999;&#25442;&#21040;&#27169;&#22359;&#21270;&#26041;&#24335;&#65292;
&#20320;&#21516;&#26679;&#19981;&#38656;&#35201;&#20999;&#25442;&#21040;&#27169;&#22359;&#21270;&#26041;&#24335;&#65292; &#20165;&#20165;&#22240;&#20026;&#35201;&#36816;&#34892; <code>config.ru</code>.</strong></p>

<a name='&%2325226;Sinatra&%2324403;&%2325104;&%2320013;&%2338388;&%2320214;&%2326469;&%2320351;&%2329992;'></a>
<h3>&#25226;Sinatra&#24403;&#25104;&#20013;&#38388;&#20214;&#26469;&#20351;&#29992;</h3>

<p>&#19981;&#20165;Sinatra&#26377;&#33021;&#21147;&#20351;&#29992;&#20854;&#20182;&#30340;Rack&#20013;&#38388;&#20214;&#65292;&#20219;&#20309;Sinatra
&#24212;&#29992;&#31243;&#24207;&#37117;&#21487;&#20197;&#21453;&#36807;&#26469;&#33258;&#36523;&#34987;&#24403;&#20316;&#20013;&#38388;&#20214;&#65292;&#34987;&#21152;&#22312;&#20219;&#20309;Rack&#31471;&#28857;&#21069;&#38754;&#12290;
&#36825;&#20010;&#31471;&#28857;&#21487;&#20197;&#26159;&#20219;&#20309;Sinatra&#24212;&#29992;&#65292;&#25110;&#32773;&#20219;&#20309;&#22522;&#20110;Rack&#30340;&#24212;&#29992;&#31243;&#24207;
(Rails/Ramaze/Camping/&hellip;)&#12290;</p>

<pre><code class="ruby">require 'sinatra/base'

class LoginScreen &lt; Sinatra::Base
  enable :sessions

  get('/login') { haml :login }

  post('/login') do
    if params[:name] = 'admin' and params[:password] = 'admin'
      session['user_name'] = params[:name]
    else
      redirect '/login'
    end
  end
end

class MyApp &lt; Sinatra::Base
  # &#22312;&#21069;&#32622;&#36807;&#28388;&#22120;&#21069;&#36816;&#34892;&#20013;&#38388;&#20214;
  use LoginScreen

  before do
    unless session['user_name']
      halt "Access denied, please &lt;a href='/login'&gt;login&lt;/a&gt;."
    end
  end

  get('/') { "Hello #{session['user_name']}." }
end
</code></pre>

<a name='&%2321464;&%2337327;&%2322495;&%2321644;&%2332465;&%2323450;'></a>
<h2>&#21464;&#37327;&#22495;&#21644;&#32465;&#23450;</h2>

<p>&#24403;&#21069;&#25152;&#22312;&#30340;&#21464;&#37327;&#22495;&#20915;&#23450;&#20102;&#21738;&#20123;&#26041;&#27861;&#21644;&#21464;&#37327;&#26159;&#21487;&#29992;&#30340;&#12290;</p>

<a name='&%2324212;&%2329992;/&%2331867;%20&%2321464;&%2337327;&%2322495;'></a>
<h3>&#24212;&#29992;/&#31867; &#21464;&#37327;&#22495;</h3>

<p>&#27599;&#20010;Sinatra&#24212;&#29992;&#30456;&#24403;&#19982;Sinatra::Base&#30340;&#19968;&#20010;&#23376;&#31867;&#12290;
&#22914;&#26524;&#20320;&#22312;&#20351;&#29992;&#39030;&#23618;DSL(<code>require 'sinatra'</code>)&#65292;&#37027;&#20040;&#36825;&#20010;&#31867;&#23601;&#26159;
Sinatra::Application&#65292;&#25110;&#32773;&#36825;&#20010;&#31867;&#23601;&#26159;&#20320;&#26174;&#24335;&#21019;&#24314;&#30340;&#23376;&#31867;&#12290;
&#22312;&#31867;&#23618;&#38754;&#65292;&#20320;&#20855;&#26377;&#30340;&#26041;&#27861;&#31867;&#20284;&#20110; `get` &#25110;&#32773; `before`&#65292;&#20294;&#26159;&#20320;&#19981;&#33021;&#35775;&#38382;
`request` &#23545;&#35937;&#25110;&#32773; `session`, &#22240;&#20026;&#23545;&#20110;&#25152;&#26377;&#30340;&#35831;&#27714;&#65292;
&#21482;&#26377;&#21333;&#19968;&#30340;&#24212;&#29992;&#31867;&#12290;</p>

<p>&#36890;&#36807; `set` &#21019;&#24314;&#30340;&#36873;&#39033;&#26159;&#31867;&#23618;&#38754;&#30340;&#26041;&#27861;&#65306;</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  # &#22079;&#65292;&#25105;&#22312;&#24212;&#29992;&#21464;&#37327;&#22495;&#65281;
  set :foo, 42
  foo # =&gt; 42

  get '/foo' do
    # &#22079;&#65292;&#25105;&#19981;&#20877;&#22788;&#20110;&#24212;&#29992;&#21464;&#37327;&#22495;&#20102;&#65281;
  end
end
</code></pre>

<p>&#22312;&#19979;&#21015;&#24773;&#20917;&#19979;&#20320;&#23558;&#25317;&#26377;&#24212;&#29992;&#21464;&#37327;&#22495;&#30340;&#32465;&#23450;&#65306;</p>

<ul>
<li><p>&#22312;&#24212;&#29992;&#31867;&#20013;</p></li>
<li><p>&#22312;&#25193;&#23637;&#20013;&#23450;&#20041;&#30340;&#26041;&#27861;</p></li>
<li><p>&#20256;&#36882;&#32473; `helpers` &#30340;&#20195;&#30721;&#22359;</p></li>
<li><p>&#29992;&#20316;`set`&#20540;&#30340;&#36807;&#31243;/&#20195;&#30721;&#22359;</p></li>
</ul>
<p>&#20320;&#21487;&#20197;&#35775;&#38382;&#21464;&#37327;&#22495;&#23545;&#35937;&#65288;&#23601;&#26159;&#24212;&#29992;&#31867;&#65289;&#23601;&#20687;&#36825;&#26679;&#65306;</p>

<ul>
<li><p>&#36890;&#36807;&#20256;&#36882;&#32473;&#20195;&#30721;&#22359;&#30340;&#23545;&#35937; (<code>configure { |c| ... }</code>)</p></li>
<li><p>&#22312;&#35831;&#27714;&#21464;&#37327;&#22495;&#20013;&#20351;&#29992;`settings`</p></li>
</ul>
<a name='&%2335831;&%2327714;/&%2323454;&%2320363;%20&%2321464;&%2337327;&%2322495;'></a>
<h3>&#35831;&#27714;/&#23454;&#20363; &#21464;&#37327;&#22495;</h3>

<p>&#23545;&#20110;&#27599;&#20010;&#36827;&#20837;&#30340;&#35831;&#27714;&#65292;&#19968;&#20010;&#26032;&#30340;&#24212;&#29992;&#31867;&#30340;&#23454;&#20363;&#20250;&#34987;&#21019;&#24314;
&#25152;&#26377;&#30340;&#22788;&#29702;&#22120;&#20195;&#30721;&#22359;&#22312;&#35813;&#21464;&#37327;&#22495;&#34987;&#36816;&#34892;&#12290;&#22312;&#36825;&#20010;&#21464;&#37327;&#22495;&#20013;&#65292; &#20320;&#21487;&#20197;&#35775;&#38382;
`request` &#21644; `session` &#23545;&#35937;&#65292;&#25110;&#32773;&#35843;&#29992;&#28210;&#26579;&#26041;&#27861;&#27604;&#22914; `erb` &#25110;&#32773;
`haml`&#12290;&#20320;&#21487;&#20197;&#22312;&#35831;&#27714;&#21464;&#37327;&#22495;&#24403;&#20013;&#36890;&#36807;`settings`&#36741;&#21161;&#26041;&#27861;
&#35775;&#38382;&#24212;&#29992;&#21464;&#37327;&#22495;&#65306;</p>

<pre><code class="ruby">class MyApp &lt; Sinatra::Base
  # &#22079;&#65292;&#25105;&#22312;&#24212;&#29992;&#21464;&#37327;&#22495;!
  get '/define_route/:name' do
    # &#38024;&#23545; '/define_route/:name' &#30340;&#35831;&#27714;&#21464;&#37327;&#22495;
    @value = 42

    settings.get("/#{params[:name]}") do
      # &#38024;&#23545; "/#{params[:name]}" &#30340;&#35831;&#27714;&#21464;&#37327;&#22495;
      @value # =&gt; nil (&#24182;&#19981;&#26159;&#30456;&#21516;&#30340;&#35831;&#27714;)
    end

    "Route defined!"
  end
end
</code></pre>

<p>&#22312;&#20197;&#19979;&#24773;&#20917;&#23558;&#33719;&#24471;&#35831;&#27714;&#21464;&#37327;&#22495;&#65306;</p>

<ul>
<li><p>get/head/post/put/delete &#20195;&#30721;&#22359;</p></li>
<li><p>&#21069;&#32622;/&#21518;&#32622; &#36807;&#28388;&#22120;</p></li>
<li><p>&#36741;&#21161;&#26041;&#27861;</p></li>
<li><p>&#27169;&#26495;/&#35270;&#22270;</p></li>
</ul>
<a name='&%2320195;&%2329702;&%2321464;&%2337327;&%2322495;'></a>
<h3>&#20195;&#29702;&#21464;&#37327;&#22495;</h3>

<p>&#20195;&#29702;&#21464;&#37327;&#22495;&#21482;&#26159;&#25226;&#26041;&#27861;&#36716;&#36865;&#21040;&#31867;&#21464;&#37327;&#22495;&#12290;&#21487;&#26159;&#65292;
&#20182;&#24182;&#38750;&#34920;&#29616;&#24471;100%&#31867;&#20284;&#20110;&#31867;&#21464;&#37327;&#22495;, &#22240;&#20026;&#20320;&#24182;&#19981;&#33021;&#33719;&#24471;&#31867;&#30340;&#32465;&#23450;:
&#21482;&#26377;&#26174;&#24335;&#22320;&#26631;&#35760;&#20026;&#20379;&#20195;&#29702;&#20351;&#29992;&#30340;&#26041;&#27861;&#25165;&#26159;&#21487;&#29992;&#30340;&#65292;
&#32780;&#19988;&#20320;&#19981;&#33021;&#21644;&#31867;&#21464;&#37327;&#22495;&#20849;&#20139;&#21464;&#37327;/&#29366;&#24577;&#12290;(&#35299;&#37322;&#65306;&#20320;&#26377;&#20102;&#19968;&#20010;&#19981;&#21516;&#30340; `self`)&#12290;
&#20320;&#21487;&#20197;&#26174;&#24335;&#22320;&#22686;&#21152;&#26041;&#27861;&#20195;&#29702;&#65292;&#36890;&#36807;&#35843;&#29992;
<code>Sinatra::Delegator.delegate :method_name</code>&#12290;</p>

<p>&#22312;&#20197;&#19979;&#24773;&#20917;&#23558;&#33719;&#24471;&#20195;&#29702;&#21464;&#37327;&#22495;&#65306;</p>

<ul>
<li><p>&#39030;&#23618;&#30340;&#32465;&#23450;&#65292;&#22914;&#26524;&#20320;&#20570;&#36807; <code>require "sinatra"</code></p></li>
<li><p>&#22312;&#25193;&#23637;&#20102; `Sinatra::Delegator` mixin&#30340;&#23545;&#35937;</p></li>
</ul>
<p>&#33258;&#24049;&#22312;&#36825;&#37324;&#30475;&#19968;&#19979;&#20195;&#30721;: <a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a>
&#24050;&#32463;
<a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28">&#34987;&#21253;&#21547;&#36827;&#20102;&#20027;&#21629;&#21517;&#31354;&#38388;</a>&#12290;</p>

<a name='&%2321629;&%2320196;&%2334892;'></a>
<h2>&#21629;&#20196;&#34892;</h2>

<p>Sinatra &#24212;&#29992;&#21487;&#20197;&#34987;&#30452;&#25509;&#36816;&#34892;&#65306;</p>

<pre><code>ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]
</code></pre>

<p>&#36873;&#39033;&#26159;&#65306;</p>

<pre><code>-h # help
-p # &#35774;&#23450;&#31471;&#21475; (&#40664;&#35748;&#26159; 4567)
-o # &#35774;&#23450;&#20027;&#26426;&#21517; (&#40664;&#35748;&#26159; 0.0.0.0)
-e # &#35774;&#23450;&#29615;&#22659; (&#40664;&#35748;&#26159; development)
-s # &#38480;&#23450; rack &#26381;&#21153;&#22120;/&#22788;&#29702;&#22120; (&#40664;&#35748;&#26159; thin)
-x # &#25171;&#24320;&#20114;&#26021;&#38145; (&#40664;&#35748;&#26159; off)
</code></pre>

<a name='&%2324517;&%2335201;&%2326465;&%2320214;'></a>
<h2>&#24517;&#35201;&#26465;&#20214;</h2>

<p>&#25512;&#33616;&#22312; Ruby 1.8.7, 1.9.2, JRuby &#25110;&#32773; Rubinius &#19978;&#23433;&#35013;Sinatra&#12290;</p>

<p>&#19979;&#38754;&#30340;Ruby&#29256;&#26412;&#26159;&#23448;&#26041;&#25903;&#25345;&#30340;:</p>

<dl>
<dt>Ruby 1.8.6</dt>
    <dd>
        &#19981;&#25512;&#33616;&#22312;1.8.6&#19978;&#23433;&#35013;Sinatra&#65292; &#20294;&#26159;&#30452;&#21040;Sinatra
        1.3.0&#21457;&#24067;&#25165;&#20250;&#25918;&#24323;&#23545;&#23427;&#30340;&#25903;&#25345;&#12290; RDoc &#21644;
        CoffeScript&#27169;&#26495;&#19981;&#34987;&#36825;&#20010;Ruby&#29256;&#26412;&#25903;&#25345;&#12290;
        1.8.6&#22312;&#23427;&#30340;Hash&#23454;&#29616;&#20013;&#21253;&#21547;&#19968;&#20010;&#20869;&#23384;&#27844;&#28431;&#38382;&#39064;&#65292;
        &#35813;&#38382;&#39064;&#20250;&#34987;1.1.1&#29256;&#26412;&#20043;&#21069;&#30340;Sinatra&#24341;&#21457;&#12290;
        &#24403;&#21069;&#29256;&#26412;&#20351;&#29992;&#24615;&#33021;&#19979;&#38477;&#30340;&#20195;&#20215;&#25490;&#38500;&#20102;&#36825;&#20010;&#38382;&#39064;&#12290;&#20320;&#38656;&#35201;&#25226;Rack&#38477;&#32423;&#21040;1.1.x&#65292;
        &#22240;&#20026;Rack \&gt;= 1.2&#19981;&#20877;&#25903;&#25345;1.8.6&#12290;
    </dd>

    <dt>Ruby 1.8.7</dt>
    <dd>
        1.8.7 &#34987;&#23436;&#20840;&#25903;&#25345;&#65292;&#20294;&#26159;&#65292;&#22914;&#26524;&#27809;&#26377;&#29305;&#21035;&#21407;&#22240;&#65292; &#25105;&#20204;&#25512;&#33616;&#20320;&#21319;&#32423;&#21040; 1.9.2
        &#25110;&#32773;&#20999;&#25442;&#21040; JRuby &#25110;&#32773; Rubinius.
    </dd>

    <dt>Ruby 1.9.2</dt>
    <dd>
        1.9.2 &#34987;&#25903;&#25345;&#32780;&#19988;&#25512;&#33616;&#12290;&#27880;&#24847; Radius &#21644; Markaby &#27169;&#26495;&#24182;&#19981;&#21644;1.9&#20860;&#23481;&#12290;&#19981;&#35201;&#20351;&#29992;
        1.9.2p0, &#23427;&#34987;&#24050;&#30693;&#20250;&#20135;&#29983; segmentation faults.
    </dd>

    <dt>Rubinius</dt>
    <dd>
        Rubinius &#34987;&#23448;&#26041;&#25903;&#25345; (Rubinius \&gt;= 1.2.2)&#65292; &#38500;&#20102;Textile&#27169;&#26495;&#12290;
    </dd>

    <dt>JRuby</dt>
    <dd>
        JRuby &#34987;&#23448;&#26041;&#25903;&#25345; (JRuby \&gt;= 1.5.6)&#12290; &#30446;&#21069;&#26410;&#30693;&#21644;&#31532;&#19977;&#26041;&#27169;&#26495;&#24211;&#26377;&#20851;&#30340;&#38382;&#39064;&#65292;
        &#20294;&#26159;&#65292;&#22914;&#26524;&#20320;&#36873;&#25321;&#20102;JRuby&#65292;&#35831;&#26597;&#30475;&#19968;&#19979;JRuby rack &#22788;&#29702;&#22120;&#65292; &#22240;&#20026; Thin web
        &#26381;&#21153;&#22120;&#36824;&#27809;&#26377;&#22312;JRuby&#19978;&#33719;&#24471;&#25903;&#25345;&#12290;
    </dd>
</dl>
<p>&#25105;&#20204;&#20063;&#20250;&#26102;&#21051;&#20851;&#27880;&#26032;&#30340;Ruby&#29256;&#26412;&#12290;</p>

<p>&#19979;&#38754;&#30340; Ruby &#23454;&#29616;&#27809;&#26377;&#34987;&#23448;&#26041;&#25903;&#25345;&#65292; &#20294;&#26159;&#24050;&#30693;&#21487;&#20197;&#36816;&#34892; Sinatra:</p>

<ul>
<li><p>JRuby &#21644; Rubinius &#32769;&#29256;&#26412;</p></li>
<li><p>MacRuby</p></li>
<li><p>Maglev</p></li>
<li><p>IronRuby</p></li>
<li><p>Ruby 1.9.0 and 1.9.1</p></li>
</ul>
<p>&#19981;&#34987;&#23448;&#26041;&#25903;&#25345;&#30340;&#24847;&#24605;&#26159;&#65292;&#22914;&#26524;&#22312;&#19981;&#34987;&#25903;&#25345;&#30340;&#24179;&#21488;&#19978;&#26377;&#36816;&#34892;&#38169;&#35823;&#65292;
&#25105;&#20204;&#20551;&#23450;&#19981;&#26159;&#25105;&#20204;&#30340;&#38382;&#39064;&#65292;&#32780;&#26159;&#24179;&#21488;&#30340;&#38382;&#39064;&#12290;</p>

<p>Sinatra&#24212;&#35813;&#20250;&#36816;&#34892;&#22312;&#20219;&#20309;&#25903;&#25345;&#19978;&#36848;Ruby&#23454;&#29616;&#30340;&#25805;&#20316;&#31995;&#32479;&#12290;</p>

<a name='&%2332039;&%2336861;&%2321069;&%2327839;'></a>
<h2>&#32039;&#36861;&#21069;&#27839;</h2>

<p>&#22914;&#26524;&#20320;&#21916;&#27426;&#20351;&#29992; Sinatra &#30340;&#26368;&#26032;&#40092;&#30340;&#20195;&#30721;&#65292;&#35831;&#25918;&#24515;&#30340;&#20351;&#29992; master
&#20998;&#25903;&#26469;&#36816;&#34892;&#20320;&#30340;&#31243;&#24207;&#65292;&#23427;&#20250;&#38750;&#24120;&#30340;&#31283;&#23450;&#12290;</p>

<pre><code>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</code></pre>

<p>&#25105;&#20204;&#20063;&#20250;&#19981;&#23450;&#26399;&#30340;&#21457;&#24067;&#39044;&#21457;&#24067;gems&#65292;&#25152;&#20197;&#20320;&#20063;&#21487;&#20197;&#36816;&#34892;</p>

<pre><code>gem install sinatra --pre
</code></pre>

<p>&#26469;&#33719;&#24471;&#26368;&#26032;&#30340;&#29305;&#24615;&#12290;</p>

<a name='&%2336890;&%2336807;Bundler'></a>
<h3>&#36890;&#36807;Bundler</h3>

<p>&#22914;&#26524;&#20320;&#24819;&#20351;&#29992;&#26368;&#26032;&#30340;Sinatra&#36816;&#34892;&#20320;&#30340;&#24212;&#29992;&#65292;&#36890;&#36807;
<a href="http://gembundler.com/">Bundler</a> &#26159;&#25512;&#33616;&#30340;&#26041;&#24335;&#12290;</p>

<p>&#39318;&#20808;&#65292;&#23433;&#35013;bundler&#65292;&#22914;&#26524;&#20320;&#36824;&#27809;&#26377;&#23433;&#35013;:</p>

<pre><code>gem install bundler
</code></pre>

<p>&#28982;&#21518;&#65292;&#22312;&#20320;&#30340;&#39033;&#30446;&#30446;&#24405;&#19979;&#65292;&#21019;&#24314;&#19968;&#20010; <code>Gemfile</code>:</p>

<pre><code class="ruby">source :rubygems
gem 'sinatra', :git =&gt; "git://github.com/sinatra/sinatra.git"

# &#20854;&#20182;&#30340;&#20381;&#36182;&#20851;&#31995;
gem 'haml'                    # &#20030;&#20363;&#65292;&#22914;&#26524;&#20320;&#24819;&#29992;haml
gem 'activerecord', '~&gt; 3.0'  # &#20063;&#35768;&#20320;&#36824;&#38656;&#35201; ActiveRecord 3.x
</code></pre>

<p>&#35831;&#27880;&#24847;&#22312;&#36825;&#37324;&#20320;&#38656;&#35201;&#21015;&#20986;&#20320;&#30340;&#24212;&#29992;&#30340;&#25152;&#26377;&#20381;&#36182;&#20851;&#31995;&#12290; Sinatra&#30340;&#30452;&#25509;&#20381;&#36182;&#20851;&#31995;
(Rack and Tilt) &#23558;&#20250;&#65292; &#33258;&#21160;&#34987;Bundler&#33719;&#21462;&#21644;&#28155;&#21152;&#12290;</p>

<p>&#29616;&#22312;&#20320;&#21487;&#20197;&#20687;&#36825;&#26679;&#36816;&#34892;&#20320;&#30340;&#24212;&#29992;:</p>

<pre><code>bundle exec ruby myapp.rb
</code></pre>

<a name='&%2320351;&%2329992;&%2333258;&%2324049;&%2330340;'></a>
<h3>&#20351;&#29992;&#33258;&#24049;&#30340;</h3>

<p>&#21019;&#24314;&#19968;&#20010;&#26412;&#22320;&#20811;&#38534;&#24182;&#36890;&#36807; <code>sinatra/lib</code> &#30446;&#24405;&#36816;&#34892;&#20320;&#30340;&#24212;&#29992;&#65292; &#36890;&#36807;
<code>$LOAD_PATH</code>:</p>

<pre><code>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -Isinatra/lib myapp.rb
</code></pre>

<p>&#20026;&#20102;&#22312;&#26410;&#26469;&#26356;&#26032; Sinatra &#28304;&#20195;&#30721;:</p>

<pre><code>cd myapp/sinatra
git pull
</code></pre>

<a name='&%2320840;&%2323616;&%2323433;&%2335013;'></a>
<h3>&#20840;&#23616;&#23433;&#35013;</h3>

<p>&#20320;&#21487;&#20197;&#33258;&#34892;&#32534;&#35793; gem :</p>

<pre><code>git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install
</code></pre>

<p>&#22914;&#26524;&#20320;&#20197;root&#36523;&#20221;&#23433;&#35013; gems&#65292;&#26368;&#21518;&#19968;&#27493;&#24212;&#35813;&#26159;</p>

<pre><code>sudo rake install
</code></pre>

<a name='&%2326356;&%2322810;'></a>
<h2>&#26356;&#22810;</h2>

<ul>
<li><p><a href="http://www.sinatrarb.com/">&#39033;&#30446;&#20027;&#39029;&#65288;&#33521;&#25991;&#65289;</a> - &#26356;&#22810;&#30340;&#25991;&#26723;&#65292;
&#26032;&#38395;&#65292;&#21644;&#20854;&#20182;&#36164;&#28304;&#30340;&#38142;&#25509;&#12290;</p></li>
<li><p><a href="http://www.sinatrarb.com/contributing">&#36129;&#29486;</a> - &#25214;&#21040;&#20102;&#19968;&#20010;bug&#65311;
&#38656;&#35201;&#24110;&#21161;&#65311;&#26377;&#20102;&#19968;&#20010; patch?</p></li>
<li><p><a href="http://github.com/sinatra/sinatra/issues">&#38382;&#39064;&#36861;&#36394;</a></p></li>
<li><p><a href="http://twitter.com/sinatra">Twitter</a></p></li>
<li><p><a href="http://groups.google.com/group/sinatrarb/topics">&#37038;&#20214;&#21015;&#34920;</a></p></li>
<li><p><a href="irc://chat.freenode.net/#sinatra">IRC: #sinatra</a> on
<a href="http://freenode.net">freenode.net</a></p></li>
</ul>
</body></html>
